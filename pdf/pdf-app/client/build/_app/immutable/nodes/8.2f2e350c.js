var Zi=Object.defineProperty;var ts=(ft,c,K)=>c in ft?Zi(ft,c,{enumerable:!0,configurable:!0,writable:!0,value:K}):ft[c]=K;var ee=(ft,c,K)=>(ts(ft,typeof c!="symbol"?c+"":c,K),K),Ne=(ft,c,K)=>{if(!c.has(ft))throw TypeError("Cannot "+K)};var t=(ft,c,K)=>(Ne(ft,c,"read from private field"),K?K.call(ft):c.get(ft)),I=(ft,c,K)=>{if(c.has(ft))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(ft):c.set(ft,K)},tt=(ft,c,K,l)=>(Ne(ft,c,"write to private field"),l?l.call(ft,K):c.set(ft,K),K);var ge=(ft,c,K,l)=>({set _(y){tt(ft,c,y,K)},get _(){return t(ft,c,l)}}),G=(ft,c,K)=>(Ne(ft,c,"access private method"),K);import{a as api,g as getErrorMessage,b as getAugmentedNamespace}from"../chunks/axios.910bcce3.js";import{S as SvelteComponent,i as init,s as safe_not_equal,k as element,l as claim_element,m as children,h as detach,n as attr,p as set_style,b as insert_hydration,E as append_hydration,C as noop,o as onMount,T as onDestroy,w as binding_callbacks,a as space,e as empty,c as claim_space,g as transition_in,d as transition_out,q as text,r as claim_text,u as set_data,y as create_component,z as claim_component,A as mount_component,B as destroy_component}from"../chunks/index.71e04022.js";import{b as beforeNavigate}from"../chunks/navigation.bc5bb0e1.js";import{r as resetAll,C as ChatPanel,s as sendMessage}from"../chunks/ChatPanel.1b59c449.js";const load=async({params:ft})=>{try{const{data:{pdf:c,download_url:K}}=await api.get(`/pdfs/${ft.id}`);return{document:c,documentUrl:K}}catch(c){return{error:getErrorMessage(c)}}},_page=Object.freeze(Object.defineProperty({__proto__:null,load},Symbol.toStringTag,{value:"Module"}));function commonjsRequire(ft){throw new Error('Could not dynamically require "'+ft+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(c,K){module.exports=c.pdfjsLib=K()})(globalThis,()=>(()=>{var __webpack_modules__=[,(ft,c)=>{var qt;Object.defineProperty(c,"__esModule",{value:!0}),c.VerbosityLevel=c.Util=c.UnknownErrorException=c.UnexpectedResponseException=c.TextRenderingMode=c.RenderingIntentFlag=c.PromiseCapability=c.PermissionFlag=c.PasswordResponses=c.PasswordException=c.PageActionEventType=c.OPS=c.MissingPDFException=c.MAX_IMAGE_SIZE_TO_CACHE=c.LINE_FACTOR=c.LINE_DESCENT_FACTOR=c.InvalidPDFException=c.ImageKind=c.IDENTITY_MATRIX=c.FormatError=c.FeatureTest=c.FONT_IDENTITY_MATRIX=c.DocumentActionEventType=c.CMapCompressionType=c.BaseException=c.BASELINE_FACTOR=c.AnnotationType=c.AnnotationReplyType=c.AnnotationPrefix=c.AnnotationMode=c.AnnotationFlag=c.AnnotationFieldFlag=c.AnnotationEditorType=c.AnnotationEditorPrefix=c.AnnotationEditorParamsType=c.AnnotationBorderStyleType=c.AnnotationActionEventType=c.AbortException=void 0,c.assert=lt,c.bytesToString=B,c.createValidAbsoluteUrl=wt,c.getModificationDate=Ct,c.getUuid=$t,c.getVerbosityLevel=$,c.info=nt,c.isArrayBuffer=dt,c.isArrayEqual=Et,c.isNodeJS=void 0,c.normalizeUnicode=Xt,c.objectFromMap=ht,c.objectSize=rt,c.setVerbosityLevel=w,c.shadow=Pt,c.string32=Z,c.stringToBytes=et,c.stringToPDFString=pt,c.stringToUTF8String=J,c.unreachable=W,c.utf8StringToString=Q,c.warn=at;const K=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");c.isNodeJS=K;const l=[1,0,0,1,0,0];c.IDENTITY_MATRIX=l;const y=[.001,0,0,.001,0,0];c.FONT_IDENTITY_MATRIX=y;const it=1e7;c.MAX_IMAGE_SIZE_TO_CACHE=it;const U=1.35;c.LINE_FACTOR=U;const ct=.35;c.LINE_DESCENT_FACTOR=ct;const L=ct/U;c.BASELINE_FACTOR=L;const P={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};c.RenderingIntentFlag=P;const p={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};c.AnnotationMode=p;const O="pdfjs_internal_editor_";c.AnnotationEditorPrefix=O;const N={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};c.AnnotationEditorType=N;const k={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};c.AnnotationEditorParamsType=k;const S={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};c.PermissionFlag=S;const v={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};c.TextRenderingMode=v;const u={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};c.ImageKind=u;const b={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};c.AnnotationType=b;const C={GROUP:"Group",REPLY:"R"};c.AnnotationReplyType=C;const T={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};c.AnnotationFlag=T;const A={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};c.AnnotationFieldFlag=A;const a={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};c.AnnotationBorderStyleType=a;const h={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};c.AnnotationActionEventType=h;const F={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};c.DocumentActionEventType=F;const g={O:"PageOpen",C:"PageClose"};c.PageActionEventType=g;const r={ERRORS:0,WARNINGS:1,INFOS:5};c.VerbosityLevel=r;const x={NONE:0,BINARY:1};c.CMapCompressionType=x;const m={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};c.OPS=m;const j={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};c.PasswordResponses=j;let X=r.WARNINGS;function w(ot){Number.isInteger(ot)&&(X=ot)}function $(){return X}function nt(ot){X>=r.INFOS&&console.log(`Info: ${ot}`)}function at(ot){X>=r.WARNINGS&&console.log(`Warning: ${ot}`)}function W(ot){throw new Error(ot)}function lt(ot,Y){ot||W(Y)}function gt(ot){switch(ot==null?void 0:ot.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function wt(ot,Y=null,z=null){if(!ot)return null;try{if(z&&typeof ot=="string"){if(z.addDefaultProtocol&&ot.startsWith("www.")){const At=ot.match(/\./g);(At==null?void 0:At.length)>=2&&(ot=`http://${ot}`)}if(z.tryConvertEncoding)try{ot=J(ot)}catch{}}const _t=Y?new URL(ot,Y):new URL(ot);if(gt(_t))return _t}catch{}return null}function Pt(ot,Y,z,_t=!1){return Object.defineProperty(ot,Y,{value:z,enumerable:!_t,configurable:!0,writable:!1}),z}const E=function(){function Y(z,_t){this.constructor===Y&&W("Cannot initialize BaseException."),this.message=z,this.name=_t}return Y.prototype=new Error,Y.constructor=Y,Y}();c.BaseException=E;class i extends E{constructor(Y,z){super(Y,"PasswordException"),this.code=z}}c.PasswordException=i;class n extends E{constructor(Y,z){super(Y,"UnknownErrorException"),this.details=z}}c.UnknownErrorException=n;class s extends E{constructor(Y){super(Y,"InvalidPDFException")}}c.InvalidPDFException=s;class o extends E{constructor(Y){super(Y,"MissingPDFException")}}c.MissingPDFException=o;class d extends E{constructor(Y,z){super(Y,"UnexpectedResponseException"),this.status=z}}c.UnexpectedResponseException=d;class _ extends E{constructor(Y){super(Y,"FormatError")}}c.FormatError=_;class M extends E{constructor(Y){super(Y,"AbortException")}}c.AbortException=M;function B(ot){(typeof ot!="object"||(ot==null?void 0:ot.length)===void 0)&&W("Invalid argument for bytesToString");const Y=ot.length,z=8192;if(Y<z)return String.fromCharCode.apply(null,ot);const _t=[];for(let At=0;At<Y;At+=z){const te=Math.min(At+z,Y),Zt=ot.subarray(At,te);_t.push(String.fromCharCode.apply(null,Zt))}return _t.join("")}function et(ot){typeof ot!="string"&&W("Invalid argument for stringToBytes");const Y=ot.length,z=new Uint8Array(Y);for(let _t=0;_t<Y;++_t)z[_t]=ot.charCodeAt(_t)&255;return z}function Z(ot){return String.fromCharCode(ot>>24&255,ot>>16&255,ot>>8&255,ot&255)}function rt(ot){return Object.keys(ot).length}function ht(ot){const Y=Object.create(null);for(const[z,_t]of ot)Y[z]=_t;return Y}function yt(){const ot=new Uint8Array(4);return ot[0]=1,new Uint32Array(ot.buffer,0,1)[0]===1}function ut(){try{return new Function(""),!0}catch{return!1}}class Ft{static get isLittleEndian(){return Pt(this,"isLittleEndian",yt())}static get isEvalSupported(){return Pt(this,"isEvalSupported",ut())}static get isOffscreenCanvasSupported(){return Pt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Pt(this,"platform",{isWin:!1,isMac:!1}):Pt(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Y,z;return Pt(this,"isCSSRoundSupported",(z=(Y=globalThis.CSS)==null?void 0:Y.supports)==null?void 0:z.call(Y,"width: round(1.5px, 1px)"))}}c.FeatureTest=Ft;const Bt=[...Array(256).keys()].map(ot=>ot.toString(16).padStart(2,"0"));class St{static makeHexColor(Y,z,_t){return`#${Bt[Y]}${Bt[z]}${Bt[_t]}`}static scaleMinMax(Y,z){let _t;Y[0]?(Y[0]<0&&(_t=z[0],z[0]=z[1],z[1]=_t),z[0]*=Y[0],z[1]*=Y[0],Y[3]<0&&(_t=z[2],z[2]=z[3],z[3]=_t),z[2]*=Y[3],z[3]*=Y[3]):(_t=z[0],z[0]=z[2],z[2]=_t,_t=z[1],z[1]=z[3],z[3]=_t,Y[1]<0&&(_t=z[2],z[2]=z[3],z[3]=_t),z[2]*=Y[1],z[3]*=Y[1],Y[2]<0&&(_t=z[0],z[0]=z[1],z[1]=_t),z[0]*=Y[2],z[1]*=Y[2]),z[0]+=Y[4],z[1]+=Y[4],z[2]+=Y[5],z[3]+=Y[5]}static transform(Y,z){return[Y[0]*z[0]+Y[2]*z[1],Y[1]*z[0]+Y[3]*z[1],Y[0]*z[2]+Y[2]*z[3],Y[1]*z[2]+Y[3]*z[3],Y[0]*z[4]+Y[2]*z[5]+Y[4],Y[1]*z[4]+Y[3]*z[5]+Y[5]]}static applyTransform(Y,z){const _t=Y[0]*z[0]+Y[1]*z[2]+z[4],At=Y[0]*z[1]+Y[1]*z[3]+z[5];return[_t,At]}static applyInverseTransform(Y,z){const _t=z[0]*z[3]-z[1]*z[2],At=(Y[0]*z[3]-Y[1]*z[2]+z[2]*z[5]-z[4]*z[3])/_t,te=(-Y[0]*z[1]+Y[1]*z[0]+z[4]*z[1]-z[5]*z[0])/_t;return[At,te]}static getAxialAlignedBoundingBox(Y,z){const _t=this.applyTransform(Y,z),At=this.applyTransform(Y.slice(2,4),z),te=this.applyTransform([Y[0],Y[3]],z),Zt=this.applyTransform([Y[2],Y[1]],z);return[Math.min(_t[0],At[0],te[0],Zt[0]),Math.min(_t[1],At[1],te[1],Zt[1]),Math.max(_t[0],At[0],te[0],Zt[0]),Math.max(_t[1],At[1],te[1],Zt[1])]}static inverseTransform(Y){const z=Y[0]*Y[3]-Y[1]*Y[2];return[Y[3]/z,-Y[1]/z,-Y[2]/z,Y[0]/z,(Y[2]*Y[5]-Y[4]*Y[3])/z,(Y[4]*Y[1]-Y[5]*Y[0])/z]}static singularValueDecompose2dScale(Y){const z=[Y[0],Y[2],Y[1],Y[3]],_t=Y[0]*z[0]+Y[1]*z[2],At=Y[0]*z[1]+Y[1]*z[3],te=Y[2]*z[0]+Y[3]*z[2],Zt=Y[2]*z[1]+Y[3]*z[3],q=(_t+Zt)/2,vt=Math.sqrt((_t+Zt)**2-4*(_t*Zt-te*At))/2,Lt=q+vt||1,Tt=q-vt||1;return[Math.sqrt(Lt),Math.sqrt(Tt)]}static normalizeRect(Y){const z=Y.slice(0);return Y[0]>Y[2]&&(z[0]=Y[2],z[2]=Y[0]),Y[1]>Y[3]&&(z[1]=Y[3],z[3]=Y[1]),z}static intersect(Y,z){const _t=Math.max(Math.min(Y[0],Y[2]),Math.min(z[0],z[2])),At=Math.min(Math.max(Y[0],Y[2]),Math.max(z[0],z[2]));if(_t>At)return null;const te=Math.max(Math.min(Y[1],Y[3]),Math.min(z[1],z[3])),Zt=Math.min(Math.max(Y[1],Y[3]),Math.max(z[1],z[3]));return te>Zt?null:[_t,te,At,Zt]}static bezierBoundingBox(Y,z,_t,At,te,Zt,q,vt){const Lt=[],Tt=[[],[]];let Ot,Nt,Jt,bt,Yt,It,R,e;for(let V=0;V<2;++V){if(V===0?(Nt=6*Y-12*_t+6*te,Ot=-3*Y+9*_t-9*te+3*q,Jt=3*_t-3*Y):(Nt=6*z-12*At+6*Zt,Ot=-3*z+9*At-9*Zt+3*vt,Jt=3*At-3*z),Math.abs(Ot)<1e-12){if(Math.abs(Nt)<1e-12)continue;bt=-Jt/Nt,0<bt&&bt<1&&Lt.push(bt);continue}R=Nt*Nt-4*Jt*Ot,e=Math.sqrt(R),!(R<0)&&(Yt=(-Nt+e)/(2*Ot),0<Yt&&Yt<1&&Lt.push(Yt),It=(-Nt-e)/(2*Ot),0<It&&It<1&&Lt.push(It))}let f=Lt.length,D;const H=f;for(;f--;)bt=Lt[f],D=1-bt,Tt[0][f]=D*D*D*Y+3*D*D*bt*_t+3*D*bt*bt*te+bt*bt*bt*q,Tt[1][f]=D*D*D*z+3*D*D*bt*At+3*D*bt*bt*Zt+bt*bt*bt*vt;return Tt[0][H]=Y,Tt[1][H]=z,Tt[0][H+1]=q,Tt[1][H+1]=vt,Tt[0].length=Tt[1].length=H+2,[Math.min(...Tt[0]),Math.min(...Tt[1]),Math.max(...Tt[0]),Math.max(...Tt[1])]}}c.Util=St;const Dt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function pt(ot){if(ot[0]>="ï"){let z;if(ot[0]==="þ"&&ot[1]==="ÿ"?z="utf-16be":ot[0]==="ÿ"&&ot[1]==="þ"?z="utf-16le":ot[0]==="ï"&&ot[1]==="»"&&ot[2]==="¿"&&(z="utf-8"),z)try{const _t=new TextDecoder(z,{fatal:!0}),At=et(ot);return _t.decode(At)}catch(_t){at(`stringToPDFString: "${_t}".`)}}const Y=[];for(let z=0,_t=ot.length;z<_t;z++){const At=Dt[ot.charCodeAt(z)];Y.push(At?String.fromCharCode(At):ot.charAt(z))}return Y.join("")}function J(ot){return decodeURIComponent(escape(ot))}function Q(ot){return unescape(encodeURIComponent(ot))}function dt(ot){return typeof ot=="object"&&(ot==null?void 0:ot.byteLength)!==void 0}function Et(ot,Y){if(ot.length!==Y.length)return!1;for(let z=0,_t=ot.length;z<_t;z++)if(ot[z]!==Y[z])return!1;return!0}function Ct(ot=new Date){return[ot.getUTCFullYear().toString(),(ot.getUTCMonth()+1).toString().padStart(2,"0"),ot.getUTCDate().toString().padStart(2,"0"),ot.getUTCHours().toString().padStart(2,"0"),ot.getUTCMinutes().toString().padStart(2,"0"),ot.getUTCSeconds().toString().padStart(2,"0")].join("")}class jt{constructor(){I(this,qt,!1);this.promise=new Promise((Y,z)=>{this.resolve=_t=>{tt(this,qt,!0),Y(_t)},this.reject=_t=>{tt(this,qt,!0),z(_t)}})}get settled(){return t(this,qt)}}qt=new WeakMap,c.PromiseCapability=jt;let Gt=null,Ht=null;function Xt(ot){return Gt||(Gt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ht=new Map([["ﬅ","ſt"]])),ot.replaceAll(Gt,(Y,z,_t)=>z?z.normalize("NFKC"):Ht.get(_t))}function $t(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const ot=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(ot);else for(let Y=0;Y<32;Y++)ot[Y]=Math.floor(Math.random()*255);return B(ot)}const Wt="pdfjs_internal_id_";c.AnnotationPrefix=Wt},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var ft,K,l,y,he,U,Ee,L,P,p,O,N,k,S,v,u,we,C,T,Be,a,h;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(g){if(typeof g=="string"||g instanceof URL?g={url:g}:(0,_util.isArrayBuffer)(g)&&(g={data:g}),typeof g!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!g.url&&!g.data&&!g.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const r=new PDFDocumentLoadingTask,{docId:x}=r,m=g.url?getUrlProp(g.url):null,j=g.data?getDataProp(g.data):null,X=g.httpHeaders||null,w=g.withCredentials===!0,$=g.password??null,nt=g.range instanceof PDFDataRangeTransport?g.range:null,at=Number.isInteger(g.rangeChunkSize)&&g.rangeChunkSize>0?g.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let W=g.worker instanceof PDFWorker?g.worker:null;const lt=g.verbosity,gt=typeof g.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(g.docBaseUrl)?g.docBaseUrl:null,wt=typeof g.cMapUrl=="string"?g.cMapUrl:null,Pt=g.cMapPacked!==!1,E=g.CMapReaderFactory||DefaultCMapReaderFactory,i=typeof g.standardFontDataUrl=="string"?g.standardFontDataUrl:null,n=g.StandardFontDataFactory||DefaultStandardFontDataFactory,s=g.stopAtErrors!==!0,o=Number.isInteger(g.maxImageSize)&&g.maxImageSize>-1?g.maxImageSize:-1,d=g.isEvalSupported!==!1,_=typeof g.isOffscreenCanvasSupported=="boolean"?g.isOffscreenCanvasSupported:!_util.isNodeJS,M=Number.isInteger(g.canvasMaxAreaInBytes)?g.canvasMaxAreaInBytes:-1,B=typeof g.disableFontFace=="boolean"?g.disableFontFace:_util.isNodeJS,et=g.fontExtraProperties===!0,Z=g.enableXfa===!0,rt=g.ownerDocument||globalThis.document,ht=g.disableRange===!0,yt=g.disableStream===!0,ut=g.disableAutoFetch===!0,Ft=g.pdfBug===!0,Bt=nt?nt.length:g.length??NaN,St=typeof g.useSystemFonts=="boolean"?g.useSystemFonts:!_util.isNodeJS&&!B,Dt=typeof g.useWorkerFetch=="boolean"?g.useWorkerFetch:E===_display_utils.DOMCMapReaderFactory&&n===_display_utils.DOMStandardFontDataFactory&&wt&&i&&(0,_display_utils.isValidFetchUrl)(wt,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(i,document.baseURI),pt=g.canvasFactory||new DefaultCanvasFactory({ownerDocument:rt}),J=g.filterFactory||new DefaultFilterFactory({docId:x,ownerDocument:rt}),Q=null;(0,_util.setVerbosityLevel)(lt);const dt={canvasFactory:pt,filterFactory:J};if(Dt||(dt.cMapReaderFactory=new E({baseUrl:wt,isCompressed:Pt}),dt.standardFontDataFactory=new n({baseUrl:i})),!W){const jt={verbosity:lt,port:_worker_options.GlobalWorkerOptions.workerPort};W=jt.port?PDFWorker.fromPort(jt):new PDFWorker(jt),r._worker=W}const Et={docId:x,apiVersion:"3.11.174",data:j,password:$,disableAutoFetch:ut,rangeChunkSize:at,length:Bt,docBaseUrl:gt,enableXfa:Z,evaluatorOptions:{maxImageSize:o,disableFontFace:B,ignoreErrors:s,isEvalSupported:d,isOffscreenCanvasSupported:_,canvasMaxAreaInBytes:M,fontExtraProperties:et,useSystemFonts:St,cMapUrl:Dt?wt:null,standardFontDataUrl:Dt?i:null}},Ct={ignoreErrors:s,isEvalSupported:d,disableFontFace:B,fontExtraProperties:et,enableXfa:Z,ownerDocument:rt,disableAutoFetch:ut,pdfBug:Ft,styleElement:Q};return W.promise.then(function(){if(r.destroyed)throw new Error("Loading aborted");const jt=_fetchDocument(W,Et),Gt=new Promise(function(Ht){let Xt;nt?Xt=new _transport_stream.PDFDataTransportStream({length:Bt,initialData:nt.initialData,progressiveDone:nt.progressiveDone,contentDispositionFilename:nt.contentDispositionFilename,disableRange:ht,disableStream:yt},nt):j||(Xt=(Wt=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Wt):(0,_display_utils.isValidFetchUrl)(Wt.url)?new _displayFetch_stream.PDFFetchStream(Wt):new _displayNetwork.PDFNetworkStream(Wt))({url:m,length:Bt,httpHeaders:X,withCredentials:w,rangeChunkSize:at,disableRange:ht,disableStream:yt})),Ht(Xt)});return Promise.all([jt,Gt]).then(function([Ht,Xt]){if(r.destroyed)throw new Error("Loading aborted");const $t=new _message_handler.MessageHandler(x,Ht,W.port),Wt=new WorkerTransport($t,r,Xt,Ct,dt);r._transport=Wt,$t.send("Ready",null)})}).catch(r._capability.reject),r}async function _fetchDocument(g,r){if(g.destroyed)throw new Error("Worker was destroyed");const x=await g.messageHandler.sendWithPromise("GetDocRequest",r,r.data?[r.data.buffer]:null);if(g.destroyed)throw new Error("Worker was destroyed");return x}function getUrlProp(g){if(g instanceof URL)return g.href;try{return new URL(g,window.location).href}catch{if(_util.isNodeJS&&typeof g=="string")return g}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(g){if(_util.isNodeJS&&typeof Buffer<"u"&&g instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength)return g;if(typeof g=="string")return(0,_util.stringToBytes)(g);if(typeof g=="object"&&!isNaN(g==null?void 0:g.length)||(0,_util.isArrayBuffer)(g))return new Uint8Array(g);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const c=class c{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${ge(c,ft)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var r,x,m;this.destroyed=!0;try{(r=this._worker)!=null&&r.port&&(this._worker._pendingDestroy=!0),await((x=this._transport)==null?void 0:x.destroy())}catch(j){throw(m=this._worker)!=null&&m.port&&delete this._worker._pendingDestroy,j}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};ft=new WeakMap,I(c,ft,0);let PDFDocumentLoadingTask=c;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(r,x,m=!1,j=null){this.length=r,this.initialData=x,this.progressiveDone=m,this.contentDispositionFilename=j,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(r){this._rangeListeners.push(r)}addProgressListener(r){this._progressListeners.push(r)}addProgressiveReadListener(r){this._progressiveReadListeners.push(r)}addProgressiveDoneListener(r){this._progressiveDoneListeners.push(r)}onDataRange(r,x){for(const m of this._rangeListeners)m(r,x)}onDataProgress(r,x){this._readyCapability.promise.then(()=>{for(const m of this._progressListeners)m(r,x)})}onDataProgressiveRead(r){this._readyCapability.promise.then(()=>{for(const x of this._progressiveReadListeners)x(r)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const r of this._progressiveDoneListeners)r()})}transportReady(){this._readyCapability.resolve()}requestDataRange(r,x){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(r,x){this._pdfInfo=r,this._transport=x,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(m=>{if(!m)return m;const j=[];for(const X in m)j.push(...m[X]);return j}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(r){return this._transport.getPage(r)}getPageIndex(r){return this._transport.getPageIndex(r)}getDestinations(){return this._transport.getDestinations()}getDestination(r){return this._transport.getDestination(r)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(r=!1){return this._transport.startCleanup(r||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(r,x,m,j=!1){I(this,y);I(this,U);I(this,K,null);I(this,l,!1);this._pageIndex=r,this._pageInfo=x,this._transport=m,this._stats=j?new _display_utils.StatTimer:null,this._pdfBug=j,this.commonObjs=m.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:r,rotation:x=this.rotate,offsetX:m=0,offsetY:j=0,dontFlip:X=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:r,rotation:x,offsetX:m,offsetY:j,dontFlip:X})}getAnnotations({intent:r="display"}={}){const x=this._transport.getRenderingIntent(r);return this._transport.getAnnotations(this._pageIndex,x.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var r;return((r=this._transport._htmlForXfa)==null?void 0:r.children[this._pageIndex])||null}render({canvasContext:r,viewport:x,intent:m="display",annotationMode:j=_util.AnnotationMode.ENABLE,transform:X=null,background:w=null,optionalContentConfigPromise:$=null,annotationCanvasMap:nt=null,pageColors:at=null,printAnnotationStorage:W=null}){var n,s;(n=this._stats)==null||n.time("Overall");const lt=this._transport.getRenderingIntent(m,j,W);tt(this,l,!1),G(this,U,Ee).call(this),$||($=this._transport.getOptionalContentConfig());let gt=this._intentStates.get(lt.cacheKey);gt||(gt=Object.create(null),this._intentStates.set(lt.cacheKey,gt)),gt.streamReaderCancelTimeout&&(clearTimeout(gt.streamReaderCancelTimeout),gt.streamReaderCancelTimeout=null);const wt=!!(lt.renderingIntent&_util.RenderingIntentFlag.PRINT);gt.displayReadyCapability||(gt.displayReadyCapability=new _util.PromiseCapability,gt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(s=this._stats)==null||s.time("Page Request"),this._pumpOperatorList(lt));const Pt=o=>{var d,_;gt.renderTasks.delete(E),(this._maybeCleanupAfterRender||wt)&&tt(this,l,!0),G(this,y,he).call(this,!wt),o?(E.capability.reject(o),this._abortOperatorList({intentState:gt,reason:o instanceof Error?o:new Error(o)})):E.capability.resolve(),(d=this._stats)==null||d.timeEnd("Rendering"),(_=this._stats)==null||_.timeEnd("Overall")},E=new InternalRenderTask({callback:Pt,params:{canvasContext:r,viewport:x,transform:X,background:w},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:nt,operatorList:gt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!wt,pdfBug:this._pdfBug,pageColors:at});(gt.renderTasks||(gt.renderTasks=new Set)).add(E);const i=E.task;return Promise.all([gt.displayReadyCapability.promise,$]).then(([o,d])=>{var _;if(this.destroyed){Pt();return}(_=this._stats)==null||_.time("Rendering"),E.initializeGraphics({transparency:o,optionalContentConfig:d}),E.operatorListChanged()}).catch(Pt),i}getOperatorList({intent:r="display",annotationMode:x=_util.AnnotationMode.ENABLE,printAnnotationStorage:m=null}={}){var nt;function j(){w.operatorList.lastChunk&&(w.opListReadCapability.resolve(w.operatorList),w.renderTasks.delete($))}const X=this._transport.getRenderingIntent(r,x,m,!0);let w=this._intentStates.get(X.cacheKey);w||(w=Object.create(null),this._intentStates.set(X.cacheKey,w));let $;return w.opListReadCapability||($=Object.create(null),$.operatorListChanged=j,w.opListReadCapability=new _util.PromiseCapability,(w.renderTasks||(w.renderTasks=new Set)).add($),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(nt=this._stats)==null||nt.time("Page Request"),this._pumpOperatorList(X)),w.opListReadCapability.promise}streamTextContent({includeMarkedContent:r=!1,disableNormalization:x=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:r===!0,disableNormalization:x===!0},{highWaterMark:100,size(j){return j.items.length}})}getTextContent(r={}){if(this._transport._htmlForXfa)return this.getXfa().then(m=>_xfa_text.XfaText.textContent(m));const x=this.streamTextContent(r);return new Promise(function(m,j){function X(){w.read().then(function({value:nt,done:at}){if(at){m($);return}Object.assign($.styles,nt.styles),$.items.push(...nt.items),X()},j)}const w=x.getReader(),$={items:[],styles:Object.create(null)};X()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const r=[];for(const x of this._intentStates.values())if(this._abortOperatorList({intentState:x,reason:new Error("Page was destroyed."),force:!0}),!x.opListReadCapability)for(const m of x.renderTasks)r.push(m.completed),m.cancel();return this.objs.clear(),tt(this,l,!1),G(this,U,Ee).call(this),Promise.all(r)}cleanup(r=!1){tt(this,l,!0);const x=G(this,y,he).call(this,!1);return r&&x&&this._stats&&(this._stats=new _display_utils.StatTimer),x}_startRenderPage(r,x){var j,X;const m=this._intentStates.get(x);m&&((j=this._stats)==null||j.timeEnd("Page Request"),(X=m.displayReadyCapability)==null||X.resolve(r))}_renderPageChunk(r,x){for(let m=0,j=r.length;m<j;m++)x.operatorList.fnArray.push(r.fnArray[m]),x.operatorList.argsArray.push(r.argsArray[m]);x.operatorList.lastChunk=r.lastChunk,x.operatorList.separateAnnots=r.separateAnnots;for(const m of x.renderTasks)m.operatorListChanged();r.lastChunk&&G(this,y,he).call(this,!0)}_pumpOperatorList({renderingIntent:r,cacheKey:x,annotationStorageSerializable:m}){const{map:j,transfers:X}=m,$=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:r,cacheKey:x,annotationStorage:j},X).getReader(),nt=this._intentStates.get(x);nt.streamReader=$;const at=()=>{$.read().then(({value:W,done:lt})=>{if(lt){nt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(W,nt),at())},W=>{if(nt.streamReader=null,!this._transport.destroyed){if(nt.operatorList){nt.operatorList.lastChunk=!0;for(const lt of nt.renderTasks)lt.operatorListChanged();G(this,y,he).call(this,!0)}if(nt.displayReadyCapability)nt.displayReadyCapability.reject(W);else if(nt.opListReadCapability)nt.opListReadCapability.reject(W);else throw W}})};at()}_abortOperatorList({intentState:r,reason:x,force:m=!1}){if(r.streamReader){if(r.streamReaderCancelTimeout&&(clearTimeout(r.streamReaderCancelTimeout),r.streamReaderCancelTimeout=null),!m){if(r.renderTasks.size>0)return;if(x instanceof _display_utils.RenderingCancelledException){let j=RENDERING_CANCELLED_TIMEOUT;x.extraDelay>0&&x.extraDelay<1e3&&(j+=x.extraDelay),r.streamReaderCancelTimeout=setTimeout(()=>{r.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:r,reason:x,force:!0})},j);return}}if(r.streamReader.cancel(new _util.AbortException(x.message)).catch(()=>{}),r.streamReader=null,!this._transport.destroyed){for(const[j,X]of this._intentStates)if(X===r){this._intentStates.delete(j);break}this.cleanup()}}}get stats(){return this._stats}}K=new WeakMap,l=new WeakMap,y=new WeakSet,he=function(r=!1){if(G(this,U,Ee).call(this),!t(this,l)||this.destroyed)return!1;if(r)return tt(this,K,setTimeout(()=>{tt(this,K,null),G(this,y,he).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:x,operatorList:m}of this._intentStates.values())if(x.size>0||!m.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),tt(this,l,!1),!0},U=new WeakSet,Ee=function(){t(this,K)&&(clearTimeout(t(this,K)),tt(this,K,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){I(this,L,new Set);I(this,P,Promise.resolve())}postMessage(r,x){const m={data:structuredClone(r,x?{transfer:x}:null)};t(this,P).then(()=>{for(const j of t(this,L))j.call(this,m)})}addEventListener(r,x){t(this,L).add(x)}removeEventListener(r,x){t(this,L).delete(x)}terminate(){t(this,L).clear()}}L=new WeakMap,P=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const g=(p=document==null?void 0:document.currentScript)==null?void 0:p.src;g&&(PDFWorkerUtil.fallbackWorkerSrc=g.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(g,r){let x;try{if(x=new URL(g),!x.origin||x.origin==="null")return!1}catch{return!1}const m=new URL(r,x);return x.origin===m.origin},PDFWorkerUtil.createCDNWrapper=function(g){const r=`importScripts("${g}");`;return URL.createObjectURL(new Blob([r]))}}const _PDFWorker=class _PDFWorker{constructor({name:g=null,port:r=null,verbosity:x=(0,_util.getVerbosityLevel)()}={}){var m;if(this.name=g,this.destroyed=!1,this.verbosity=x,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,r){if((m=t(_PDFWorker,O))!=null&&m.has(r))throw new Error("Cannot use more than one PDFWorker per port.");(t(_PDFWorker,O)||tt(_PDFWorker,O,new WeakMap)).set(r,this),this._initializeFromPort(r);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(g){this._port=g,this._messageHandler=new _message_handler.MessageHandler("main","worker",g),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:g}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,g)||(g=PDFWorkerUtil.createCDNWrapper(new URL(g,window.location).href));const r=new Worker(g),x=new _message_handler.MessageHandler("main","worker",r),m=()=>{r.removeEventListener("error",j),x.destroy(),r.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},j=()=>{this._webWorker||m()};r.addEventListener("error",j),x.on("test",w=>{if(r.removeEventListener("error",j),this.destroyed){m();return}w?(this._messageHandler=x,this._port=r,this._webWorker=r,this._readyCapability.resolve(),x.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),x.destroy(),r.terminate())}),x.on("ready",w=>{if(r.removeEventListener("error",j),this.destroyed){m();return}try{X()}catch{this._setupFakeWorker()}});const X=()=>{const w=new Uint8Array;x.send("test",w,[w.buffer])};X();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(g=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const r=new LoopbackPort;this._port=r;const x=`fake${PDFWorkerUtil.fakeWorkerId++}`,m=new _message_handler.MessageHandler(x+"_worker",x,r);g.setup(m,r);const j=new _message_handler.MessageHandler(x,x+"_worker",r);this._messageHandler=j,this._readyCapability.resolve(),j.send("configure",{verbosity:this.verbosity})}).catch(g=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${g.message}".`))})}destroy(){var g;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(g=t(_PDFWorker,O))==null||g.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(g){var x;if(!(g!=null&&g.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const r=(x=t(this,O))==null?void 0:x.get(g.port);if(r){if(r._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return r}return new _PDFWorker(g)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var g;try{return((g=globalThis.pdfjsWorker)==null?void 0:g.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};O=new WeakMap,I(_PDFWorker,O,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(r,x,m,j,X){I(this,u);I(this,N,new Map);I(this,k,new Map);I(this,S,new Map);I(this,v,null);this.messageHandler=r,this.loadingTask=x,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:j.ownerDocument,styleElement:j.styleElement}),this._params=j,this.canvasFactory=X.canvasFactory,this.filterFactory=X.filterFactory,this.cMapReaderFactory=X.cMapReaderFactory,this.standardFontDataFactory=X.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=m,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(r,x=_util.AnnotationMode.ENABLE,m=null,j=!1){let X=_util.RenderingIntentFlag.DISPLAY,w=_annotation_storage.SerializableEmpty;switch(r){case"any":X=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":X=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${r}`)}switch(x){case _util.AnnotationMode.DISABLE:X+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:X+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:X+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,w=(X&_util.RenderingIntentFlag.PRINT&&m instanceof _annotation_storage.PrintAnnotationStorage?m:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${x}`)}return j&&(X+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:X,cacheKey:`${X}_${w.hash}`,annotationStorageSerializable:w}}destroy(){var m;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(m=t(this,v))==null||m.reject(new Error("Worker was destroyed during onPassword callback"));const r=[];for(const j of t(this,k).values())r.push(j._destroy());t(this,k).clear(),t(this,S).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const x=this.messageHandler.sendWithPromise("Terminate",null);return r.push(x),Promise.all(r).then(()=>{var j;this.commonObjs.clear(),this.fontLoader.clear(),t(this,N).clear(),this.filterFactory.destroy(),(j=this._networkStream)==null||j.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:r,loadingTask:x}=this;r.on("GetReader",(m,j)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=X=>{this._lastProgress={loaded:X.loaded,total:X.total}},j.onPull=()=>{this._fullReader.read().then(function({value:X,done:w}){if(w){j.close();return}(0,_util.assert)(X instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),j.enqueue(new Uint8Array(X),1,[X])}).catch(X=>{j.error(X)})},j.onCancel=X=>{this._fullReader.cancel(X),j.ready.catch(w=>{if(!this.destroyed)throw w})}}),r.on("ReaderHeadersReady",m=>{const j=new _util.PromiseCapability,X=this._fullReader;return X.headersReady.then(()=>{var w;(!X.isStreamingSupported||!X.isRangeSupported)&&(this._lastProgress&&((w=x.onProgress)==null||w.call(x,this._lastProgress)),X.onProgress=$=>{var nt;(nt=x.onProgress)==null||nt.call(x,{loaded:$.loaded,total:$.total})}),j.resolve({isStreamingSupported:X.isStreamingSupported,isRangeSupported:X.isRangeSupported,contentLength:X.contentLength})},j.reject),j.promise}),r.on("GetRangeReader",(m,j)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const X=this._networkStream.getRangeReader(m.begin,m.end);if(!X){j.close();return}j.onPull=()=>{X.read().then(function({value:w,done:$}){if($){j.close();return}(0,_util.assert)(w instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),j.enqueue(new Uint8Array(w),1,[w])}).catch(w=>{j.error(w)})},j.onCancel=w=>{X.cancel(w),j.ready.catch($=>{if(!this.destroyed)throw $})}}),r.on("GetDoc",({pdfInfo:m})=>{this._numPages=m.numPages,this._htmlForXfa=m.htmlForXfa,delete m.htmlForXfa,x._capability.resolve(new PDFDocumentProxy(m,this))}),r.on("DocException",function(m){let j;switch(m.name){case"PasswordException":j=new _util.PasswordException(m.message,m.code);break;case"InvalidPDFException":j=new _util.InvalidPDFException(m.message);break;case"MissingPDFException":j=new _util.MissingPDFException(m.message);break;case"UnexpectedResponseException":j=new _util.UnexpectedResponseException(m.message,m.status);break;case"UnknownErrorException":j=new _util.UnknownErrorException(m.message,m.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}x._capability.reject(j)}),r.on("PasswordRequest",m=>{if(tt(this,v,new _util.PromiseCapability),x.onPassword){const j=X=>{X instanceof Error?t(this,v).reject(X):t(this,v).resolve({password:X})};try{x.onPassword(j,m.code)}catch(X){t(this,v).reject(X)}}else t(this,v).reject(new _util.PasswordException(m.message,m.code));return t(this,v).promise}),r.on("DataLoaded",m=>{var j;(j=x.onProgress)==null||j.call(x,{loaded:m.length,total:m.length}),this.downloadInfoCapability.resolve(m)}),r.on("StartRenderPage",m=>{if(this.destroyed)return;t(this,k).get(m.pageIndex)._startRenderPage(m.transparency,m.cacheKey)}),r.on("commonobj",([m,j,X])=>{var w;if(!this.destroyed&&!this.commonObjs.has(m))switch(j){case"Font":const $=this._params;if("error"in X){const W=X.error;(0,_util.warn)(`Error during font loading: ${W}`),this.commonObjs.resolve(m,W);break}const nt=$.pdfBug&&((w=globalThis.FontInspector)!=null&&w.enabled)?(W,lt)=>globalThis.FontInspector.fontAdded(W,lt):null,at=new _font_loader.FontFaceObject(X,{isEvalSupported:$.isEvalSupported,disableFontFace:$.disableFontFace,ignoreErrors:$.ignoreErrors,inspectFont:nt});this.fontLoader.bind(at).catch(W=>r.sendWithPromise("FontFallback",{id:m})).finally(()=>{!$.fontExtraProperties&&at.data&&(at.data=null),this.commonObjs.resolve(m,at)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(m,X);break;default:throw new Error(`Got unknown common object type ${j}`)}}),r.on("obj",([m,j,X,w])=>{var nt;if(this.destroyed)return;const $=t(this,k).get(j);if(!$.objs.has(m))switch(X){case"Image":if($.objs.resolve(m,w),w){let at;if(w.bitmap){const{width:W,height:lt}=w;at=W*lt*4}else at=((nt=w.data)==null?void 0:nt.length)||0;at>_util.MAX_IMAGE_SIZE_TO_CACHE&&($._maybeCleanupAfterRender=!0)}break;case"Pattern":$.objs.resolve(m,w);break;default:throw new Error(`Got unknown object type ${X}`)}}),r.on("DocProgress",m=>{var j;this.destroyed||(j=x.onProgress)==null||j.call(x,{loaded:m.loaded,total:m.total})}),r.on("FetchBuiltInCMap",m=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(m):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),r.on("FetchStandardFontData",m=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(m):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var m;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:r,transfers:x}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:((m=this._fullReader)==null?void 0:m.filename)??null},x).finally(()=>{this.annotationStorage.resetModified()})}getPage(r){if(!Number.isInteger(r)||r<=0||r>this._numPages)return Promise.reject(new Error("Invalid page request."));const x=r-1,m=t(this,S).get(x);if(m)return m;const j=this.messageHandler.sendWithPromise("GetPage",{pageIndex:x}).then(X=>{if(this.destroyed)throw new Error("Transport destroyed");const w=new PDFPageProxy(x,X,this,this._params.pdfBug);return t(this,k).set(x,w),w});return t(this,S).set(x,j),j}getPageIndex(r){return typeof r!="object"||r===null||!Number.isInteger(r.num)||r.num<0||!Number.isInteger(r.gen)||r.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:r.num,gen:r.gen})}getAnnotations(r,x){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:r,intent:x})}getFieldObjects(){return G(this,u,we).call(this,"GetFieldObjects")}hasJSActions(){return G(this,u,we).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(r){return typeof r!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:r})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return G(this,u,we).call(this,"GetDocJSActions")}getPageJSActions(r){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:r})}getStructTree(r){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:r})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(r=>new _optional_content_config.OptionalContentConfig(r))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const r="GetMetadata",x=t(this,N).get(r);if(x)return x;const m=this.messageHandler.sendWithPromise(r,null).then(j=>{var X,w;return{info:j[0],metadata:j[1]?new _metadata.Metadata(j[1]):null,contentDispositionFilename:((X=this._fullReader)==null?void 0:X.filename)??null,contentLength:((w=this._fullReader)==null?void 0:w.contentLength)??null}});return t(this,N).set(r,m),m}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(r=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const x of t(this,k).values())if(!x.cleanup())throw new Error(`startCleanup: Page ${x.pageNumber} is currently rendering.`);this.commonObjs.clear(),r||this.fontLoader.clear(),t(this,N).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:r,enableXfa:x}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:r,enableXfa:x})}}N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakSet,we=function(r,x=null){const m=t(this,N).get(r);if(m)return m;const j=this.messageHandler.sendWithPromise(r,x);return t(this,N).set(r,j),j};class PDFObjects{constructor(){I(this,T);I(this,C,Object.create(null))}get(r,x=null){if(x){const j=G(this,T,Be).call(this,r);return j.capability.promise.then(()=>x(j.data)),null}const m=t(this,C)[r];if(!(m!=null&&m.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${r}.`);return m.data}has(r){const x=t(this,C)[r];return(x==null?void 0:x.capability.settled)||!1}resolve(r,x=null){const m=G(this,T,Be).call(this,r);m.data=x,m.capability.resolve()}clear(){var r;for(const x in t(this,C)){const{data:m}=t(this,C)[x];(r=m==null?void 0:m.bitmap)==null||r.close()}tt(this,C,Object.create(null))}}C=new WeakMap,T=new WeakSet,Be=function(r){var x;return(x=t(this,C))[r]||(x[r]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(r){I(this,a,null);tt(this,a,r),this.onContinue=null}get promise(){return t(this,a).capability.promise}cancel(r=0){t(this,a).cancel(null,r)}get separateAnnots(){const{separateAnnots:r}=t(this,a).operatorList;if(!r)return!1;const{annotationCanvasMap:x}=t(this,a);return r.form||r.canvas&&(x==null?void 0:x.size)>0}}a=new WeakMap,exports.RenderTask=RenderTask;const F=class F{constructor({callback:r,params:x,objs:m,commonObjs:j,annotationCanvasMap:X,operatorList:w,pageIndex:$,canvasFactory:nt,filterFactory:at,useRequestAnimationFrame:W=!1,pdfBug:lt=!1,pageColors:gt=null}){this.callback=r,this.params=x,this.objs=m,this.commonObjs=j,this.annotationCanvasMap=X,this.operatorListIdx=null,this.operatorList=w,this._pageIndex=$,this.canvasFactory=nt,this.filterFactory=at,this._pdfBug=lt,this.pageColors=gt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=W===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=x.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:r=!1,optionalContentConfig:x}){var $,nt;if(this.cancelled)return;if(this._canvas){if(t(F,h).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");t(F,h).add(this._canvas)}this._pdfBug&&(($=globalThis.StepperManager)!=null&&$.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:m,viewport:j,transform:X,background:w}=this.params;this.gfx=new _canvas.CanvasGraphics(m,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:x},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:X,viewport:j,transparency:r,background:w}),this.operatorListIdx=0,this.graphicsReady=!0,(nt=this.graphicsReadyCallback)==null||nt.call(this)}cancel(r=null,x=0){var m;this.running=!1,this.cancelled=!0,(m=this.gfx)==null||m.endDrawing(),t(F,h).delete(this._canvas),this.callback(r||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,x))}operatorListChanged(){var r;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(r=this.stepper)==null||r.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),t(F,h).delete(this._canvas),this.callback())))}};h=new WeakMap,I(F,h,new WeakSet);let InternalRenderTask=F;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(ft,c,K)=>{var P,p,O,Ai,k;Object.defineProperty(c,"__esModule",{value:!0}),c.SerializableEmpty=c.PrintAnnotationStorage=c.AnnotationStorage=void 0;var l=K(1),y=K(4),it=K(8);const U=Object.freeze({map:null,hash:"",transfers:void 0});c.SerializableEmpty=U;class ct{constructor(){I(this,O);I(this,P,!1);I(this,p,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(v,u){const b=t(this,p).get(v);return b===void 0?u:Object.assign(u,b)}getRawValue(v){return t(this,p).get(v)}remove(v){if(t(this,p).delete(v),t(this,p).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const u of t(this,p).values())if(u instanceof y.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(v,u){const b=t(this,p).get(v);let C=!1;if(b!==void 0)for(const[T,A]of Object.entries(u))b[T]!==A&&(C=!0,b[T]=A);else C=!0,t(this,p).set(v,u);C&&G(this,O,Ai).call(this),u instanceof y.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(u.constructor._type)}has(v){return t(this,p).has(v)}getAll(){return t(this,p).size>0?(0,l.objectFromMap)(t(this,p)):null}setAll(v){for(const[u,b]of Object.entries(v))this.setValue(u,b)}get size(){return t(this,p).size}resetModified(){t(this,P)&&(tt(this,P,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new L(this)}get serializable(){if(t(this,p).size===0)return U;const v=new Map,u=new it.MurmurHash3_64,b=[],C=Object.create(null);let T=!1;for(const[A,a]of t(this,p)){const h=a instanceof y.AnnotationEditor?a.serialize(!1,C):a;h&&(v.set(A,h),u.update(`${A}:${JSON.stringify(h)}`),T||(T=!!h.bitmap))}if(T)for(const A of v.values())A.bitmap&&b.push(A.bitmap);return v.size>0?{map:v,hash:u.hexdigest(),transfers:b}:U}}P=new WeakMap,p=new WeakMap,O=new WeakSet,Ai=function(){t(this,P)||(tt(this,P,!0),typeof this.onSetModified=="function"&&this.onSetModified())},c.AnnotationStorage=ct;class L extends ct{constructor(u){super();I(this,k,void 0);const{map:b,hash:C,transfers:T}=u.serializable,A=structuredClone(b,T?{transfer:T}:null);tt(this,k,{map:A,hash:C,transfers:T})}get print(){(0,l.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return t(this,k)}}k=new WeakMap,c.PrintAnnotationStorage=L},(ft,c,K)=>{var L,P,p,O,N,k,S,v,u,b,C,T,A,a,h,Ue,g,je,x,He,j,We,w,yi,nt,vi,W,Si,gt,Ge,Pt,Ei;Object.defineProperty(c,"__esModule",{value:!0}),c.AnnotationEditor=void 0;var l=K(5),y=K(1),it=K(6);const i=class i{constructor(s){I(this,h);I(this,g);I(this,j);I(this,w);I(this,nt);I(this,W);I(this,gt);I(this,Pt);I(this,L,"");I(this,P,!1);I(this,p,null);I(this,O,null);I(this,N,null);I(this,k,!1);I(this,S,null);I(this,v,this.focusin.bind(this));I(this,u,this.focusout.bind(this));I(this,b,!1);I(this,C,!1);I(this,T,!1);ee(this,"_initialOptions",Object.create(null));ee(this,"_uiManager",null);ee(this,"_focusEventsAllowed",!0);ee(this,"_l10nPromise",null);I(this,A,!1);I(this,a,i._zIndex++);this.constructor===i&&(0,y.unreachable)("Cannot initialize AnnotationEditor."),this.parent=s.parent,this.id=s.id,this.width=this.height=null,this.pageIndex=s.parent.pageIndex,this.name=s.name,this.div=null,this._uiManager=s.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=s.isCentered,this._structTreeParentId=null;const{rotation:o,rawDims:{pageWidth:d,pageHeight:_,pageX:M,pageY:B}}=this.parent.viewport;this.rotation=o,this.pageRotation=(360+o-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[d,_],this.pageTranslation=[M,B];const[et,Z]=this.parentDimensions;this.x=s.x/et,this.y=s.y/Z,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,y.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(s){const o=new ct({id:s.parent.getNextId(),parent:s.parent,uiManager:s._uiManager});o.annotationElementId=s.annotationElementId,o.deleted=!0,o._uiManager.addToAnnotationStorage(o)}static initialize(s,o=null){if(i._l10nPromise||(i._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(_=>[_,s.get(_)]))),o!=null&&o.strings)for(const _ of o.strings)i._l10nPromise.set(_,s.get(_));if(i._borderLineWidth!==-1)return;const d=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(d.getPropertyValue("--outline-width"))||0}static updateDefaultParams(s,o){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(s){return!1}static paste(s,o){(0,y.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return t(this,A)}set _isDraggable(s){var o;tt(this,A,s),(o=this.div)==null||o.classList.toggle("draggable",s)}center(){const[s,o]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*o/(s*2),this.y+=this.width*s/(o*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*o/(s*2),this.y-=this.width*s/(o*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(s){this._uiManager.addCommands(s)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=t(this,a)}setParent(s){s!==null&&(this.pageIndex=s.pageIndex,this.pageDimensions=s.pageDimensions),this.parent=s}focusin(s){this._focusEventsAllowed&&(t(this,b)?tt(this,b,!1):this.parent.setSelected(this))}focusout(s){var d;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const o=s.relatedTarget;o!=null&&o.closest(`#${this.id}`)||(s.preventDefault(),(d=this.parent)!=null&&d.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(s,o,d,_){const[M,B]=this.parentDimensions;[d,_]=this.screenToPageTranslation(d,_),this.x=(s+d)/M,this.y=(o+_)/B,this.fixAndSetPosition()}translate(s,o){G(this,h,Ue).call(this,this.parentDimensions,s,o)}translateInPage(s,o){G(this,h,Ue).call(this,this.pageDimensions,s,o),this.div.scrollIntoView({block:"nearest"})}drag(s,o){const[d,_]=this.parentDimensions;if(this.x+=s/d,this.y+=o/_,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:rt,y:ht}=this.div.getBoundingClientRect();this.parent.findNewParent(this,rt,ht)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:M,y:B}=this;const[et,Z]=G(this,g,je).call(this);M+=et,B+=Z,this.div.style.left=`${(100*M).toFixed(2)}%`,this.div.style.top=`${(100*B).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[s,o]=this.pageDimensions;let{x:d,y:_,width:M,height:B}=this;switch(M*=s,B*=o,d*=s,_*=o,this.rotation){case 0:d=Math.max(0,Math.min(s-M,d)),_=Math.max(0,Math.min(o-B,_));break;case 90:d=Math.max(0,Math.min(s-B,d)),_=Math.min(o,Math.max(M,_));break;case 180:d=Math.min(s,Math.max(M,d)),_=Math.min(o,Math.max(B,_));break;case 270:d=Math.min(s,Math.max(B,d)),_=Math.max(0,Math.min(o-M,_));break}this.x=d/=s,this.y=_/=o;const[et,Z]=G(this,g,je).call(this);d+=et,_+=Z;const{style:rt}=this.div;rt.left=`${(100*d).toFixed(2)}%`,rt.top=`${(100*_).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(s,o){var d;return G(d=i,x,He).call(d,s,o,this.parentRotation)}pageTranslationToScreen(s,o){var d;return G(d=i,x,He).call(d,s,o,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:s,pageDimensions:[o,d]}=this,_=o*s,M=d*s;return y.FeatureTest.isCSSRoundSupported?[Math.round(_),Math.round(M)]:[_,M]}setDims(s,o){var M;const[d,_]=this.parentDimensions;this.div.style.width=`${(100*s/d).toFixed(2)}%`,t(this,k)||(this.div.style.height=`${(100*o/_).toFixed(2)}%`),(M=t(this,p))==null||M.classList.toggle("small",s<i.SMALL_EDITOR_SIZE||o<i.SMALL_EDITOR_SIZE)}fixDims(){const{style:s}=this.div,{height:o,width:d}=s,_=d.endsWith("%"),M=!t(this,k)&&o.endsWith("%");if(_&&M)return;const[B,et]=this.parentDimensions;_||(s.width=`${(100*parseFloat(d)/B).toFixed(2)}%`),!t(this,k)&&!M&&(s.height=`${(100*parseFloat(o)/et).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(t(this,p))return;const s=tt(this,p,document.createElement("button"));s.className="altText";const o=await i._l10nPromise.get("editor_alt_text_button_label");s.textContent=o,s.setAttribute("aria-label",o),s.tabIndex="0",s.addEventListener("contextmenu",it.noContextMenu),s.addEventListener("pointerdown",d=>d.stopPropagation()),s.addEventListener("click",d=>{d.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),s.addEventListener("keydown",d=>{d.target===s&&d.key==="Enter"&&(d.preventDefault(),this._uiManager.editAltText(this))}),G(this,gt,Ge).call(this),this.div.append(s),i.SMALL_EDITOR_SIZE||(i.SMALL_EDITOR_SIZE=Math.min(128,Math.round(s.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:t(this,L),decorative:t(this,P)}}set altTextData({altText:s,decorative:o}){t(this,L)===s&&t(this,P)===o||(tt(this,L,s),tt(this,P,o),G(this,gt,Ge).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",t(this,v)),this.div.addEventListener("focusout",t(this,u));const[s,o]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*o/s).toFixed(2)}%`,this.div.style.maxHeight=`${(100*s/o).toFixed(2)}%`);const[d,_]=this.getInitialTranslation();return this.translate(d,_),(0,l.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(s){const{isMac:o}=y.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&o){s.preventDefault();return}tt(this,b,!0),G(this,Pt,Ei).call(this,s)}moveInDOM(){var s;(s=this.parent)==null||s.moveEditorInDOM(this)}_setParentAndPosition(s,o,d){s.changeParent(this),this.x=o,this.y=d,this.fixAndSetPosition()}getRect(s,o){const d=this.parentScale,[_,M]=this.pageDimensions,[B,et]=this.pageTranslation,Z=s/d,rt=o/d,ht=this.x*_,yt=this.y*M,ut=this.width*_,Ft=this.height*M;switch(this.rotation){case 0:return[ht+Z+B,M-yt-rt-Ft+et,ht+Z+ut+B,M-yt-rt+et];case 90:return[ht+rt+B,M-yt+Z+et,ht+rt+Ft+B,M-yt+Z+ut+et];case 180:return[ht-Z-ut+B,M-yt+rt+et,ht-Z+B,M-yt+rt+Ft+et];case 270:return[ht-rt-Ft+B,M-yt-Z-ut+et,ht-rt+B,M-yt-Z+et];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(s,o){const[d,_,M,B]=s,et=M-d,Z=B-_;switch(this.rotation){case 0:return[d,o-B,et,Z];case 90:return[d,o-_,Z,et];case 180:return[M,o-_,et,Z];case 270:return[M,o-B,Z,et];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){tt(this,T,!0)}disableEditMode(){tt(this,T,!1)}isInEditMode(){return t(this,T)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var s,o;(s=this.div)==null||s.addEventListener("focusin",t(this,v)),(o=this.div)==null||o.addEventListener("focusout",t(this,u))}serialize(s=!1,o=null){(0,y.unreachable)("An editor must be serializable")}static deserialize(s,o,d){const _=new this.prototype.constructor({parent:o,id:o.getNextId(),uiManager:d});_.rotation=s.rotation;const[M,B]=_.pageDimensions,[et,Z,rt,ht]=_.getRectInCurrentCoords(s.rect,B);return _.x=et/M,_.y=Z/B,_.width=rt/M,_.height=ht/B,_}remove(){var s;this.div.removeEventListener("focusin",t(this,v)),this.div.removeEventListener("focusout",t(this,u)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(s=t(this,p))==null||s.remove(),tt(this,p,null),tt(this,O,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(G(this,w,yi).call(this),t(this,S).classList.remove("hidden"))}select(){var s;this.makeResizable(),(s=this.div)==null||s.classList.add("selectedEditor")}unselect(){var s,o,d;(s=t(this,S))==null||s.classList.add("hidden"),(o=this.div)==null||o.classList.remove("selectedEditor"),(d=this.div)!=null&&d.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(s,o){}disableEditing(){t(this,p)&&(t(this,p).hidden=!0)}enableEditing(){t(this,p)&&(t(this,p).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return t(this,C)}set isEditing(s){tt(this,C,s),this.parent&&(s?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(s,o){tt(this,k,!0);const d=s/o,{style:_}=this.div;_.aspectRatio=d,_.height="auto"}static get MIN_SIZE(){return 16}};L=new WeakMap,P=new WeakMap,p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakMap,C=new WeakMap,T=new WeakMap,A=new WeakMap,a=new WeakMap,h=new WeakSet,Ue=function([s,o],d,_){[d,_]=this.screenToPageTranslation(d,_),this.x+=d/s,this.y+=_/o,this.fixAndSetPosition()},g=new WeakSet,je=function(){const[s,o]=this.parentDimensions,{_borderLineWidth:d}=i,_=d/s,M=d/o;switch(this.rotation){case 90:return[-_,M];case 180:return[_,M];case 270:return[_,-M];default:return[-_,-M]}},x=new WeakSet,He=function(s,o,d){switch(d){case 90:return[o,-s];case 180:return[-s,-o];case 270:return[-o,s];default:return[s,o]}},j=new WeakSet,We=function(s){switch(s){case 90:{const[o,d]=this.pageDimensions;return[0,-o/d,d/o,0]}case 180:return[-1,0,0,-1];case 270:{const[o,d]=this.pageDimensions;return[0,o/d,-d/o,0]}default:return[1,0,0,1]}},w=new WeakSet,yi=function(){if(t(this,S))return;tt(this,S,document.createElement("div")),t(this,S).classList.add("resizers");const s=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||s.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const o of s){const d=document.createElement("div");t(this,S).append(d),d.classList.add("resizer",o),d.addEventListener("pointerdown",G(this,nt,vi).bind(this,o)),d.addEventListener("contextmenu",it.noContextMenu)}this.div.prepend(t(this,S))},nt=new WeakSet,vi=function(s,o){o.preventDefault();const{isMac:d}=y.FeatureTest.platform;if(o.button!==0||o.ctrlKey&&d)return;const _=G(this,W,Si).bind(this,s),M=this._isDraggable;this._isDraggable=!1;const B={passive:!0,capture:!0};window.addEventListener("pointermove",_,B);const et=this.x,Z=this.y,rt=this.width,ht=this.height,yt=this.parent.div.style.cursor,ut=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(o.target).cursor;const Ft=()=>{this._isDraggable=M,window.removeEventListener("pointerup",Ft),window.removeEventListener("blur",Ft),window.removeEventListener("pointermove",_,B),this.parent.div.style.cursor=yt,this.div.style.cursor=ut;const Bt=this.x,St=this.y,Dt=this.width,pt=this.height;Bt===et&&St===Z&&Dt===rt&&pt===ht||this.addCommands({cmd:()=>{this.width=Dt,this.height=pt,this.x=Bt,this.y=St;const[J,Q]=this.parentDimensions;this.setDims(J*Dt,Q*pt),this.fixAndSetPosition()},undo:()=>{this.width=rt,this.height=ht,this.x=et,this.y=Z;const[J,Q]=this.parentDimensions;this.setDims(J*rt,Q*ht),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Ft),window.addEventListener("blur",Ft)},W=new WeakSet,Si=function(s,o){const[d,_]=this.parentDimensions,M=this.x,B=this.y,et=this.width,Z=this.height,rt=i.MIN_SIZE/d,ht=i.MIN_SIZE/_,yt=_t=>Math.round(_t*1e4)/1e4,ut=G(this,j,We).call(this,this.rotation),Ft=(_t,At)=>[ut[0]*_t+ut[2]*At,ut[1]*_t+ut[3]*At],Bt=G(this,j,We).call(this,360-this.rotation),St=(_t,At)=>[Bt[0]*_t+Bt[2]*At,Bt[1]*_t+Bt[3]*At];let Dt,pt,J=!1,Q=!1;switch(s){case"topLeft":J=!0,Dt=(_t,At)=>[0,0],pt=(_t,At)=>[_t,At];break;case"topMiddle":Dt=(_t,At)=>[_t/2,0],pt=(_t,At)=>[_t/2,At];break;case"topRight":J=!0,Dt=(_t,At)=>[_t,0],pt=(_t,At)=>[0,At];break;case"middleRight":Q=!0,Dt=(_t,At)=>[_t,At/2],pt=(_t,At)=>[0,At/2];break;case"bottomRight":J=!0,Dt=(_t,At)=>[_t,At],pt=(_t,At)=>[0,0];break;case"bottomMiddle":Dt=(_t,At)=>[_t/2,At],pt=(_t,At)=>[_t/2,0];break;case"bottomLeft":J=!0,Dt=(_t,At)=>[0,At],pt=(_t,At)=>[_t,0];break;case"middleLeft":Q=!0,Dt=(_t,At)=>[0,At/2],pt=(_t,At)=>[_t,At/2];break}const dt=Dt(et,Z),Et=pt(et,Z);let Ct=Ft(...Et);const jt=yt(M+Ct[0]),Gt=yt(B+Ct[1]);let Ht=1,Xt=1,[$t,Wt]=this.screenToPageTranslation(o.movementX,o.movementY);if([$t,Wt]=St($t/d,Wt/_),J){const _t=Math.hypot(et,Z);Ht=Xt=Math.max(Math.min(Math.hypot(Et[0]-dt[0]-$t,Et[1]-dt[1]-Wt)/_t,1/et,1/Z),rt/et,ht/Z)}else Q?Ht=Math.max(rt,Math.min(1,Math.abs(Et[0]-dt[0]-$t)))/et:Xt=Math.max(ht,Math.min(1,Math.abs(Et[1]-dt[1]-Wt)))/Z;const qt=yt(et*Ht),ot=yt(Z*Xt);Ct=Ft(...pt(qt,ot));const Y=jt-Ct[0],z=Gt-Ct[1];this.width=qt,this.height=ot,this.x=Y,this.y=z,this.setDims(d*qt,_*ot),this.fixAndSetPosition()},gt=new WeakSet,Ge=async function(){var d;const s=t(this,p);if(!s)return;if(!t(this,L)&&!t(this,P)){s.classList.remove("done"),(d=t(this,O))==null||d.remove();return}i._l10nPromise.get("editor_alt_text_edit_button_label").then(_=>{s.setAttribute("aria-label",_)});let o=t(this,O);if(!o){tt(this,O,o=document.createElement("span")),o.className="tooltip",o.setAttribute("role","tooltip");const _=o.id=`alt-text-tooltip-${this.id}`;s.setAttribute("aria-describedby",_);const M=100;s.addEventListener("mouseenter",()=>{tt(this,N,setTimeout(()=>{tt(this,N,null),t(this,O).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},M))}),s.addEventListener("mouseleave",()=>{var B;clearTimeout(t(this,N)),tt(this,N,null),(B=t(this,O))==null||B.classList.remove("show")})}s.classList.add("done"),o.innerText=t(this,P)?await i._l10nPromise.get("editor_alt_text_decorative_tooltip"):t(this,L),o.parentNode||s.append(o)},Pt=new WeakSet,Ei=function(s){if(!this._isDraggable)return;const o=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let d,_;o&&(d={passive:!0,capture:!0},_=B=>{const[et,Z]=this.screenToPageTranslation(B.movementX,B.movementY);this._uiManager.dragSelectedEditors(et,Z)},window.addEventListener("pointermove",_,d));const M=()=>{if(window.removeEventListener("pointerup",M),window.removeEventListener("blur",M),o&&window.removeEventListener("pointermove",_,d),tt(this,b,!1),!this._uiManager.endDragSession()){const{isMac:B}=y.FeatureTest.platform;s.ctrlKey&&!B||s.shiftKey||s.metaKey&&B?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",M),window.addEventListener("blur",M)},I(i,x),ee(i,"_borderLineWidth",-1),ee(i,"_colorManager",new l.ColorManager),ee(i,"_zIndex",1),ee(i,"SMALL_EDITOR_SIZE",0);let U=i;c.AnnotationEditor=U;class ct extends U{constructor(s){super(s),this.annotationElementId=s.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(ft,c,K)=>{var k,S,v,u,b,ze,A,a,h,F,g,wi,m,j,X,w,$,nt,at,W,lt,gt,wt,Pt,E,i,n,s,o,d,_,M,B,et,Z,rt,ht,yt,ut,Ft,Bt,St,Dt,pt,J,Q,dt,Ci,Ct,Xe,Gt,$e,Xt,Ce,Wt,Ve,ot,qe,z,re,At,me,Zt,Ti,vt,xi,Tt,Ye,Nt,_e,bt,Ke;Object.defineProperty(c,"__esModule",{value:!0}),c.KeyboardManager=c.CommandManager=c.ColorManager=c.AnnotationEditorUIManager=void 0,c.bindEvents=it,c.opacityToHex=U;var l=K(1),y=K(6);function it(R,e,f){for(const D of f)e.addEventListener(D,R[D].bind(R))}function U(R){return Math.round(Math.min(255,Math.max(1,255*R))).toString(16).padStart(2,"0")}class ct{constructor(){I(this,k,0)}getId(){return`${l.AnnotationEditorPrefix}${ge(this,k)._++}`}}k=new WeakMap;const T=class T{constructor(){I(this,b);I(this,S,(0,l.getUuid)());I(this,v,0);I(this,u,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',D=new OffscreenCanvas(1,3).getContext("2d"),H=new Image;H.src=e;const V=H.decode().then(()=>(D.drawImage(H,0,0,1,1,0,0,1,3),new Uint32Array(D.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,l.shadow)(this,"_isSVGFittingCanvas",V)}async getFromFile(e){const{lastModified:f,name:D,size:H,type:V}=e;return G(this,b,ze).call(this,`${f}_${D}_${H}_${V}`,e)}async getFromUrl(e){return G(this,b,ze).call(this,e,e)}async getFromId(e){t(this,u)||tt(this,u,new Map);const f=t(this,u).get(e);return f?f.bitmap?(f.refCounter+=1,f):f.file?this.getFromFile(f.file):this.getFromUrl(f.url):null}getSvgUrl(e){const f=t(this,u).get(e);return f!=null&&f.isSvg?f.svgUrl:null}deleteId(e){t(this,u)||tt(this,u,new Map);const f=t(this,u).get(e);f&&(f.refCounter-=1,f.refCounter===0&&(f.bitmap=null))}isValidId(e){return e.startsWith(`image_${t(this,S)}_`)}};S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakSet,ze=async function(e,f){t(this,u)||tt(this,u,new Map);let D=t(this,u).get(e);if(D===null)return null;if(D!=null&&D.bitmap)return D.refCounter+=1,D;try{D||(D={bitmap:null,id:`image_${t(this,S)}_${ge(this,v)._++}`,refCounter:0,isSvg:!1});let H;if(typeof f=="string"){D.url=f;const V=await fetch(f);if(!V.ok)throw new Error(V.statusText);H=await V.blob()}else H=D.file=f;if(H.type==="image/svg+xml"){const V=T._isSVGFittingCanvas,st=new FileReader,mt=new Image,kt=new Promise((xt,zt)=>{mt.onload=()=>{D.bitmap=mt,D.isSvg=!0,xt()},st.onload=async()=>{const Mt=D.svgUrl=st.result;mt.src=await V?`${Mt}#svgView(preserveAspectRatio(none))`:Mt},mt.onerror=st.onerror=zt});st.readAsDataURL(H),await kt}else D.bitmap=await createImageBitmap(H);D.refCounter=1}catch(H){console.error(H),D=null}return t(this,u).set(e,D),D&&t(this,u).set(D.id,D),D};let L=T;class P{constructor(e=128){I(this,A,[]);I(this,a,!1);I(this,h,void 0);I(this,F,-1);tt(this,h,e)}add({cmd:e,undo:f,mustExec:D,type:H=NaN,overwriteIfSameType:V=!1,keepUndo:st=!1}){if(D&&e(),t(this,a))return;const mt={cmd:e,undo:f,type:H};if(t(this,F)===-1){t(this,A).length>0&&(t(this,A).length=0),tt(this,F,0),t(this,A).push(mt);return}if(V&&t(this,A)[t(this,F)].type===H){st&&(mt.undo=t(this,A)[t(this,F)].undo),t(this,A)[t(this,F)]=mt;return}const kt=t(this,F)+1;kt===t(this,h)?t(this,A).splice(0,1):(tt(this,F,kt),kt<t(this,A).length&&t(this,A).splice(kt)),t(this,A).push(mt)}undo(){t(this,F)!==-1&&(tt(this,a,!0),t(this,A)[t(this,F)].undo(),tt(this,a,!1),tt(this,F,t(this,F)-1))}redo(){t(this,F)<t(this,A).length-1&&(tt(this,F,t(this,F)+1),tt(this,a,!0),t(this,A)[t(this,F)].cmd(),tt(this,a,!1))}hasSomethingToUndo(){return t(this,F)!==-1}hasSomethingToRedo(){return t(this,F)<t(this,A).length-1}destroy(){tt(this,A,null)}}A=new WeakMap,a=new WeakMap,h=new WeakMap,F=new WeakMap,c.CommandManager=P;class p{constructor(e){I(this,g);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:f}=l.FeatureTest.platform;for(const[D,H,V={}]of e)for(const st of D){const mt=st.startsWith("mac+");f&&mt?(this.callbacks.set(st.slice(4),{callback:H,options:V}),this.allKeys.add(st.split("+").at(-1))):!f&&!mt&&(this.callbacks.set(st,{callback:H,options:V}),this.allKeys.add(st.split("+").at(-1)))}}exec(e,f){if(!this.allKeys.has(f.key))return;const D=this.callbacks.get(G(this,g,wi).call(this,f));if(!D)return;const{callback:H,options:{bubbles:V=!1,args:st=[],checker:mt=null}}=D;mt&&!mt(e,f)||(H.bind(e,...st)(),V||(f.stopPropagation(),f.preventDefault()))}}g=new WeakSet,wi=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const f=this.buffer.join("+");return this.buffer.length=0,f},c.KeyboardManager=p;const x=class x{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,y.getColorValues)(e),(0,l.shadow)(this,"_colors",e)}convert(e){const f=(0,y.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return f;for(const[D,H]of this._colors)if(H.every((V,st)=>V===f[st]))return x._colorsMapping.get(D);return f}getHexCode(e){const f=this._colors.get(e);return f?l.Util.makeHexColor(...f):e}};ee(x,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let O=x;c.ColorManager=O;const It=class It{constructor(e,f,D,H,V,st){I(this,dt);I(this,Ct);I(this,Gt);I(this,Xt);I(this,Wt);I(this,ot);I(this,z);I(this,At);I(this,Zt);I(this,vt);I(this,Tt);I(this,Nt);I(this,bt);I(this,m,null);I(this,j,new Map);I(this,X,new Map);I(this,w,null);I(this,$,null);I(this,nt,new P);I(this,at,0);I(this,W,new Set);I(this,lt,null);I(this,gt,null);I(this,wt,new Set);I(this,Pt,null);I(this,E,new ct);I(this,i,!1);I(this,n,!1);I(this,s,null);I(this,o,l.AnnotationEditorType.NONE);I(this,d,new Set);I(this,_,null);I(this,M,this.blur.bind(this));I(this,B,this.focus.bind(this));I(this,et,this.copy.bind(this));I(this,Z,this.cut.bind(this));I(this,rt,this.paste.bind(this));I(this,ht,this.keydown.bind(this));I(this,yt,this.onEditingAction.bind(this));I(this,ut,this.onPageChanging.bind(this));I(this,Ft,this.onScaleChanging.bind(this));I(this,Bt,this.onRotationChanging.bind(this));I(this,St,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});I(this,Dt,[0,0]);I(this,pt,null);I(this,J,null);I(this,Q,null);tt(this,J,e),tt(this,Q,f),tt(this,w,D),this._eventBus=H,this._eventBus._on("editingaction",t(this,yt)),this._eventBus._on("pagechanging",t(this,ut)),this._eventBus._on("scalechanging",t(this,Ft)),this._eventBus._on("rotationchanging",t(this,Bt)),tt(this,$,V.annotationStorage),tt(this,Pt,V.filterFactory),tt(this,_,st),this.viewParameters={realScale:y.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const e=It.prototype,f=V=>{const{activeElement:st}=document;return st&&t(V,J).contains(st)&&V.hasSomethingToControl()},D=this.TRANSLATE_SMALL,H=this.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new p([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-D,0],checker:f}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-H,0],checker:f}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[D,0],checker:f}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[H,0],checker:f}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-D],checker:f}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-H],checker:f}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,D],checker:f}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,H],checker:f}]]))}destroy(){G(this,Xt,Ce).call(this),G(this,Ct,Xe).call(this),this._eventBus._off("editingaction",t(this,yt)),this._eventBus._off("pagechanging",t(this,ut)),this._eventBus._off("scalechanging",t(this,Ft)),this._eventBus._off("rotationchanging",t(this,Bt));for(const e of t(this,X).values())e.destroy();t(this,X).clear(),t(this,j).clear(),t(this,wt).clear(),tt(this,m,null),t(this,d).clear(),t(this,nt).destroy(),t(this,w).destroy()}get hcmFilter(){return(0,l.shadow)(this,"hcmFilter",t(this,_)?t(this,Pt).addHCMFilter(t(this,_).foreground,t(this,_).background):"none")}get direction(){return(0,l.shadow)(this,"direction",getComputedStyle(t(this,J)).direction)}editAltText(e){var f;(f=t(this,w))==null||f.editAltText(this,e)}onPageChanging({pageNumber:e}){tt(this,at,e-1)}focusMainContainer(){t(this,J).focus()}findParent(e,f){for(const D of t(this,X).values()){const{x:H,y:V,width:st,height:mt}=D.div.getBoundingClientRect();if(e>=H&&e<=H+st&&f>=V&&f<=V+mt)return D}return null}disableUserSelect(e=!1){t(this,Q).classList.toggle("noUserSelect",e)}addShouldRescale(e){t(this,wt).add(e)}removeShouldRescale(e){t(this,wt).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*y.PixelsPerInch.PDF_TO_CSS_UNITS;for(const f of t(this,wt))f.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&t(this,$)&&!t(this,$).has(e.id)&&t(this,$).setValue(e.id,e)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const f of t(this,d))if(f.div.contains(e)){tt(this,s,[f,e]),f._focusEventsAllowed=!1;break}}focus(){if(!t(this,s))return;const[e,f]=t(this,s);tt(this,s,null),f.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),f.focus()}addEditListeners(){G(this,Gt,$e).call(this),G(this,Wt,Ve).call(this)}removeEditListeners(){G(this,Xt,Ce).call(this),G(this,ot,qe).call(this)}copy(e){var D;if(e.preventDefault(),(D=t(this,m))==null||D.commitOrRemove(),!this.hasSelection)return;const f=[];for(const H of t(this,d)){const V=H.serialize(!0);V&&f.push(V)}f.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(f))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:f}=e;for(const V of f.items)for(const st of t(this,gt))if(st.isHandlingMimeForPasting(V.type)){st.paste(V,this.currentLayer);return}let D=f.getData("application/pdfjs");if(!D)return;try{D=JSON.parse(D)}catch(V){(0,l.warn)(`paste: "${V.message}".`);return}if(!Array.isArray(D))return;this.unselectAll();const H=this.currentLayer;try{const V=[];for(const kt of D){const xt=H.deserialize(kt);if(!xt)return;V.push(xt)}const st=()=>{for(const kt of V)G(this,Tt,Ye).call(this,kt);G(this,bt,Ke).call(this,V)},mt=()=>{for(const kt of V)kt.remove()};this.addCommands({cmd:st,undo:mt,mustExec:!0})}catch(V){(0,l.warn)(`paste: "${V.message}".`)}}keydown(e){var f;(f=this.getActive())!=null&&f.shouldGetKeyboardEvents()||It._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(G(this,dt,Ci).call(this),G(this,Gt,$e).call(this),G(this,Wt,Ve).call(this),G(this,z,re).call(this,{isEditing:t(this,o)!==l.AnnotationEditorType.NONE,isEmpty:G(this,Nt,_e).call(this),hasSomethingToUndo:t(this,nt).hasSomethingToUndo(),hasSomethingToRedo:t(this,nt).hasSomethingToRedo(),hasSelectedEditor:!1})):(G(this,Ct,Xe).call(this),G(this,Xt,Ce).call(this),G(this,ot,qe).call(this),G(this,z,re).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!t(this,gt)){tt(this,gt,e);for(const f of t(this,gt))G(this,At,me).call(this,f.defaultPropertiesToUpdate)}}getId(){return t(this,E).getId()}get currentLayer(){return t(this,X).get(t(this,at))}getLayer(e){return t(this,X).get(e)}get currentPageIndex(){return t(this,at)}addLayer(e){t(this,X).set(e.pageIndex,e),t(this,i)?e.enable():e.disable()}removeLayer(e){t(this,X).delete(e.pageIndex)}updateMode(e,f=null){if(t(this,o)!==e){if(tt(this,o,e),e===l.AnnotationEditorType.NONE){this.setEditingState(!1),G(this,vt,xi).call(this);return}this.setEditingState(!0),G(this,Zt,Ti).call(this),this.unselectAll();for(const D of t(this,X).values())D.updateMode(e);if(f){for(const D of t(this,j).values())if(D.annotationElementId===f){this.setSelected(D),D.enterInEditMode();break}}}}updateToolbar(e){e!==t(this,o)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,f){if(t(this,gt)){if(e===l.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const D of t(this,d))D.updateParams(e,f);for(const D of t(this,gt))D.updateDefaultParams(e,f)}}enableWaiting(e=!1){if(t(this,n)!==e){tt(this,n,e);for(const f of t(this,X).values())e?f.disableClick():f.enableClick(),f.div.classList.toggle("waiting",e)}}getEditors(e){const f=[];for(const D of t(this,j).values())D.pageIndex===e&&f.push(D);return f}getEditor(e){return t(this,j).get(e)}addEditor(e){t(this,j).set(e.id,e)}removeEditor(e){var f;t(this,j).delete(e.id),this.unselect(e),(!e.annotationElementId||!t(this,W).has(e.annotationElementId))&&((f=t(this,$))==null||f.remove(e.id))}addDeletedAnnotationElement(e){t(this,W).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return t(this,W).has(e)}removeDeletedAnnotationElement(e){t(this,W).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){t(this,m)!==e&&(tt(this,m,e),e&&G(this,At,me).call(this,e.propertiesToUpdate))}toggleSelected(e){if(t(this,d).has(e)){t(this,d).delete(e),e.unselect(),G(this,z,re).call(this,{hasSelectedEditor:this.hasSelection});return}t(this,d).add(e),e.select(),G(this,At,me).call(this,e.propertiesToUpdate),G(this,z,re).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const f of t(this,d))f!==e&&f.unselect();t(this,d).clear(),t(this,d).add(e),e.select(),G(this,At,me).call(this,e.propertiesToUpdate),G(this,z,re).call(this,{hasSelectedEditor:!0})}isSelected(e){return t(this,d).has(e)}unselect(e){e.unselect(),t(this,d).delete(e),G(this,z,re).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return t(this,d).size!==0}undo(){t(this,nt).undo(),G(this,z,re).call(this,{hasSomethingToUndo:t(this,nt).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:G(this,Nt,_e).call(this)})}redo(){t(this,nt).redo(),G(this,z,re).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:t(this,nt).hasSomethingToRedo(),isEmpty:G(this,Nt,_e).call(this)})}addCommands(e){t(this,nt).add(e),G(this,z,re).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:G(this,Nt,_e).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...t(this,d)],f=()=>{for(const H of e)H.remove()},D=()=>{for(const H of e)G(this,Tt,Ye).call(this,H)};this.addCommands({cmd:f,undo:D,mustExec:!0})}commitOrRemove(){var e;(e=t(this,m))==null||e.commitOrRemove()}hasSomethingToControl(){return t(this,m)||this.hasSelection}selectAll(){for(const e of t(this,d))e.commit();G(this,bt,Ke).call(this,t(this,j).values())}unselectAll(){if(t(this,m)){t(this,m).commitOrRemove();return}if(this.hasSelection){for(const e of t(this,d))e.unselect();t(this,d).clear(),G(this,z,re).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,f,D=!1){if(D||this.commitOrRemove(),!this.hasSelection)return;t(this,Dt)[0]+=e,t(this,Dt)[1]+=f;const[H,V]=t(this,Dt),st=[...t(this,d)],mt=1e3;t(this,pt)&&clearTimeout(t(this,pt)),tt(this,pt,setTimeout(()=>{tt(this,pt,null),t(this,Dt)[0]=t(this,Dt)[1]=0,this.addCommands({cmd:()=>{for(const kt of st)t(this,j).has(kt.id)&&kt.translateInPage(H,V)},undo:()=>{for(const kt of st)t(this,j).has(kt.id)&&kt.translateInPage(-H,-V)},mustExec:!1})},mt));for(const kt of st)kt.translateInPage(e,f)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),tt(this,lt,new Map);for(const e of t(this,d))t(this,lt).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!t(this,lt))return!1;this.disableUserSelect(!1);const e=t(this,lt);tt(this,lt,null);let f=!1;for(const[{x:H,y:V,pageIndex:st},mt]of e)mt.newX=H,mt.newY=V,mt.newPageIndex=st,f||(f=H!==mt.savedX||V!==mt.savedY||st!==mt.savedPageIndex);if(!f)return!1;const D=(H,V,st,mt)=>{if(t(this,j).has(H.id)){const kt=t(this,X).get(mt);kt?H._setParentAndPosition(kt,V,st):(H.pageIndex=mt,H.x=V,H.y=st)}};return this.addCommands({cmd:()=>{for(const[H,{newX:V,newY:st,newPageIndex:mt}]of e)D(H,V,st,mt)},undo:()=>{for(const[H,{savedX:V,savedY:st,savedPageIndex:mt}]of e)D(H,V,st,mt)},mustExec:!0}),!0}dragSelectedEditors(e,f){if(t(this,lt))for(const D of t(this,lt).keys())D.drag(e,f)}rebuild(e){if(e.parent===null){const f=this.getLayer(e.pageIndex);f?(f.changeParent(e),f.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return t(this,m)===e}getActive(){return t(this,m)}getMode(){return t(this,o)}get imageManager(){return(0,l.shadow)(this,"imageManager",new L)}};m=new WeakMap,j=new WeakMap,X=new WeakMap,w=new WeakMap,$=new WeakMap,nt=new WeakMap,at=new WeakMap,W=new WeakMap,lt=new WeakMap,gt=new WeakMap,wt=new WeakMap,Pt=new WeakMap,E=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,d=new WeakMap,_=new WeakMap,M=new WeakMap,B=new WeakMap,et=new WeakMap,Z=new WeakMap,rt=new WeakMap,ht=new WeakMap,yt=new WeakMap,ut=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,St=new WeakMap,Dt=new WeakMap,pt=new WeakMap,J=new WeakMap,Q=new WeakMap,dt=new WeakSet,Ci=function(){window.addEventListener("focus",t(this,B)),window.addEventListener("blur",t(this,M))},Ct=new WeakSet,Xe=function(){window.removeEventListener("focus",t(this,B)),window.removeEventListener("blur",t(this,M))},Gt=new WeakSet,$e=function(){window.addEventListener("keydown",t(this,ht),{capture:!0})},Xt=new WeakSet,Ce=function(){window.removeEventListener("keydown",t(this,ht),{capture:!0})},Wt=new WeakSet,Ve=function(){document.addEventListener("copy",t(this,et)),document.addEventListener("cut",t(this,Z)),document.addEventListener("paste",t(this,rt))},ot=new WeakSet,qe=function(){document.removeEventListener("copy",t(this,et)),document.removeEventListener("cut",t(this,Z)),document.removeEventListener("paste",t(this,rt))},z=new WeakSet,re=function(e){Object.entries(e).some(([D,H])=>t(this,St)[D]!==H)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(t(this,St),e)})},At=new WeakSet,me=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Zt=new WeakSet,Ti=function(){if(!t(this,i)){tt(this,i,!0);for(const e of t(this,X).values())e.enable()}},vt=new WeakSet,xi=function(){if(this.unselectAll(),t(this,i)){tt(this,i,!1);for(const e of t(this,X).values())e.disable()}},Tt=new WeakSet,Ye=function(e){const f=t(this,X).get(e.pageIndex);f?f.addOrRebuild(e):this.addEditor(e)},Nt=new WeakSet,_e=function(){if(t(this,j).size===0)return!0;if(t(this,j).size===1)for(const e of t(this,j).values())return e.isEmpty();return!1},bt=new WeakSet,Ke=function(e){t(this,d).clear();for(const f of e)f.isEmpty()||(t(this,d).add(f),f.select());G(this,z,re).call(this,{hasSelectedEditor:!0})},ee(It,"TRANSLATE_SMALL",1),ee(It,"TRANSLATE_BIG",10);let N=It;c.AnnotationEditorUIManager=N},(ft,c,K)=>{var at,W,lt,gt,wt,Pt,E,i,n,s,o,d,de,M,ue,et,Je,rt,Te,yt,xe,Ft,be,St,Ae;Object.defineProperty(c,"__esModule",{value:!0}),c.StatTimer=c.RenderingCancelledException=c.PixelsPerInch=c.PageViewport=c.PDFDateString=c.DOMStandardFontDataFactory=c.DOMSVGFactory=c.DOMFilterFactory=c.DOMCanvasFactory=c.DOMCMapReaderFactory=void 0,c.deprecated=F,c.getColorValues=j,c.getCurrentTransform=X,c.getCurrentTransformInverse=w,c.getFilenameFromUrl=b,c.getPdfFilenameFromUrl=C,c.getRGB=m,c.getXfaPageViewport=x,c.isDataScheme=v,c.isPdfFile=u,c.isValidFetchUrl=A,c.loadScript=h,c.noContextMenu=a,c.setLayerDimensions=$;var l=K(7),y=K(1);const it="http://www.w3.org/2000/svg",nt=class nt{};ee(nt,"CSS",96),ee(nt,"PDF",72),ee(nt,"PDF_TO_CSS_UNITS",nt.CSS/nt.PDF);let U=nt;c.PixelsPerInch=U;class ct extends l.BaseFilterFactory{constructor({docId:Q,ownerDocument:dt=globalThis.document}={}){super();I(this,d);I(this,M);I(this,et);I(this,rt);I(this,yt);I(this,Ft);I(this,St);I(this,at,void 0);I(this,W,void 0);I(this,lt,void 0);I(this,gt,void 0);I(this,wt,void 0);I(this,Pt,void 0);I(this,E,void 0);I(this,i,void 0);I(this,n,void 0);I(this,s,void 0);I(this,o,0);tt(this,lt,Q),tt(this,gt,dt)}addFilter(Q){if(!Q)return"none";let dt=t(this,d,de).get(Q);if(dt)return dt;let Et,Ct,jt,Gt;if(Q.length===1){const Wt=Q[0],qt=new Array(256);for(let ot=0;ot<256;ot++)qt[ot]=Wt[ot]/255;Gt=Et=Ct=jt=qt.join(",")}else{const[Wt,qt,ot]=Q,Y=new Array(256),z=new Array(256),_t=new Array(256);for(let At=0;At<256;At++)Y[At]=Wt[At]/255,z[At]=qt[At]/255,_t[At]=ot[At]/255;Et=Y.join(","),Ct=z.join(","),jt=_t.join(","),Gt=`${Et}${Ct}${jt}`}if(dt=t(this,d,de).get(Gt),dt)return t(this,d,de).set(Q,dt),dt;const Ht=`g_${t(this,lt)}_transfer_map_${ge(this,o)._++}`,Xt=`url(#${Ht})`;t(this,d,de).set(Q,Xt),t(this,d,de).set(Gt,Xt);const $t=G(this,rt,Te).call(this,Ht);return G(this,Ft,be).call(this,Et,Ct,jt,$t),Xt}addHCMFilter(Q,dt){var qt;const Et=`${Q}-${dt}`;if(t(this,Pt)===Et)return t(this,E);if(tt(this,Pt,Et),tt(this,E,"none"),(qt=t(this,wt))==null||qt.remove(),!Q||!dt)return t(this,E);const Ct=G(this,St,Ae).call(this,Q);Q=y.Util.makeHexColor(...Ct);const jt=G(this,St,Ae).call(this,dt);if(dt=y.Util.makeHexColor(...jt),t(this,M,ue).style.color="",Q==="#000000"&&dt==="#ffffff"||Q===dt)return t(this,E);const Gt=new Array(256);for(let ot=0;ot<=255;ot++){const Y=ot/255;Gt[ot]=Y<=.03928?Y/12.92:((Y+.055)/1.055)**2.4}const Ht=Gt.join(","),Xt=`g_${t(this,lt)}_hcm_filter`,$t=tt(this,i,G(this,rt,Te).call(this,Xt));G(this,Ft,be).call(this,Ht,Ht,Ht,$t),G(this,et,Je).call(this,$t);const Wt=(ot,Y)=>{const z=Ct[ot]/255,_t=jt[ot]/255,At=new Array(Y+1);for(let te=0;te<=Y;te++)At[te]=z+te/Y*(_t-z);return At.join(",")};return G(this,Ft,be).call(this,Wt(0,5),Wt(1,5),Wt(2,5),$t),tt(this,E,`url(#${Xt})`),t(this,E)}addHighlightHCMFilter(Q,dt,Et,Ct){var _t;const jt=`${Q}-${dt}-${Et}-${Ct}`;if(t(this,n)===jt)return t(this,s);if(tt(this,n,jt),tt(this,s,"none"),(_t=t(this,i))==null||_t.remove(),!Q||!dt)return t(this,s);const[Gt,Ht]=[Q,dt].map(G(this,St,Ae).bind(this));let Xt=Math.round(.2126*Gt[0]+.7152*Gt[1]+.0722*Gt[2]),$t=Math.round(.2126*Ht[0]+.7152*Ht[1]+.0722*Ht[2]),[Wt,qt]=[Et,Ct].map(G(this,St,Ae).bind(this));$t<Xt&&([Xt,$t,Wt,qt]=[$t,Xt,qt,Wt]),t(this,M,ue).style.color="";const ot=(At,te,Zt)=>{const q=new Array(256),vt=($t-Xt)/Zt,Lt=At/255,Tt=(te-At)/(255*Zt);let Ot=0;for(let Nt=0;Nt<=Zt;Nt++){const Jt=Math.round(Xt+Nt*vt),bt=Lt+Nt*Tt;for(let Yt=Ot;Yt<=Jt;Yt++)q[Yt]=bt;Ot=Jt+1}for(let Nt=Ot;Nt<256;Nt++)q[Nt]=q[Ot-1];return q.join(",")},Y=`g_${t(this,lt)}_hcm_highlight_filter`,z=tt(this,i,G(this,rt,Te).call(this,Y));return G(this,et,Je).call(this,z),G(this,Ft,be).call(this,ot(Wt[0],qt[0],5),ot(Wt[1],qt[1],5),ot(Wt[2],qt[2],5),z),tt(this,s,`url(#${Y})`),t(this,s)}destroy(Q=!1){Q&&(t(this,E)||t(this,s))||(t(this,W)&&(t(this,W).parentNode.parentNode.remove(),tt(this,W,null)),t(this,at)&&(t(this,at).clear(),tt(this,at,null)),tt(this,o,0))}}at=new WeakMap,W=new WeakMap,lt=new WeakMap,gt=new WeakMap,wt=new WeakMap,Pt=new WeakMap,E=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,d=new WeakSet,de=function(){return t(this,at)||tt(this,at,new Map)},M=new WeakSet,ue=function(){if(!t(this,W)){const Q=t(this,gt).createElement("div"),{style:dt}=Q;dt.visibility="hidden",dt.contain="strict",dt.width=dt.height=0,dt.position="absolute",dt.top=dt.left=0,dt.zIndex=-1;const Et=t(this,gt).createElementNS(it,"svg");Et.setAttribute("width",0),Et.setAttribute("height",0),tt(this,W,t(this,gt).createElementNS(it,"defs")),Q.append(Et),Et.append(t(this,W)),t(this,gt).body.append(Q)}return t(this,W)},et=new WeakSet,Je=function(Q){const dt=t(this,gt).createElementNS(it,"feColorMatrix");dt.setAttribute("type","matrix"),dt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Q.append(dt)},rt=new WeakSet,Te=function(Q){const dt=t(this,gt).createElementNS(it,"filter");return dt.setAttribute("color-interpolation-filters","sRGB"),dt.setAttribute("id",Q),t(this,M,ue).append(dt),dt},yt=new WeakSet,xe=function(Q,dt,Et){const Ct=t(this,gt).createElementNS(it,dt);Ct.setAttribute("type","discrete"),Ct.setAttribute("tableValues",Et),Q.append(Ct)},Ft=new WeakSet,be=function(Q,dt,Et,Ct){const jt=t(this,gt).createElementNS(it,"feComponentTransfer");Ct.append(jt),G(this,yt,xe).call(this,jt,"feFuncR",Q),G(this,yt,xe).call(this,jt,"feFuncG",dt),G(this,yt,xe).call(this,jt,"feFuncB",Et)},St=new WeakSet,Ae=function(Q){return t(this,M,ue).style.color=Q,m(getComputedStyle(t(this,M,ue)).getPropertyValue("color"))},c.DOMFilterFactory=ct;class L extends l.BaseCanvasFactory{constructor({ownerDocument:J=globalThis.document}={}){super(),this._document=J}_createCanvas(J,Q){const dt=this._document.createElement("canvas");return dt.width=J,dt.height=Q,dt}}c.DOMCanvasFactory=L;async function P(pt,J=!1){if(A(pt,document.baseURI)){const Q=await fetch(pt);if(!Q.ok)throw new Error(Q.statusText);return J?new Uint8Array(await Q.arrayBuffer()):(0,y.stringToBytes)(await Q.text())}return new Promise((Q,dt)=>{const Et=new XMLHttpRequest;Et.open("GET",pt,!0),J&&(Et.responseType="arraybuffer"),Et.onreadystatechange=()=>{if(Et.readyState===XMLHttpRequest.DONE){if(Et.status===200||Et.status===0){let Ct;if(J&&Et.response?Ct=new Uint8Array(Et.response):!J&&Et.responseText&&(Ct=(0,y.stringToBytes)(Et.responseText)),Ct){Q(Ct);return}}dt(new Error(Et.statusText))}},Et.send(null)})}class p extends l.BaseCMapReaderFactory{_fetchData(J,Q){return P(J,this.isCompressed).then(dt=>({cMapData:dt,compressionType:Q}))}}c.DOMCMapReaderFactory=p;class O extends l.BaseStandardFontDataFactory{_fetchData(J){return P(J,!0)}}c.DOMStandardFontDataFactory=O;class N extends l.BaseSVGFactory{_createSVG(J){return document.createElementNS(it,J)}}c.DOMSVGFactory=N;class k{constructor({viewBox:J,scale:Q,rotation:dt,offsetX:Et=0,offsetY:Ct=0,dontFlip:jt=!1}){this.viewBox=J,this.scale=Q,this.rotation=dt,this.offsetX=Et,this.offsetY=Ct;const Gt=(J[2]+J[0])/2,Ht=(J[3]+J[1])/2;let Xt,$t,Wt,qt;switch(dt%=360,dt<0&&(dt+=360),dt){case 180:Xt=-1,$t=0,Wt=0,qt=1;break;case 90:Xt=0,$t=1,Wt=1,qt=0;break;case 270:Xt=0,$t=-1,Wt=-1,qt=0;break;case 0:Xt=1,$t=0,Wt=0,qt=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}jt&&(Wt=-Wt,qt=-qt);let ot,Y,z,_t;Xt===0?(ot=Math.abs(Ht-J[1])*Q+Et,Y=Math.abs(Gt-J[0])*Q+Ct,z=(J[3]-J[1])*Q,_t=(J[2]-J[0])*Q):(ot=Math.abs(Gt-J[0])*Q+Et,Y=Math.abs(Ht-J[1])*Q+Ct,z=(J[2]-J[0])*Q,_t=(J[3]-J[1])*Q),this.transform=[Xt*Q,$t*Q,Wt*Q,qt*Q,ot-Xt*Q*Gt-Wt*Q*Ht,Y-$t*Q*Gt-qt*Q*Ht],this.width=z,this.height=_t}get rawDims(){const{viewBox:J}=this;return(0,y.shadow)(this,"rawDims",{pageWidth:J[2]-J[0],pageHeight:J[3]-J[1],pageX:J[0],pageY:J[1]})}clone({scale:J=this.scale,rotation:Q=this.rotation,offsetX:dt=this.offsetX,offsetY:Et=this.offsetY,dontFlip:Ct=!1}={}){return new k({viewBox:this.viewBox.slice(),scale:J,rotation:Q,offsetX:dt,offsetY:Et,dontFlip:Ct})}convertToViewportPoint(J,Q){return y.Util.applyTransform([J,Q],this.transform)}convertToViewportRectangle(J){const Q=y.Util.applyTransform([J[0],J[1]],this.transform),dt=y.Util.applyTransform([J[2],J[3]],this.transform);return[Q[0],Q[1],dt[0],dt[1]]}convertToPdfPoint(J,Q){return y.Util.applyInverseTransform([J,Q],this.transform)}}c.PageViewport=k;class S extends y.BaseException{constructor(J,Q=0){super(J,"RenderingCancelledException"),this.extraDelay=Q}}c.RenderingCancelledException=S;function v(pt){const J=pt.length;let Q=0;for(;Q<J&&pt[Q].trim()==="";)Q++;return pt.substring(Q,Q+5).toLowerCase()==="data:"}function u(pt){return typeof pt=="string"&&/\.pdf$/i.test(pt)}function b(pt,J=!1){return J||([pt]=pt.split(/[#?]/,1)),pt.substring(pt.lastIndexOf("/")+1)}function C(pt,J="document.pdf"){if(typeof pt!="string")return J;if(v(pt))return(0,y.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),J;const Q=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,dt=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Et=Q.exec(pt);let Ct=dt.exec(Et[1])||dt.exec(Et[2])||dt.exec(Et[3]);if(Ct&&(Ct=Ct[0],Ct.includes("%")))try{Ct=dt.exec(decodeURIComponent(Ct))[0]}catch{}return Ct||J}class T{constructor(){ee(this,"started",Object.create(null));ee(this,"times",[])}time(J){J in this.started&&(0,y.warn)(`Timer is already running for ${J}`),this.started[J]=Date.now()}timeEnd(J){J in this.started||(0,y.warn)(`Timer has not been started for ${J}`),this.times.push({name:J,start:this.started[J],end:Date.now()}),delete this.started[J]}toString(){const J=[];let Q=0;for(const{name:dt}of this.times)Q=Math.max(dt.length,Q);for(const{name:dt,start:Et,end:Ct}of this.times)J.push(`${dt.padEnd(Q)} ${Ct-Et}ms
`);return J.join("")}}c.StatTimer=T;function A(pt,J){try{const{protocol:Q}=J?new URL(pt,J):new URL(pt);return Q==="http:"||Q==="https:"}catch{return!1}}function a(pt){pt.preventDefault()}function h(pt,J=!1){return new Promise((Q,dt)=>{const Et=document.createElement("script");Et.src=pt,Et.onload=function(Ct){J&&Et.remove(),Q(Ct)},Et.onerror=function(){dt(new Error(`Cannot load script at: ${Et.src}`))},(document.head||document.documentElement).append(Et)})}function F(pt){console.log("Deprecated API usage: "+pt)}let g;class r{static toDateObject(J){if(!J||typeof J!="string")return null;g||(g=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Q=g.exec(J);if(!Q)return null;const dt=parseInt(Q[1],10);let Et=parseInt(Q[2],10);Et=Et>=1&&Et<=12?Et-1:0;let Ct=parseInt(Q[3],10);Ct=Ct>=1&&Ct<=31?Ct:1;let jt=parseInt(Q[4],10);jt=jt>=0&&jt<=23?jt:0;let Gt=parseInt(Q[5],10);Gt=Gt>=0&&Gt<=59?Gt:0;let Ht=parseInt(Q[6],10);Ht=Ht>=0&&Ht<=59?Ht:0;const Xt=Q[7]||"Z";let $t=parseInt(Q[8],10);$t=$t>=0&&$t<=23?$t:0;let Wt=parseInt(Q[9],10)||0;return Wt=Wt>=0&&Wt<=59?Wt:0,Xt==="-"?(jt+=$t,Gt+=Wt):Xt==="+"&&(jt-=$t,Gt-=Wt),new Date(Date.UTC(dt,Et,Ct,jt,Gt,Ht))}}c.PDFDateString=r;function x(pt,{scale:J=1,rotation:Q=0}){const{width:dt,height:Et}=pt.attributes.style,Ct=[0,0,parseInt(dt),parseInt(Et)];return new k({viewBox:Ct,scale:J,rotation:Q})}function m(pt){if(pt.startsWith("#")){const J=parseInt(pt.slice(1),16);return[(J&16711680)>>16,(J&65280)>>8,J&255]}return pt.startsWith("rgb(")?pt.slice(4,-1).split(",").map(J=>parseInt(J)):pt.startsWith("rgba(")?pt.slice(5,-1).split(",").map(J=>parseInt(J)).slice(0,3):((0,y.warn)(`Not a valid color format: "${pt}"`),[0,0,0])}function j(pt){const J=document.createElement("span");J.style.visibility="hidden",document.body.append(J);for(const Q of pt.keys()){J.style.color=Q;const dt=window.getComputedStyle(J).color;pt.set(Q,m(dt))}J.remove()}function X(pt){const{a:J,b:Q,c:dt,d:Et,e:Ct,f:jt}=pt.getTransform();return[J,Q,dt,Et,Ct,jt]}function w(pt){const{a:J,b:Q,c:dt,d:Et,e:Ct,f:jt}=pt.getTransform().invertSelf();return[J,Q,dt,Et,Ct,jt]}function $(pt,J,Q=!1,dt=!0){if(J instanceof k){const{pageWidth:Et,pageHeight:Ct}=J.rawDims,{style:jt}=pt,Gt=y.FeatureTest.isCSSRoundSupported,Ht=`var(--scale-factor) * ${Et}px`,Xt=`var(--scale-factor) * ${Ct}px`,$t=Gt?`round(${Ht}, 1px)`:`calc(${Ht})`,Wt=Gt?`round(${Xt}, 1px)`:`calc(${Xt})`;!Q||J.rotation%180===0?(jt.width=$t,jt.height=Wt):(jt.width=Wt,jt.height=$t)}dt&&pt.setAttribute("data-main-rotation",J.rotation)}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.BaseStandardFontDataFactory=c.BaseSVGFactory=c.BaseFilterFactory=c.BaseCanvasFactory=c.BaseCMapReaderFactory=void 0;var l=K(1);class y{constructor(){this.constructor===y&&(0,l.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(p){return"none"}addHCMFilter(p,O){return"none"}addHighlightHCMFilter(p,O,N,k){return"none"}destroy(p=!1){}}c.BaseFilterFactory=y;class it{constructor(){this.constructor===it&&(0,l.unreachable)("Cannot initialize BaseCanvasFactory.")}create(p,O){if(p<=0||O<=0)throw new Error("Invalid canvas size");const N=this._createCanvas(p,O);return{canvas:N,context:N.getContext("2d")}}reset(p,O,N){if(!p.canvas)throw new Error("Canvas is not specified");if(O<=0||N<=0)throw new Error("Invalid canvas size");p.canvas.width=O,p.canvas.height=N}destroy(p){if(!p.canvas)throw new Error("Canvas is not specified");p.canvas.width=0,p.canvas.height=0,p.canvas=null,p.context=null}_createCanvas(p,O){(0,l.unreachable)("Abstract method `_createCanvas` called.")}}c.BaseCanvasFactory=it;class U{constructor({baseUrl:p=null,isCompressed:O=!0}){this.constructor===U&&(0,l.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=p,this.isCompressed=O}async fetch({name:p}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!p)throw new Error("CMap name must be specified.");const O=this.baseUrl+p+(this.isCompressed?".bcmap":""),N=this.isCompressed?l.CMapCompressionType.BINARY:l.CMapCompressionType.NONE;return this._fetchData(O,N).catch(k=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${O}`)})}_fetchData(p,O){(0,l.unreachable)("Abstract method `_fetchData` called.")}}c.BaseCMapReaderFactory=U;class ct{constructor({baseUrl:p=null}){this.constructor===ct&&(0,l.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=p}async fetch({filename:p}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!p)throw new Error("Font filename must be specified.");const O=`${this.baseUrl}${p}`;return this._fetchData(O).catch(N=>{throw new Error(`Unable to load font data at: ${O}`)})}_fetchData(p){(0,l.unreachable)("Abstract method `_fetchData` called.")}}c.BaseStandardFontDataFactory=ct;class L{constructor(){this.constructor===L&&(0,l.unreachable)("Cannot initialize BaseSVGFactory.")}create(p,O,N=!1){if(p<=0||O<=0)throw new Error("Invalid SVG dimensions");const k=this._createSVG("svg:svg");return k.setAttribute("version","1.1"),N||(k.setAttribute("width",`${p}px`),k.setAttribute("height",`${O}px`)),k.setAttribute("preserveAspectRatio","none"),k.setAttribute("viewBox",`0 0 ${p} ${O}`),k}createElement(p){if(typeof p!="string")throw new Error("Invalid SVG element type");return this._createSVG(p)}_createSVG(p){(0,l.unreachable)("Abstract method `_createSVG` called.")}}c.BaseSVGFactory=L},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.MurmurHash3_64=void 0;var l=K(1);const y=3285377520,it=4294901760,U=65535;class ct{constructor(P){this.h1=P?P&4294967295:y,this.h2=P?P&4294967295:y}update(P){let p,O;if(typeof P=="string"){p=new Uint8Array(P.length*2),O=0;for(let F=0,g=P.length;F<g;F++){const r=P.charCodeAt(F);r<=255?p[O++]=r:(p[O++]=r>>>8,p[O++]=r&255)}}else if((0,l.isArrayBuffer)(P))p=P.slice(),O=p.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const N=O>>2,k=O-N*4,S=new Uint32Array(p.buffer,0,N);let v=0,u=0,b=this.h1,C=this.h2;const T=3432918353,A=461845907,a=T&U,h=A&U;for(let F=0;F<N;F++)F&1?(v=S[F],v=v*T&it|v*a&U,v=v<<15|v>>>17,v=v*A&it|v*h&U,b^=v,b=b<<13|b>>>19,b=b*5+3864292196):(u=S[F],u=u*T&it|u*a&U,u=u<<15|u>>>17,u=u*A&it|u*h&U,C^=u,C=C<<13|C>>>19,C=C*5+3864292196);switch(v=0,k){case 3:v^=p[N*4+2]<<16;case 2:v^=p[N*4+1]<<8;case 1:v^=p[N*4],v=v*T&it|v*a&U,v=v<<15|v>>>17,v=v*A&it|v*h&U,N&1?b^=v:C^=v}this.h1=b,this.h2=C}hexdigest(){let P=this.h1,p=this.h2;return P^=p>>>1,P=P*3981806797&it|P*36045&U,p=p*4283543511&it|((p<<16|P>>>16)*2950163797&it)>>>16,P^=p>>>1,P=P*444984403&it|P*60499&U,p=p*3301882366&it|((p<<16|P>>>16)*3120437893&it)>>>16,P^=p>>>1,(P>>>0).toString(16).padStart(8,"0")+(p>>>0).toString(16).padStart(8,"0")}}c.MurmurHash3_64=ct},(ft,c,K)=>{var U;Object.defineProperty(c,"__esModule",{value:!0}),c.FontLoader=c.FontFaceObject=void 0;var l=K(1);class y{constructor({ownerDocument:L=globalThis.document,styleElement:P=null}){I(this,U,new Set);this._document=L,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(L){this.nativeFontFaces.add(L),this._document.fonts.add(L)}removeNativeFontFace(L){this.nativeFontFaces.delete(L),this._document.fonts.delete(L)}insertRule(L){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const P=this.styleElement.sheet;P.insertRule(L,P.cssRules.length)}clear(){for(const L of this.nativeFontFaces)this._document.fonts.delete(L);this.nativeFontFaces.clear(),t(this,U).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(L){if(!(!L||t(this,U).has(L.loadedName))){if((0,l.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:P,src:p,style:O}=L,N=new FontFace(P,p,O);this.addNativeFontFace(N);try{await N.load(),t(this,U).add(P)}catch{(0,l.warn)(`Cannot load system font: ${L.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(N)}return}(0,l.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(L){if(L.attached||L.missingFile&&!L.systemFontInfo)return;if(L.attached=!0,L.systemFontInfo){await this.loadSystemFont(L.systemFontInfo);return}if(this.isFontLoadingAPISupported){const p=L.createNativeFontFace();if(p){this.addNativeFontFace(p);try{await p.loaded}catch(O){throw(0,l.warn)(`Failed to load font '${p.family}': '${O}'.`),L.disableFontFace=!0,O}}return}const P=L.createFontFaceRule();if(P){if(this.insertRule(P),this.isSyncFontLoadingSupported)return;await new Promise(p=>{const O=this._queueLoadingCallback(p);this._prepareFontLoadEvent(L,O)})}}get isFontLoadingAPISupported(){var P;const L=!!((P=this._document)!=null&&P.fonts);return(0,l.shadow)(this,"isFontLoadingAPISupported",L)}get isSyncFontLoadingSupported(){let L=!1;return(l.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(L=!0),(0,l.shadow)(this,"isSyncFontLoadingSupported",L)}_queueLoadingCallback(L){function P(){for((0,l.assert)(!O.done,"completeRequest() cannot be called twice."),O.done=!0;p.length>0&&p[0].done;){const N=p.shift();setTimeout(N.callback,0)}}const{loadingRequests:p}=this,O={done:!1,complete:P,callback:L};return p.push(O),O}get _loadTestFont(){const L=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,l.shadow)(this,"_loadTestFont",L)}_prepareFontLoadEvent(L,P){function p(m,j){return m.charCodeAt(j)<<24|m.charCodeAt(j+1)<<16|m.charCodeAt(j+2)<<8|m.charCodeAt(j+3)&255}function O(m,j,X,w){const $=m.substring(0,j),nt=m.substring(j+X);return $+w+nt}let N,k;const S=this._document.createElement("canvas");S.width=1,S.height=1;const v=S.getContext("2d");let u=0;function b(m,j){if(++u>30){(0,l.warn)("Load test font never loaded."),j();return}if(v.font="30px "+m,v.fillText(".",0,20),v.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(b.bind(null,m,j))}const C=`lt${Date.now()}${this.loadTestFontId++}`;let T=this._loadTestFont;T=O(T,976,C.length,C);const a=16,h=1482184792;let F=p(T,a);for(N=0,k=C.length-3;N<k;N+=4)F=F-h+p(C,N)|0;N<C.length&&(F=F-h+p(C+"XXX",N)|0),T=O(T,a,4,(0,l.string32)(F));const g=`url(data:font/opentype;base64,${btoa(T)});`,r=`@font-face {font-family:"${C}";src:${g}}`;this.insertRule(r);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const m of[L.loadedName,C]){const j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=m,x.append(j)}this._document.body.append(x),b(C,()=>{x.remove(),P.complete()})}}U=new WeakMap,c.FontLoader=y;class it{constructor(L,{isEvalSupported:P=!0,disableFontFace:p=!1,ignoreErrors:O=!1,inspectFont:N=null}){this.compiledGlyphs=Object.create(null);for(const k in L)this[k]=L[k];this.isEvalSupported=P!==!1,this.disableFontFace=p===!0,this.ignoreErrors=O===!0,this._inspectFont=N}createNativeFontFace(){var P;if(!this.data||this.disableFontFace)return null;let L;if(!this.cssFontInfo)L=new FontFace(this.loadedName,this.data,{});else{const p={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(p.style=`oblique ${this.cssFontInfo.italicAngle}deg`),L=new FontFace(this.cssFontInfo.fontFamily,this.data,p)}return(P=this._inspectFont)==null||P.call(this,this),L}createFontFaceRule(){var O;if(!this.data||this.disableFontFace)return null;const L=(0,l.bytesToString)(this.data),P=`url(data:${this.mimetype};base64,${btoa(L)});`;let p;if(!this.cssFontInfo)p=`@font-face {font-family:"${this.loadedName}";src:${P}}`;else{let N=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(N+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),p=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${N}src:${P}}`}return(O=this._inspectFont)==null||O.call(this,this,P),p}getPathGenerator(L,P){if(this.compiledGlyphs[P]!==void 0)return this.compiledGlyphs[P];let p;try{p=L.get(this.loadedName+"_path_"+P)}catch(O){if(!this.ignoreErrors)throw O;return(0,l.warn)(`getPathGenerator - ignoring character: "${O}".`),this.compiledGlyphs[P]=function(N,k){}}if(this.isEvalSupported&&l.FeatureTest.isEvalSupported){const O=[];for(const N of p){const k=N.args!==void 0?N.args.join(","):"";O.push("c.",N.cmd,"(",k,`);
`)}return this.compiledGlyphs[P]=new Function("c","size",O.join(""))}return this.compiledGlyphs[P]=function(O,N){for(const k of p)k.cmd==="scale"&&(k.args=[N,-N]),O[k.cmd].apply(O,k.args)}}}c.FontFaceObject=it},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.NodeStandardFontDataFactory=c.NodeFilterFactory=c.NodeCanvasFactory=c.NodeCMapReaderFactory=void 0;var l=K(7);K(1);const y=function(P){return new Promise((p,O)=>{require$$5.readFile(P,(k,S)=>{if(k||!S){O(new Error(k));return}p(new Uint8Array(S))})})};class it extends l.BaseFilterFactory{}c.NodeFilterFactory=it;class U extends l.BaseCanvasFactory{_createCanvas(p,O){return require$$5.createCanvas(p,O)}}c.NodeCanvasFactory=U;class ct extends l.BaseCMapReaderFactory{_fetchData(p,O){return y(p).then(N=>({cMapData:N,compressionType:O}))}}c.NodeCMapReaderFactory=ct;class L extends l.BaseStandardFontDataFactory{_fetchData(p){return y(p)}}c.NodeStandardFontDataFactory=L},(ft,c,K)=>{var W,Qe,gt,Ze;Object.defineProperty(c,"__esModule",{value:!0}),c.CanvasGraphics=void 0;var l=K(1),y=K(6),it=K(12),U=K(13);const ct=16,L=100,P=4096,p=15,O=10,N=1e3,k=16;function S(E,i){if(E._removeMirroring)throw new Error("Context is already forwarding operations.");E.__originalSave=E.save,E.__originalRestore=E.restore,E.__originalRotate=E.rotate,E.__originalScale=E.scale,E.__originalTranslate=E.translate,E.__originalTransform=E.transform,E.__originalSetTransform=E.setTransform,E.__originalResetTransform=E.resetTransform,E.__originalClip=E.clip,E.__originalMoveTo=E.moveTo,E.__originalLineTo=E.lineTo,E.__originalBezierCurveTo=E.bezierCurveTo,E.__originalRect=E.rect,E.__originalClosePath=E.closePath,E.__originalBeginPath=E.beginPath,E._removeMirroring=()=>{E.save=E.__originalSave,E.restore=E.__originalRestore,E.rotate=E.__originalRotate,E.scale=E.__originalScale,E.translate=E.__originalTranslate,E.transform=E.__originalTransform,E.setTransform=E.__originalSetTransform,E.resetTransform=E.__originalResetTransform,E.clip=E.__originalClip,E.moveTo=E.__originalMoveTo,E.lineTo=E.__originalLineTo,E.bezierCurveTo=E.__originalBezierCurveTo,E.rect=E.__originalRect,E.closePath=E.__originalClosePath,E.beginPath=E.__originalBeginPath,delete E._removeMirroring},E.save=function(){i.save(),this.__originalSave()},E.restore=function(){i.restore(),this.__originalRestore()},E.translate=function(s,o){i.translate(s,o),this.__originalTranslate(s,o)},E.scale=function(s,o){i.scale(s,o),this.__originalScale(s,o)},E.transform=function(s,o,d,_,M,B){i.transform(s,o,d,_,M,B),this.__originalTransform(s,o,d,_,M,B)},E.setTransform=function(s,o,d,_,M,B){i.setTransform(s,o,d,_,M,B),this.__originalSetTransform(s,o,d,_,M,B)},E.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},E.rotate=function(s){i.rotate(s),this.__originalRotate(s)},E.clip=function(s){i.clip(s),this.__originalClip(s)},E.moveTo=function(n,s){i.moveTo(n,s),this.__originalMoveTo(n,s)},E.lineTo=function(n,s){i.lineTo(n,s),this.__originalLineTo(n,s)},E.bezierCurveTo=function(n,s,o,d,_,M){i.bezierCurveTo(n,s,o,d,_,M),this.__originalBezierCurveTo(n,s,o,d,_,M)},E.rect=function(n,s,o,d){i.rect(n,s,o,d),this.__originalRect(n,s,o,d)},E.closePath=function(){i.closePath(),this.__originalClosePath()},E.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}class v{constructor(i){this.canvasFactory=i,this.cache=Object.create(null)}getCanvas(i,n,s){let o;return this.cache[i]!==void 0?(o=this.cache[i],this.canvasFactory.reset(o,n,s)):(o=this.canvasFactory.create(n,s),this.cache[i]=o),o}delete(i){delete this.cache[i]}clear(){for(const i in this.cache){const n=this.cache[i];this.canvasFactory.destroy(n),delete this.cache[i]}}}function u(E,i,n,s,o,d,_,M,B,et){const[Z,rt,ht,yt,ut,Ft]=(0,y.getCurrentTransform)(E);if(rt===0&&ht===0){const Dt=_*Z+ut,pt=Math.round(Dt),J=M*yt+Ft,Q=Math.round(J),dt=(_+B)*Z+ut,Et=Math.abs(Math.round(dt)-pt)||1,Ct=(M+et)*yt+Ft,jt=Math.abs(Math.round(Ct)-Q)||1;return E.setTransform(Math.sign(Z),0,0,Math.sign(yt),pt,Q),E.drawImage(i,n,s,o,d,0,0,Et,jt),E.setTransform(Z,rt,ht,yt,ut,Ft),[Et,jt]}if(Z===0&&yt===0){const Dt=M*ht+ut,pt=Math.round(Dt),J=_*rt+Ft,Q=Math.round(J),dt=(M+et)*ht+ut,Et=Math.abs(Math.round(dt)-pt)||1,Ct=(_+B)*rt+Ft,jt=Math.abs(Math.round(Ct)-Q)||1;return E.setTransform(0,Math.sign(rt),Math.sign(ht),0,pt,Q),E.drawImage(i,n,s,o,d,0,0,jt,Et),E.setTransform(Z,rt,ht,yt,ut,Ft),[jt,Et]}E.drawImage(i,n,s,o,d,_,M,B,et);const Bt=Math.hypot(Z,rt),St=Math.hypot(ht,yt);return[Bt*B,St*et]}function b(E){const{width:i,height:n}=E;if(i>N||n>N)return null;const s=1e3,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),d=i+1;let _=new Uint8Array(d*(n+1)),M,B,et;const Z=i+7&-8;let rt=new Uint8Array(Z*n),ht=0;for(const St of E.data){let Dt=128;for(;Dt>0;)rt[ht++]=St&Dt?0:255,Dt>>=1}let yt=0;for(ht=0,rt[ht]!==0&&(_[0]=1,++yt),B=1;B<i;B++)rt[ht]!==rt[ht+1]&&(_[B]=rt[ht]?2:1,++yt),ht++;for(rt[ht]!==0&&(_[B]=2,++yt),M=1;M<n;M++){ht=M*Z,et=M*d,rt[ht-Z]!==rt[ht]&&(_[et]=rt[ht]?1:8,++yt);let St=(rt[ht]?4:0)+(rt[ht-Z]?8:0);for(B=1;B<i;B++)St=(St>>2)+(rt[ht+1]?4:0)+(rt[ht-Z+1]?8:0),o[St]&&(_[et+B]=o[St],++yt),ht++;if(rt[ht-Z]!==rt[ht]&&(_[et+B]=rt[ht]?2:4,++yt),yt>s)return null}for(ht=Z*(n-1),et=M*d,rt[ht]!==0&&(_[et]=8,++yt),B=1;B<i;B++)rt[ht]!==rt[ht+1]&&(_[et+B]=rt[ht]?4:8,++yt),ht++;if(rt[ht]!==0&&(_[et+B]=4,++yt),yt>s)return null;const ut=new Int32Array([0,d,-1,0,-d,0,0,0,1]),Ft=new Path2D;for(M=0;yt&&M<=n;M++){let St=M*d;const Dt=St+i;for(;St<Dt&&!_[St];)St++;if(St===Dt)continue;Ft.moveTo(St%d,M);const pt=St;let J=_[St];do{const Q=ut[J];do St+=Q;while(!_[St]);const dt=_[St];dt!==5&&dt!==10?(J=dt,_[St]=0):(J=dt&51*J>>4,_[St]&=J>>2|J<<2),Ft.lineTo(St%d,St/d|0),_[St]||--yt}while(pt!==St);--M}return rt=null,_=null,function(St){St.save(),St.scale(1/i,-1/n),St.translate(0,-n),St.fill(Ft),St.beginPath(),St.restore()}}class C{constructor(i,n){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=l.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=l.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=l.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,i,n])}clone(){const i=Object.create(this);return i.clipBox=this.clipBox.slice(),i}setCurrentPoint(i,n){this.x=i,this.y=n}updatePathMinMax(i,n,s){[n,s]=l.Util.applyTransform([n,s],i),this.minX=Math.min(this.minX,n),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(i,n){const s=l.Util.applyTransform(n,i),o=l.Util.applyTransform(n.slice(2),i);this.minX=Math.min(this.minX,s[0],o[0]),this.minY=Math.min(this.minY,s[1],o[1]),this.maxX=Math.max(this.maxX,s[0],o[0]),this.maxY=Math.max(this.maxY,s[1],o[1])}updateScalingPathMinMax(i,n){l.Util.scaleMinMax(i,n),this.minX=Math.min(this.minX,n[0]),this.maxX=Math.max(this.maxX,n[1]),this.minY=Math.min(this.minY,n[2]),this.maxY=Math.max(this.maxY,n[3])}updateCurvePathMinMax(i,n,s,o,d,_,M,B,et,Z){const rt=l.Util.bezierBoundingBox(n,s,o,d,_,M,B,et);if(Z){Z[0]=Math.min(Z[0],rt[0],rt[2]),Z[1]=Math.max(Z[1],rt[0],rt[2]),Z[2]=Math.min(Z[2],rt[1],rt[3]),Z[3]=Math.max(Z[3],rt[1],rt[3]);return}this.updateRectMinMax(i,rt)}getPathBoundingBox(i=it.PathType.FILL,n=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(i===it.PathType.STROKE){n||(0,l.unreachable)("Stroke bounding box must include transform.");const o=l.Util.singularValueDecompose2dScale(n),d=o[0]*this.lineWidth/2,_=o[1]*this.lineWidth/2;s[0]-=d,s[1]-=_,s[2]+=d,s[3]+=_}return s}updateClipFromPath(){const i=l.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(i||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(i){this.clipBox=i,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(i=it.PathType.FILL,n=null){return l.Util.intersect(this.clipBox,this.getPathBoundingBox(i,n))}}function T(E,i){if(typeof ImageData<"u"&&i instanceof ImageData){E.putImageData(i,0,0);return}const n=i.height,s=i.width,o=n%k,d=(n-o)/k,_=o===0?d:d+1,M=E.createImageData(s,k);let B=0,et;const Z=i.data,rt=M.data;let ht,yt,ut,Ft;if(i.kind===l.ImageKind.GRAYSCALE_1BPP){const Bt=Z.byteLength,St=new Uint32Array(rt.buffer,0,rt.byteLength>>2),Dt=St.length,pt=s+7>>3,J=4294967295,Q=l.FeatureTest.isLittleEndian?4278190080:255;for(ht=0;ht<_;ht++){for(ut=ht<d?k:o,et=0,yt=0;yt<ut;yt++){const dt=Bt-B;let Et=0;const Ct=dt>pt?s:dt*8-7,jt=Ct&-8;let Gt=0,Ht=0;for(;Et<jt;Et+=8)Ht=Z[B++],St[et++]=Ht&128?J:Q,St[et++]=Ht&64?J:Q,St[et++]=Ht&32?J:Q,St[et++]=Ht&16?J:Q,St[et++]=Ht&8?J:Q,St[et++]=Ht&4?J:Q,St[et++]=Ht&2?J:Q,St[et++]=Ht&1?J:Q;for(;Et<Ct;Et++)Gt===0&&(Ht=Z[B++],Gt=128),St[et++]=Ht&Gt?J:Q,Gt>>=1}for(;et<Dt;)St[et++]=0;E.putImageData(M,0,ht*k)}}else if(i.kind===l.ImageKind.RGBA_32BPP){for(yt=0,Ft=s*k*4,ht=0;ht<d;ht++)rt.set(Z.subarray(B,B+Ft)),B+=Ft,E.putImageData(M,0,yt),yt+=k;ht<_&&(Ft=s*o*4,rt.set(Z.subarray(B,B+Ft)),E.putImageData(M,0,yt))}else if(i.kind===l.ImageKind.RGB_24BPP)for(ut=k,Ft=s*ut,ht=0;ht<_;ht++){for(ht>=d&&(ut=o,Ft=s*ut),et=0,yt=Ft;yt--;)rt[et++]=Z[B++],rt[et++]=Z[B++],rt[et++]=Z[B++],rt[et++]=255;E.putImageData(M,0,ht*k)}else throw new Error(`bad image kind: ${i.kind}`)}function A(E,i){if(i.bitmap){E.drawImage(i.bitmap,0,0);return}const n=i.height,s=i.width,o=n%k,d=(n-o)/k,_=o===0?d:d+1,M=E.createImageData(s,k);let B=0;const et=i.data,Z=M.data;for(let rt=0;rt<_;rt++){const ht=rt<d?k:o;({srcPos:B}=(0,U.convertBlackAndWhiteToRGBA)({src:et,srcPos:B,dest:Z,width:s,height:ht,nonBlackColor:0})),E.putImageData(M,0,rt*k)}}function a(E,i){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of n)E[s]!==void 0&&(i[s]=E[s]);E.setLineDash!==void 0&&(i.setLineDash(E.getLineDash()),i.lineDashOffset=E.lineDashOffset)}function h(E){if(E.strokeStyle=E.fillStyle="#000000",E.fillRule="nonzero",E.globalAlpha=1,E.lineWidth=1,E.lineCap="butt",E.lineJoin="miter",E.miterLimit=10,E.globalCompositeOperation="source-over",E.font="10px sans-serif",E.setLineDash!==void 0&&(E.setLineDash([]),E.lineDashOffset=0),!l.isNodeJS){const{filter:i}=E;i!=="none"&&i!==""&&(E.filter="none")}}function F(E,i,n,s){const o=E.length;for(let d=3;d<o;d+=4){const _=E[d];if(_===0)E[d-3]=i,E[d-2]=n,E[d-1]=s;else if(_<255){const M=255-_;E[d-3]=E[d-3]*_+i*M>>8,E[d-2]=E[d-2]*_+n*M>>8,E[d-1]=E[d-1]*_+s*M>>8}}}function g(E,i,n){const s=E.length,o=1/255;for(let d=3;d<s;d+=4){const _=n?n[E[d]]:E[d];i[d]=i[d]*_*o|0}}function r(E,i,n){const s=E.length;for(let o=3;o<s;o+=4){const d=E[o-3]*77+E[o-2]*152+E[o-1]*28;i[o]=n?i[o]*n[d>>8]>>8:i[o]*d>>16}}function x(E,i,n,s,o,d,_,M,B,et,Z){const rt=!!d,ht=rt?d[0]:0,yt=rt?d[1]:0,ut=rt?d[2]:0,Ft=o==="Luminosity"?r:g,St=Math.min(s,Math.ceil(1048576/n));for(let Dt=0;Dt<s;Dt+=St){const pt=Math.min(St,s-Dt),J=E.getImageData(M-et,Dt+(B-Z),n,pt),Q=i.getImageData(M,Dt+B,n,pt);rt&&F(J.data,ht,yt,ut),Ft(J.data,Q.data,_),i.putImageData(Q,M,Dt+B)}}function m(E,i,n,s){const o=s[0],d=s[1],_=s[2]-o,M=s[3]-d;_===0||M===0||(x(i.context,n,_,M,i.subtype,i.backdrop,i.transferMap,o,d,i.offsetX,i.offsetY),E.save(),E.globalAlpha=1,E.globalCompositeOperation="source-over",E.setTransform(1,0,0,1,0,0),E.drawImage(n.canvas,0,0),E.restore())}function j(E,i){const n=l.Util.singularValueDecompose2dScale(E);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*y.PixelsPerInch.PDF_TO_CSS_UNITS);return i!==void 0?i:n[0]<=s||n[1]<=s}const X=["butt","round","square"],w=["miter","round","bevel"],$={},nt={},Pt=class Pt{constructor(i,n,s,o,d,{optionalContentConfig:_,markedContentStack:M=null},B,et){I(this,W);I(this,gt);this.ctx=i,this.current=new C(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=s,this.canvasFactory=o,this.filterFactory=d,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=M||[],this.optionalContentConfig=_,this.cachedCanvases=new v(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=B,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=et,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(i,n=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):n}beginDrawing({transform:i,viewport:n,transparency:s=!1,background:o=null}){const d=this.ctx.canvas.width,_=this.ctx.canvas.height,M=this.ctx.fillStyle;if(this.ctx.fillStyle=o||"#ffffff",this.ctx.fillRect(0,0,d,_),this.ctx.fillStyle=M,s){const B=this.cachedCanvases.getCanvas("transparent",d,_);this.compositeCtx=this.ctx,this.transparentCanvas=B.canvas,this.ctx=B.context,this.ctx.save(),this.ctx.transform(...(0,y.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),h(this.ctx),i&&(this.ctx.transform(...i),this.outputScaleX=i[0],this.outputScaleY=i[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=(0,y.getCurrentTransform)(this.ctx)}executeOperatorList(i,n,s,o){const d=i.argsArray,_=i.fnArray;let M=n||0;const B=d.length;if(B===M)return M;const et=B-M>O&&typeof s=="function",Z=et?Date.now()+p:0;let rt=0;const ht=this.commonObjs,yt=this.objs;let ut;for(;;){if(o!==void 0&&M===o.nextBreakPoint)return o.breakIt(M,s),M;if(ut=_[M],ut!==l.OPS.dependency)this[ut].apply(this,d[M]);else for(const Ft of d[M]){const Bt=Ft.startsWith("g_")?ht:yt;if(!Bt.has(Ft))return Bt.get(Ft,s),M}if(M++,M===B)return M;if(et&&++rt>O){if(Date.now()>Z)return s(),M;rt=0}}}endDrawing(){G(this,W,Qe).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const i of this._cachedBitmapsMap.values()){for(const n of i.values())typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.width=n.height=0);i.clear()}this._cachedBitmapsMap.clear(),G(this,gt,Ze).call(this)}_scaleImage(i,n){const s=i.width,o=i.height;let d=Math.max(Math.hypot(n[0],n[1]),1),_=Math.max(Math.hypot(n[2],n[3]),1),M=s,B=o,et="prescale1",Z,rt;for(;d>2&&M>1||_>2&&B>1;){let ht=M,yt=B;d>2&&M>1&&(ht=M>=16384?Math.floor(M/2)-1||1:Math.ceil(M/2),d/=M/ht),_>2&&B>1&&(yt=B>=16384?Math.floor(B/2)-1||1:Math.ceil(B)/2,_/=B/yt),Z=this.cachedCanvases.getCanvas(et,ht,yt),rt=Z.context,rt.clearRect(0,0,ht,yt),rt.drawImage(i,0,0,M,B,0,0,ht,yt),i=Z.canvas,M=ht,B=yt,et=et==="prescale1"?"prescale2":"prescale1"}return{img:i,paintWidth:M,paintHeight:B}}_createMaskCanvas(i){const n=this.ctx,{width:s,height:o}=i,d=this.current.fillColor,_=this.current.patternFill,M=(0,y.getCurrentTransform)(n);let B,et,Z,rt;if((i.bitmap||i.data)&&i.count>1){const Et=i.bitmap||i.data.buffer;et=JSON.stringify(_?M:[M.slice(0,4),d]),B=this._cachedBitmapsMap.get(Et),B||(B=new Map,this._cachedBitmapsMap.set(Et,B));const Ct=B.get(et);if(Ct&&!_){const jt=Math.round(Math.min(M[0],M[2])+M[4]),Gt=Math.round(Math.min(M[1],M[3])+M[5]);return{canvas:Ct,offsetX:jt,offsetY:Gt}}Z=Ct}Z||(rt=this.cachedCanvases.getCanvas("maskCanvas",s,o),A(rt.context,i));let ht=l.Util.transform(M,[1/s,0,0,-1/o,0,0]);ht=l.Util.transform(ht,[1,0,0,1,0,-o]);const yt=l.Util.applyTransform([0,0],ht),ut=l.Util.applyTransform([s,o],ht),Ft=l.Util.normalizeRect([yt[0],yt[1],ut[0],ut[1]]),Bt=Math.round(Ft[2]-Ft[0])||1,St=Math.round(Ft[3]-Ft[1])||1,Dt=this.cachedCanvases.getCanvas("fillCanvas",Bt,St),pt=Dt.context,J=Math.min(yt[0],ut[0]),Q=Math.min(yt[1],ut[1]);pt.translate(-J,-Q),pt.transform(...ht),Z||(Z=this._scaleImage(rt.canvas,(0,y.getCurrentTransformInverse)(pt)),Z=Z.img,B&&_&&B.set(et,Z)),pt.imageSmoothingEnabled=j((0,y.getCurrentTransform)(pt),i.interpolate),u(pt,Z,0,0,Z.width,Z.height,0,0,s,o),pt.globalCompositeOperation="source-in";const dt=l.Util.transform((0,y.getCurrentTransformInverse)(pt),[1,0,0,1,-J,-Q]);return pt.fillStyle=_?d.getPattern(n,this,dt,it.PathType.FILL):d,pt.fillRect(0,0,s,o),B&&!_&&(this.cachedCanvases.delete("fillCanvas"),B.set(et,Dt.canvas)),{canvas:Dt.canvas,offsetX:Math.round(J),offsetY:Math.round(Q)}}setLineWidth(i){i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(i){this.ctx.lineCap=X[i]}setLineJoin(i){this.ctx.lineJoin=w[i]}setMiterLimit(i){this.ctx.miterLimit=i}setDash(i,n){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(i),s.lineDashOffset=n)}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[n,s]of i)switch(n){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const i=this.inSMaskMode;this.current.activeSMask&&!i?this.beginSMaskMode():!this.current.activeSMask&&i&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const i=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(s,i,n);this.suspendedCtx=this.ctx,this.ctx=o.context;const d=this.ctx;d.setTransform(...(0,y.getCurrentTransform)(this.suspendedCtx)),a(this.suspendedCtx,d),S(d,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),a(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(i){if(!this.current.activeSMask)return;i?(i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.ceil(i[2]),i[3]=Math.ceil(i[3])):i=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const n=this.current.activeSMask,s=this.suspendedCtx;m(s,n,this.ctx,i),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(a(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const i=this.current;this.stateStack.push(i),this.current=i.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),a(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(i,n,s,o,d,_){this.ctx.transform(i,n,s,o,d,_),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(i,n,s){const o=this.ctx,d=this.current;let _=d.x,M=d.y,B,et;const Z=(0,y.getCurrentTransform)(o),rt=Z[0]===0&&Z[3]===0||Z[1]===0&&Z[2]===0,ht=rt?s.slice(0):null;for(let yt=0,ut=0,Ft=i.length;yt<Ft;yt++)switch(i[yt]|0){case l.OPS.rectangle:_=n[ut++],M=n[ut++];const Bt=n[ut++],St=n[ut++],Dt=_+Bt,pt=M+St;o.moveTo(_,M),Bt===0||St===0?o.lineTo(Dt,pt):(o.lineTo(Dt,M),o.lineTo(Dt,pt),o.lineTo(_,pt)),rt||d.updateRectMinMax(Z,[_,M,Dt,pt]),o.closePath();break;case l.OPS.moveTo:_=n[ut++],M=n[ut++],o.moveTo(_,M),rt||d.updatePathMinMax(Z,_,M);break;case l.OPS.lineTo:_=n[ut++],M=n[ut++],o.lineTo(_,M),rt||d.updatePathMinMax(Z,_,M);break;case l.OPS.curveTo:B=_,et=M,_=n[ut+4],M=n[ut+5],o.bezierCurveTo(n[ut],n[ut+1],n[ut+2],n[ut+3],_,M),d.updateCurvePathMinMax(Z,B,et,n[ut],n[ut+1],n[ut+2],n[ut+3],_,M,ht),ut+=6;break;case l.OPS.curveTo2:B=_,et=M,o.bezierCurveTo(_,M,n[ut],n[ut+1],n[ut+2],n[ut+3]),d.updateCurvePathMinMax(Z,B,et,_,M,n[ut],n[ut+1],n[ut+2],n[ut+3],ht),_=n[ut+2],M=n[ut+3],ut+=4;break;case l.OPS.curveTo3:B=_,et=M,_=n[ut+2],M=n[ut+3],o.bezierCurveTo(n[ut],n[ut+1],_,M,_,M),d.updateCurvePathMinMax(Z,B,et,n[ut],n[ut+1],_,M,_,M,ht),ut+=4;break;case l.OPS.closePath:o.closePath();break}rt&&d.updateScalingPathMinMax(Z,ht),d.setCurrentPoint(_,M)}closePath(){this.ctx.closePath()}stroke(i=!0){const n=this.ctx,s=this.current.strokeColor;n.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(n.save(),n.strokeStyle=s.getPattern(n,this,(0,y.getCurrentTransformInverse)(n),it.PathType.STROKE),this.rescaleAndStroke(!1),n.restore()):this.rescaleAndStroke(!0)),i&&this.consumePath(this.current.getClippedPathBoundingBox()),n.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(i=!0){const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;let d=!1;o&&(n.save(),n.fillStyle=s.getPattern(n,this,(0,y.getCurrentTransformInverse)(n),it.PathType.FILL),d=!0);const _=this.current.getClippedPathBoundingBox();this.contentVisible&&_!==null&&(this.pendingEOFill?(n.fill("evenodd"),this.pendingEOFill=!1):n.fill()),d&&n.restore(),i&&this.consumePath(_)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=$}eoClip(){this.pendingClip=nt}beginText(){this.current.textMatrix=l.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const i=this.pendingTextPaths,n=this.ctx;if(i===void 0){n.beginPath();return}n.save(),n.beginPath();for(const s of i)n.setTransform(...s.transform),n.translate(s.x,s.y),s.addToPath(n,s.fontSize);n.restore(),n.clip(),n.beginPath(),delete this.pendingTextPaths}setCharSpacing(i){this.current.charSpacing=i}setWordSpacing(i){this.current.wordSpacing=i}setHScale(i){this.current.textHScale=i/100}setLeading(i){this.current.leading=-i}setFont(i,n){var Z;const s=this.commonObjs.get(i),o=this.current;if(!s)throw new Error(`Can't find font for ${i}`);if(o.fontMatrix=s.fontMatrix||l.FONT_IDENTITY_MATRIX,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&(0,l.warn)("Invalid font matrix for font "+i),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const d=s.loadedName||"sans-serif",_=((Z=s.systemFontInfo)==null?void 0:Z.css)||`"${d}", ${s.fallbackName}`;let M="normal";s.black?M="900":s.bold&&(M="bold");const B=s.italic?"italic":"normal";let et=n;n<ct?et=ct:n>L&&(et=L),this.current.fontSizeScale=n/et,this.ctx.font=`${B} ${M} ${et}px ${_}`}setTextRenderingMode(i){this.current.textRenderingMode=i}setTextRise(i){this.current.textRise=i}moveText(i,n){this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=n}setLeadingMoveText(i,n){this.setLeading(-n),this.moveText(i,n)}setTextMatrix(i,n,s,o,d,_){this.current.textMatrix=[i,n,s,o,d,_],this.current.textMatrixScale=Math.hypot(i,n),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(i,n,s,o){const d=this.ctx,_=this.current,M=_.font,B=_.textRenderingMode,et=_.fontSize/_.fontSizeScale,Z=B&l.TextRenderingMode.FILL_STROKE_MASK,rt=!!(B&l.TextRenderingMode.ADD_TO_PATH_FLAG),ht=_.patternFill&&!M.missingFile;let yt;(M.disableFontFace||rt||ht)&&(yt=M.getPathGenerator(this.commonObjs,i)),M.disableFontFace||ht?(d.save(),d.translate(n,s),d.beginPath(),yt(d,et),o&&d.setTransform(...o),(Z===l.TextRenderingMode.FILL||Z===l.TextRenderingMode.FILL_STROKE)&&d.fill(),(Z===l.TextRenderingMode.STROKE||Z===l.TextRenderingMode.FILL_STROKE)&&d.stroke(),d.restore()):((Z===l.TextRenderingMode.FILL||Z===l.TextRenderingMode.FILL_STROKE)&&d.fillText(i,n,s),(Z===l.TextRenderingMode.STROKE||Z===l.TextRenderingMode.FILL_STROKE)&&d.strokeText(i,n,s)),rt&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,y.getCurrentTransform)(d),x:n,y:s,fontSize:et,addToPath:yt})}get isFontSubpixelAAEnabled(){const{context:i}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);i.scale(1.5,1),i.fillText("I",0,10);const n=i.getImageData(0,0,10,10).data;let s=!1;for(let o=3;o<n.length;o+=4)if(n[o]>0&&n[o]<255){s=!0;break}return(0,l.shadow)(this,"isFontSubpixelAAEnabled",s)}showText(i){const n=this.current,s=n.font;if(s.isType3Font)return this.showType3Text(i);const o=n.fontSize;if(o===0)return;const d=this.ctx,_=n.fontSizeScale,M=n.charSpacing,B=n.wordSpacing,et=n.fontDirection,Z=n.textHScale*et,rt=i.length,ht=s.vertical,yt=ht?1:-1,ut=s.defaultVMetrics,Ft=o*n.fontMatrix[0],Bt=n.textRenderingMode===l.TextRenderingMode.FILL&&!s.disableFontFace&&!n.patternFill;d.save(),d.transform(...n.textMatrix),d.translate(n.x,n.y+n.textRise),et>0?d.scale(Z,-1):d.scale(Z,1);let St;if(n.patternFill){d.save();const dt=n.fillColor.getPattern(d,this,(0,y.getCurrentTransformInverse)(d),it.PathType.FILL);St=(0,y.getCurrentTransform)(d),d.restore(),d.fillStyle=dt}let Dt=n.lineWidth;const pt=n.textMatrixScale;if(pt===0||Dt===0){const dt=n.textRenderingMode&l.TextRenderingMode.FILL_STROKE_MASK;(dt===l.TextRenderingMode.STROKE||dt===l.TextRenderingMode.FILL_STROKE)&&(Dt=this.getSinglePixelWidth())}else Dt/=pt;if(_!==1&&(d.scale(_,_),Dt/=_),d.lineWidth=Dt,s.isInvalidPDFjsFont){const dt=[];let Et=0;for(const Ct of i)dt.push(Ct.unicode),Et+=Ct.width;d.fillText(dt.join(""),0,0),n.x+=Et*Ft*Z,d.restore(),this.compose();return}let J=0,Q;for(Q=0;Q<rt;++Q){const dt=i[Q];if(typeof dt=="number"){J+=yt*dt*o/1e3;continue}let Et=!1;const Ct=(dt.isSpace?B:0)+M,jt=dt.fontChar,Gt=dt.accent;let Ht,Xt,$t=dt.width;if(ht){const qt=dt.vmetric||ut,ot=-(dt.vmetric?qt[1]:$t*.5)*Ft,Y=qt[2]*Ft;$t=qt?-qt[0]:$t,Ht=ot/_,Xt=(J+Y)/_}else Ht=J/_,Xt=0;if(s.remeasure&&$t>0){const qt=d.measureText(jt).width*1e3/o*_;if($t<qt&&this.isFontSubpixelAAEnabled){const ot=$t/qt;Et=!0,d.save(),d.scale(ot,1),Ht/=ot}else $t!==qt&&(Ht+=($t-qt)/2e3*o/_)}if(this.contentVisible&&(dt.isInFont||s.missingFile)){if(Bt&&!Gt)d.fillText(jt,Ht,Xt);else if(this.paintChar(jt,Ht,Xt,St),Gt){const qt=Ht+o*Gt.offset.x/_,ot=Xt-o*Gt.offset.y/_;this.paintChar(Gt.fontChar,qt,ot,St)}}const Wt=ht?$t*Ft-Ct*et:$t*Ft+Ct*et;J+=Wt,Et&&d.restore()}ht?n.y-=J:n.x+=J*Z,d.restore(),this.compose()}showType3Text(i){const n=this.ctx,s=this.current,o=s.font,d=s.fontSize,_=s.fontDirection,M=o.vertical?1:-1,B=s.charSpacing,et=s.wordSpacing,Z=s.textHScale*_,rt=s.fontMatrix||l.FONT_IDENTITY_MATRIX,ht=i.length,yt=s.textRenderingMode===l.TextRenderingMode.INVISIBLE;let ut,Ft,Bt,St;if(!(yt||d===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),n.transform(...s.textMatrix),n.translate(s.x,s.y),n.scale(Z,_),ut=0;ut<ht;++ut){if(Ft=i[ut],typeof Ft=="number"){St=M*Ft*d/1e3,this.ctx.translate(St,0),s.x+=St*Z;continue}const Dt=(Ft.isSpace?et:0)+B,pt=o.charProcOperatorList[Ft.operatorListId];if(!pt){(0,l.warn)(`Type3 character "${Ft.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Ft,this.save(),n.scale(d,d),n.transform(...rt),this.executeOperatorList(pt),this.restore()),Bt=l.Util.applyTransform([Ft.width,0],rt)[0]*d+Dt,n.translate(Bt,0),s.x+=Bt*Z}n.restore(),this.processingType3=null}}setCharWidth(i,n){}setCharWidthAndBounds(i,n,s,o,d,_){this.ctx.rect(s,o,d-s,_-o),this.ctx.clip(),this.endPath()}getColorN_Pattern(i){let n;if(i[0]==="TilingPattern"){const s=i[1],o=this.baseTransform||(0,y.getCurrentTransform)(this.ctx),d={createCanvasGraphics:_=>new Pt(_,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};n=new it.TilingPattern(i,s,this.ctx,d,o)}else n=this._getPattern(i[1],i[2]);return n}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(i,n,s){const o=l.Util.makeHexColor(i,n,s);this.ctx.strokeStyle=o,this.current.strokeColor=o}setFillRGBColor(i,n,s){const o=l.Util.makeHexColor(i,n,s);this.ctx.fillStyle=o,this.current.fillColor=o,this.current.patternFill=!1}_getPattern(i,n=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=(0,it.getShadingPattern)(this.getObject(i)),this.cachedPatterns.set(i,s)),n&&(s.matrix=n),s}shadingFill(i){if(!this.contentVisible)return;const n=this.ctx;this.save();const s=this._getPattern(i);n.fillStyle=s.getPattern(n,this,(0,y.getCurrentTransformInverse)(n),it.PathType.SHADING);const o=(0,y.getCurrentTransformInverse)(n);if(o){const{width:d,height:_}=n.canvas,[M,B,et,Z]=l.Util.getAxialAlignedBoundingBox([0,0,d,_],o);this.ctx.fillRect(M,B,et-M,Z-B)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,l.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,l.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(i,n){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(i)&&i.length===6&&this.transform(...i),this.baseTransform=(0,y.getCurrentTransform)(this.ctx),n)){const s=n[2]-n[0],o=n[3]-n[1];this.ctx.rect(n[0],n[1],s,o),this.current.updateRectMinMax((0,y.getCurrentTransform)(this.ctx),n),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(i){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;i.isolated||(0,l.info)("TODO: Support non-isolated groups."),i.knockout&&(0,l.warn)("Knockout groups not supported.");const s=(0,y.getCurrentTransform)(n);if(i.matrix&&n.transform(...i.matrix),!i.bbox)throw new Error("Bounding box is required.");let o=l.Util.getAxialAlignedBoundingBox(i.bbox,(0,y.getCurrentTransform)(n));const d=[0,0,n.canvas.width,n.canvas.height];o=l.Util.intersect(o,d)||[0,0,0,0];const _=Math.floor(o[0]),M=Math.floor(o[1]);let B=Math.max(Math.ceil(o[2])-_,1),et=Math.max(Math.ceil(o[3])-M,1),Z=1,rt=1;B>P&&(Z=B/P,B=P),et>P&&(rt=et/P,et=P),this.current.startNewPathAndClipBox([0,0,B,et]);let ht="groupAt"+this.groupLevel;i.smask&&(ht+="_smask_"+this.smaskCounter++%2);const yt=this.cachedCanvases.getCanvas(ht,B,et),ut=yt.context;ut.scale(1/Z,1/rt),ut.translate(-_,-M),ut.transform(...s),i.smask?this.smaskStack.push({canvas:yt.canvas,context:ut,offsetX:_,offsetY:M,scaleX:Z,scaleY:rt,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(_,M),n.scale(Z,rt),n.save()),a(n,ut),this.ctx=ut,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(i){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,i.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const o=(0,y.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...o);const d=l.Util.getAxialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o);this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(i,n,s,o,d){if(G(this,W,Qe).call(this),h(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(n)&&n.length===4){const _=n[2]-n[0],M=n[3]-n[1];if(d&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=_,n[3]=M;const[B,et]=l.Util.singularValueDecompose2dScale((0,y.getCurrentTransform)(this.ctx)),{viewportScale:Z}=this,rt=Math.ceil(_*this.outputScaleX*Z),ht=Math.ceil(M*this.outputScaleY*Z);this.annotationCanvas=this.canvasFactory.create(rt,ht);const{canvas:yt,context:ut}=this.annotationCanvas;this.annotationCanvasMap.set(i,yt),this.annotationCanvas.savedCtx=this.ctx,this.ctx=ut,this.ctx.save(),this.ctx.setTransform(B,0,0,-et,0,M*et),h(this.ctx)}else h(this.ctx),this.ctx.rect(n[0],n[1],_,M),this.ctx.clip(),this.endPath()}this.current=new C(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...o)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),G(this,gt,Ze).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(i){if(!this.contentVisible)return;const n=i.count;i=this.getObject(i.data,i),i.count=n;const s=this.ctx,o=this.processingType3;if(o&&(o.compiled===void 0&&(o.compiled=b(i)),o.compiled)){o.compiled(s);return}const d=this._createMaskCanvas(i),_=d.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(_,d.offsetX,d.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(i,n,s=0,o=0,d,_){if(!this.contentVisible)return;i=this.getObject(i.data,i);const M=this.ctx;M.save();const B=(0,y.getCurrentTransform)(M);M.transform(n,s,o,d,0,0);const et=this._createMaskCanvas(i);M.setTransform(1,0,0,1,et.offsetX-B[4],et.offsetY-B[5]);for(let Z=0,rt=_.length;Z<rt;Z+=2){const ht=l.Util.transform(B,[n,s,o,d,_[Z],_[Z+1]]),[yt,ut]=l.Util.applyTransform([0,0],ht);M.drawImage(et.canvas,yt,ut)}M.restore(),this.compose()}paintImageMaskXObjectGroup(i){if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;for(const d of i){const{data:_,width:M,height:B,transform:et}=d,Z=this.cachedCanvases.getCanvas("maskCanvas",M,B),rt=Z.context;rt.save();const ht=this.getObject(_,d);A(rt,ht),rt.globalCompositeOperation="source-in",rt.fillStyle=o?s.getPattern(rt,this,(0,y.getCurrentTransformInverse)(n),it.PathType.FILL):s,rt.fillRect(0,0,M,B),rt.restore(),n.save(),n.transform(...et),n.scale(1,-1),u(n,Z.canvas,0,0,M,B,0,-1,1,1),n.restore()}this.compose()}paintImageXObject(i){if(!this.contentVisible)return;const n=this.getObject(i);if(!n){(0,l.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(n)}paintImageXObjectRepeat(i,n,s,o){if(!this.contentVisible)return;const d=this.getObject(i);if(!d){(0,l.warn)("Dependent image isn't ready yet");return}const _=d.width,M=d.height,B=[];for(let et=0,Z=o.length;et<Z;et+=2)B.push({transform:[n,0,0,s,o[et],o[et+1]],x:0,y:0,w:_,h:M});this.paintInlineImageXObjectGroup(d,B)}applyTransferMapsToCanvas(i){return this.current.transferMaps!=="none"&&(i.filter=this.current.transferMaps,i.drawImage(i.canvas,0,0),i.filter="none"),i.canvas}applyTransferMapsToBitmap(i){if(this.current.transferMaps==="none")return i.bitmap;const{bitmap:n,width:s,height:o}=i,d=this.cachedCanvases.getCanvas("inlineImage",s,o),_=d.context;return _.filter=this.current.transferMaps,_.drawImage(n,0,0),_.filter="none",d.canvas}paintInlineImageXObject(i){if(!this.contentVisible)return;const n=i.width,s=i.height,o=this.ctx;if(this.save(),!l.isNodeJS){const{filter:M}=o;M!=="none"&&M!==""&&(o.filter="none")}o.scale(1/n,-1/s);let d;if(i.bitmap)d=this.applyTransferMapsToBitmap(i);else if(typeof HTMLElement=="function"&&i instanceof HTMLElement||!i.data)d=i;else{const B=this.cachedCanvases.getCanvas("inlineImage",n,s).context;T(B,i),d=this.applyTransferMapsToCanvas(B)}const _=this._scaleImage(d,(0,y.getCurrentTransformInverse)(o));o.imageSmoothingEnabled=j((0,y.getCurrentTransform)(o),i.interpolate),u(o,_.img,0,0,_.paintWidth,_.paintHeight,0,-s,n,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(i,n){if(!this.contentVisible)return;const s=this.ctx;let o;if(i.bitmap)o=i.bitmap;else{const d=i.width,_=i.height,B=this.cachedCanvases.getCanvas("inlineImage",d,_).context;T(B,i),o=this.applyTransferMapsToCanvas(B)}for(const d of n)s.save(),s.transform(...d.transform),s.scale(1,-1),u(s,o,d.x,d.y,d.w,d.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(i){}markPointProps(i,n){}beginMarkedContent(i){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(i,n){i==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(i){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip&&(n||(this.pendingClip===nt?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const i=(0,y.getCurrentTransform)(this.ctx);if(i[1]===0&&i[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3]));else{const n=Math.abs(i[0]*i[3]-i[2]*i[1]),s=Math.hypot(i[0],i[2]),o=Math.hypot(i[1],i[3]);this._cachedGetSinglePixelWidth=Math.max(s,o)/n}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:i}=this.current,{a:n,b:s,c:o,d}=this.ctx.getTransform();let _,M;if(s===0&&o===0){const B=Math.abs(n),et=Math.abs(d);if(B===et)if(i===0)_=M=1/B;else{const Z=B*i;_=M=Z<1?1/Z:1}else if(i===0)_=1/B,M=1/et;else{const Z=B*i,rt=et*i;_=Z<1?1/Z:1,M=rt<1?1/rt:1}}else{const B=Math.abs(n*d-s*o),et=Math.hypot(n,s),Z=Math.hypot(o,d);if(i===0)_=Z/B,M=et/B;else{const rt=i*B;_=Z>rt?Z/rt:1,M=et>rt?et/rt:1}}this._cachedScaleForStroking[0]=_,this._cachedScaleForStroking[1]=M}return this._cachedScaleForStroking}rescaleAndStroke(i){const{ctx:n}=this,{lineWidth:s}=this.current,[o,d]=this.getScaleForStroking();if(n.lineWidth=s||1,o===1&&d===1){n.stroke();return}const _=n.getLineDash();if(i&&n.save(),n.scale(o,d),_.length>0){const M=Math.max(o,d);n.setLineDash(_.map(B=>B/M)),n.lineDashOffset/=M}n.stroke(),i&&n.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};W=new WeakSet,Qe=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},gt=new WeakSet,Ze=function(){if(this.pageColors){const i=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(i!=="none"){const n=this.ctx.filter;this.ctx.filter=i,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=n}}};let at=Pt;c.CanvasGraphics=at;for(const E in l.OPS)at.prototype[E]!==void 0&&(at.prototype[l.OPS[E]]=at.prototype[E])},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.TilingPattern=c.PathType=void 0,c.getShadingPattern=k;var l=K(1),y=K(6);const it={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};c.PathType=it;function U(b,C){if(!C)return;const T=C[2]-C[0],A=C[3]-C[1],a=new Path2D;a.rect(C[0],C[1],T,A),b.clip(a)}class ct{constructor(){this.constructor===ct&&(0,l.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,l.unreachable)("Abstract method `getPattern` called.")}}class L extends ct{constructor(C){super(),this._type=C[1],this._bbox=C[2],this._colorStops=C[3],this._p0=C[4],this._p1=C[5],this._r0=C[6],this._r1=C[7],this.matrix=null}_createGradient(C){let T;this._type==="axial"?T=C.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(T=C.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const A of this._colorStops)T.addColorStop(A[0],A[1]);return T}getPattern(C,T,A,a){let h;if(a===it.STROKE||a===it.FILL){const F=T.current.getClippedPathBoundingBox(a,(0,y.getCurrentTransform)(C))||[0,0,0,0],g=Math.ceil(F[2]-F[0])||1,r=Math.ceil(F[3]-F[1])||1,x=T.cachedCanvases.getCanvas("pattern",g,r,!0),m=x.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-F[0],-F[1]),A=l.Util.transform(A,[1,0,0,1,F[0],F[1]]),m.transform(...T.baseTransform),this.matrix&&m.transform(...this.matrix),U(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),h=C.createPattern(x.canvas,"no-repeat");const j=new DOMMatrix(A);h.setTransform(j)}else U(C,this._bbox),h=this._createGradient(C);return h}}function P(b,C,T,A,a,h,F,g){const r=C.coords,x=C.colors,m=b.data,j=b.width*4;let X;r[T+1]>r[A+1]&&(X=T,T=A,A=X,X=h,h=F,F=X),r[A+1]>r[a+1]&&(X=A,A=a,a=X,X=F,F=g,g=X),r[T+1]>r[A+1]&&(X=T,T=A,A=X,X=h,h=F,F=X);const w=(r[T]+C.offsetX)*C.scaleX,$=(r[T+1]+C.offsetY)*C.scaleY,nt=(r[A]+C.offsetX)*C.scaleX,at=(r[A+1]+C.offsetY)*C.scaleY,W=(r[a]+C.offsetX)*C.scaleX,lt=(r[a+1]+C.offsetY)*C.scaleY;if($>=lt)return;const gt=x[h],wt=x[h+1],Pt=x[h+2],E=x[F],i=x[F+1],n=x[F+2],s=x[g],o=x[g+1],d=x[g+2],_=Math.round($),M=Math.round(lt);let B,et,Z,rt,ht,yt,ut,Ft;for(let Bt=_;Bt<=M;Bt++){if(Bt<at){const Q=Bt<$?0:($-Bt)/($-at);B=w-(w-nt)*Q,et=gt-(gt-E)*Q,Z=wt-(wt-i)*Q,rt=Pt-(Pt-n)*Q}else{let Q;Bt>lt?Q=1:at===lt?Q=0:Q=(at-Bt)/(at-lt),B=nt-(nt-W)*Q,et=E-(E-s)*Q,Z=i-(i-o)*Q,rt=n-(n-d)*Q}let St;Bt<$?St=0:Bt>lt?St=1:St=($-Bt)/($-lt),ht=w-(w-W)*St,yt=gt-(gt-s)*St,ut=wt-(wt-o)*St,Ft=Pt-(Pt-d)*St;const Dt=Math.round(Math.min(B,ht)),pt=Math.round(Math.max(B,ht));let J=j*Bt+Dt*4;for(let Q=Dt;Q<=pt;Q++)St=(B-Q)/(B-ht),St<0?St=0:St>1&&(St=1),m[J++]=et-(et-yt)*St|0,m[J++]=Z-(Z-ut)*St|0,m[J++]=rt-(rt-Ft)*St|0,m[J++]=255}}function p(b,C,T){const A=C.coords,a=C.colors;let h,F;switch(C.type){case"lattice":const g=C.verticesPerRow,r=Math.floor(A.length/g)-1,x=g-1;for(h=0;h<r;h++){let m=h*g;for(let j=0;j<x;j++,m++)P(b,T,A[m],A[m+1],A[m+g],a[m],a[m+1],a[m+g]),P(b,T,A[m+g+1],A[m+1],A[m+g],a[m+g+1],a[m+1],a[m+g])}break;case"triangles":for(h=0,F=A.length;h<F;h+=3)P(b,T,A[h],A[h+1],A[h+2],a[h],a[h+1],a[h+2]);break;default:throw new Error("illegal figure")}}class O extends ct{constructor(C){super(),this._coords=C[2],this._colors=C[3],this._figures=C[4],this._bounds=C[5],this._bbox=C[7],this._background=C[8],this.matrix=null}_createMeshCanvas(C,T,A){const g=Math.floor(this._bounds[0]),r=Math.floor(this._bounds[1]),x=Math.ceil(this._bounds[2])-g,m=Math.ceil(this._bounds[3])-r,j=Math.min(Math.ceil(Math.abs(x*C[0]*1.1)),3e3),X=Math.min(Math.ceil(Math.abs(m*C[1]*1.1)),3e3),w=x/j,$=m/X,nt={coords:this._coords,colors:this._colors,offsetX:-g,offsetY:-r,scaleX:1/w,scaleY:1/$},at=j+2*2,W=X+2*2,lt=A.getCanvas("mesh",at,W,!1),gt=lt.context,wt=gt.createImageData(j,X);if(T){const E=wt.data;for(let i=0,n=E.length;i<n;i+=4)E[i]=T[0],E[i+1]=T[1],E[i+2]=T[2],E[i+3]=255}for(const E of this._figures)p(wt,E,nt);return gt.putImageData(wt,2,2),{canvas:lt.canvas,offsetX:g-2*w,offsetY:r-2*$,scaleX:w,scaleY:$}}getPattern(C,T,A,a){U(C,this._bbox);let h;if(a===it.SHADING)h=l.Util.singularValueDecompose2dScale((0,y.getCurrentTransform)(C));else if(h=l.Util.singularValueDecompose2dScale(T.baseTransform),this.matrix){const g=l.Util.singularValueDecompose2dScale(this.matrix);h=[h[0]*g[0],h[1]*g[1]]}const F=this._createMeshCanvas(h,a===it.SHADING?null:this._background,T.cachedCanvases);return a!==it.SHADING&&(C.setTransform(...T.baseTransform),this.matrix&&C.transform(...this.matrix)),C.translate(F.offsetX,F.offsetY),C.scale(F.scaleX,F.scaleY),C.createPattern(F.canvas,"no-repeat")}}class N extends ct{getPattern(){return"hotpink"}}function k(b){switch(b[0]){case"RadialAxial":return new L(b);case"Mesh":return new O(b);case"Dummy":return new N}throw new Error(`Unknown IR type: ${b[0]}`)}const S={COLORED:1,UNCOLORED:2},u=class u{constructor(C,T,A,a,h){this.operatorList=C[2],this.matrix=C[3]||[1,0,0,1,0,0],this.bbox=C[4],this.xstep=C[5],this.ystep=C[6],this.paintType=C[7],this.tilingType=C[8],this.color=T,this.ctx=A,this.canvasGraphicsFactory=a,this.baseTransform=h}createPatternCanvas(C){const T=this.operatorList,A=this.bbox,a=this.xstep,h=this.ystep,F=this.paintType,g=this.tilingType,r=this.color,x=this.canvasGraphicsFactory;(0,l.info)("TilingType: "+g);const m=A[0],j=A[1],X=A[2],w=A[3],$=l.Util.singularValueDecompose2dScale(this.matrix),nt=l.Util.singularValueDecompose2dScale(this.baseTransform),at=[$[0]*nt[0],$[1]*nt[1]],W=this.getSizeAndScale(a,this.ctx.canvas.width,at[0]),lt=this.getSizeAndScale(h,this.ctx.canvas.height,at[1]),gt=C.cachedCanvases.getCanvas("pattern",W.size,lt.size,!0),wt=gt.context,Pt=x.createCanvasGraphics(wt);Pt.groupLevel=C.groupLevel,this.setFillAndStrokeStyleToContext(Pt,F,r);let E=m,i=j,n=X,s=w;return m<0&&(E=0,n+=Math.abs(m)),j<0&&(i=0,s+=Math.abs(j)),wt.translate(-(W.scale*E),-(lt.scale*i)),Pt.transform(W.scale,0,0,lt.scale,0,0),wt.save(),this.clipBbox(Pt,E,i,n,s),Pt.baseTransform=(0,y.getCurrentTransform)(Pt.ctx),Pt.executeOperatorList(T),Pt.endDrawing(),{canvas:gt.canvas,scaleX:W.scale,scaleY:lt.scale,offsetX:E,offsetY:i}}getSizeAndScale(C,T,A){C=Math.abs(C);const a=Math.max(u.MAX_PATTERN_SIZE,T);let h=Math.ceil(C*A);return h>=a?h=a:A=h/C,{scale:A,size:h}}clipBbox(C,T,A,a,h){const F=a-T,g=h-A;C.ctx.rect(T,A,F,g),C.current.updateRectMinMax((0,y.getCurrentTransform)(C.ctx),[T,A,a,h]),C.clip(),C.endPath()}setFillAndStrokeStyleToContext(C,T,A){const a=C.ctx,h=C.current;switch(T){case S.COLORED:const F=this.ctx;a.fillStyle=F.fillStyle,a.strokeStyle=F.strokeStyle,h.fillColor=F.fillStyle,h.strokeColor=F.strokeStyle;break;case S.UNCOLORED:const g=l.Util.makeHexColor(A[0],A[1],A[2]);a.fillStyle=g,a.strokeStyle=g,h.fillColor=g,h.strokeColor=g;break;default:throw new l.FormatError(`Unsupported paint type: ${T}`)}}getPattern(C,T,A,a){let h=A;a!==it.SHADING&&(h=l.Util.transform(h,T.baseTransform),this.matrix&&(h=l.Util.transform(h,this.matrix)));const F=this.createPatternCanvas(T);let g=new DOMMatrix(h);g=g.translate(F.offsetX,F.offsetY),g=g.scale(1/F.scaleX,1/F.scaleY);const r=C.createPattern(F.canvas,"repeat");return r.setTransform(g),r}};ee(u,"MAX_PATTERN_SIZE",3e3);let v=u;c.TilingPattern=v},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.convertBlackAndWhiteToRGBA=it,c.convertToRGBA=y,c.grayToRGBA=ct;var l=K(1);function y(L){switch(L.kind){case l.ImageKind.GRAYSCALE_1BPP:return it(L);case l.ImageKind.RGB_24BPP:return U(L)}return null}function it({src:L,srcPos:P=0,dest:p,width:O,height:N,nonBlackColor:k=4294967295,inverseDecode:S=!1}){const v=l.FeatureTest.isLittleEndian?4278190080:255,[u,b]=S?[k,v]:[v,k],C=O>>3,T=O&7,A=L.length;p=new Uint32Array(p.buffer);let a=0;for(let h=0;h<N;h++){for(const g=P+C;P<g;P++){const r=P<A?L[P]:255;p[a++]=r&128?b:u,p[a++]=r&64?b:u,p[a++]=r&32?b:u,p[a++]=r&16?b:u,p[a++]=r&8?b:u,p[a++]=r&4?b:u,p[a++]=r&2?b:u,p[a++]=r&1?b:u}if(T===0)continue;const F=P<A?L[P++]:255;for(let g=0;g<T;g++)p[a++]=F&1<<7-g?b:u}return{srcPos:P,destPos:a}}function U({src:L,srcPos:P=0,dest:p,destPos:O=0,width:N,height:k}){let S=0;const v=L.length>>2,u=new Uint32Array(L.buffer,P,v);if(l.FeatureTest.isLittleEndian){for(;S<v-2;S+=3,O+=4){const b=u[S],C=u[S+1],T=u[S+2];p[O]=b|4278190080,p[O+1]=b>>>24|C<<8|4278190080,p[O+2]=C>>>16|T<<16|4278190080,p[O+3]=T>>>8|4278190080}for(let b=S*4,C=L.length;b<C;b+=3)p[O++]=L[b]|L[b+1]<<8|L[b+2]<<16|4278190080}else{for(;S<v-2;S+=3,O+=4){const b=u[S],C=u[S+1],T=u[S+2];p[O]=b|255,p[O+1]=b<<24|C>>>8|255,p[O+2]=C<<16|T>>>16|255,p[O+3]=T<<8|255}for(let b=S*4,C=L.length;b<C;b+=3)p[O++]=L[b]<<24|L[b+1]<<16|L[b+2]<<8|255}return{srcPos:P,destPos:O}}function ct(L,P){if(l.FeatureTest.isLittleEndian)for(let p=0,O=L.length;p<O;p++)P[p]=L[p]*65793|4278190080;else for(let p=0,O=L.length;p<O;p++)P[p]=L[p]*16843008|255}},(ft,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.GlobalWorkerOptions=void 0;const K=Object.create(null);c.GlobalWorkerOptions=K,K.workerPort=null,K.workerSrc=""},(ft,c,K)=>{var L,Pi,p,ki,N,Pe;Object.defineProperty(c,"__esModule",{value:!0}),c.MessageHandler=void 0;var l=K(1);const y={UNKNOWN:0,DATA:1,ERROR:2},it={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function U(S){switch(S instanceof Error||typeof S=="object"&&S!==null||(0,l.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),S.name){case"AbortException":return new l.AbortException(S.message);case"MissingPDFException":return new l.MissingPDFException(S.message);case"PasswordException":return new l.PasswordException(S.message,S.code);case"UnexpectedResponseException":return new l.UnexpectedResponseException(S.message,S.status);case"UnknownErrorException":return new l.UnknownErrorException(S.message,S.details);default:return new l.UnknownErrorException(S.message,S.toString())}}class ct{constructor(v,u,b){I(this,L);I(this,p);I(this,N);this.sourceName=v,this.targetName=u,this.comObj=b,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=C=>{const T=C.data;if(T.targetName!==this.sourceName)return;if(T.stream){G(this,p,ki).call(this,T);return}if(T.callback){const a=T.callbackId,h=this.callbackCapabilities[a];if(!h)throw new Error(`Cannot resolve callback ${a}`);if(delete this.callbackCapabilities[a],T.callback===y.DATA)h.resolve(T.data);else if(T.callback===y.ERROR)h.reject(U(T.reason));else throw new Error("Unexpected callback case");return}const A=this.actionHandler[T.action];if(!A)throw new Error(`Unknown action from worker: ${T.action}`);if(T.callbackId){const a=this.sourceName,h=T.sourceName;new Promise(function(F){F(A(T.data))}).then(function(F){b.postMessage({sourceName:a,targetName:h,callback:y.DATA,callbackId:T.callbackId,data:F})},function(F){b.postMessage({sourceName:a,targetName:h,callback:y.ERROR,callbackId:T.callbackId,reason:U(F)})});return}if(T.streamId){G(this,L,Pi).call(this,T);return}A(T.data)},b.addEventListener("message",this._onComObjOnMessage)}on(v,u){const b=this.actionHandler;if(b[v])throw new Error(`There is already an actionName called "${v}"`);b[v]=u}send(v,u,b){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,data:u},b)}sendWithPromise(v,u,b){const C=this.callbackId++,T=new l.PromiseCapability;this.callbackCapabilities[C]=T;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,callbackId:C,data:u},b)}catch(A){T.reject(A)}return T.promise}sendWithStream(v,u,b,C){const T=this.streamId++,A=this.sourceName,a=this.targetName,h=this.comObj;return new ReadableStream({start:F=>{const g=new l.PromiseCapability;return this.streamControllers[T]={controller:F,startCall:g,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:A,targetName:a,action:v,streamId:T,data:u,desiredSize:F.desiredSize},C),g.promise},pull:F=>{const g=new l.PromiseCapability;return this.streamControllers[T].pullCall=g,h.postMessage({sourceName:A,targetName:a,stream:it.PULL,streamId:T,desiredSize:F.desiredSize}),g.promise},cancel:F=>{(0,l.assert)(F instanceof Error,"cancel must have a valid reason");const g=new l.PromiseCapability;return this.streamControllers[T].cancelCall=g,this.streamControllers[T].isClosed=!0,h.postMessage({sourceName:A,targetName:a,stream:it.CANCEL,streamId:T,reason:U(F)}),g.promise}},b)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}L=new WeakSet,Pi=function(v){const u=v.streamId,b=this.sourceName,C=v.sourceName,T=this.comObj,A=this,a=this.actionHandler[v.action],h={enqueue(F,g=1,r){if(this.isCancelled)return;const x=this.desiredSize;this.desiredSize-=g,x>0&&this.desiredSize<=0&&(this.sinkCapability=new l.PromiseCapability,this.ready=this.sinkCapability.promise),T.postMessage({sourceName:b,targetName:C,stream:it.ENQUEUE,streamId:u,chunk:F},r)},close(){this.isCancelled||(this.isCancelled=!0,T.postMessage({sourceName:b,targetName:C,stream:it.CLOSE,streamId:u}),delete A.streamSinks[u])},error(F){(0,l.assert)(F instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,T.postMessage({sourceName:b,targetName:C,stream:it.ERROR,streamId:u,reason:U(F)}))},sinkCapability:new l.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:v.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[u]=h,new Promise(function(F){F(a(v.data,h))}).then(function(){T.postMessage({sourceName:b,targetName:C,stream:it.START_COMPLETE,streamId:u,success:!0})},function(F){T.postMessage({sourceName:b,targetName:C,stream:it.START_COMPLETE,streamId:u,reason:U(F)})})},p=new WeakSet,ki=function(v){const u=v.streamId,b=this.sourceName,C=v.sourceName,T=this.comObj,A=this.streamControllers[u],a=this.streamSinks[u];switch(v.stream){case it.START_COMPLETE:v.success?A.startCall.resolve():A.startCall.reject(U(v.reason));break;case it.PULL_COMPLETE:v.success?A.pullCall.resolve():A.pullCall.reject(U(v.reason));break;case it.PULL:if(!a){T.postMessage({sourceName:b,targetName:C,stream:it.PULL_COMPLETE,streamId:u,success:!0});break}a.desiredSize<=0&&v.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=v.desiredSize,new Promise(function(h){var F;h((F=a.onPull)==null?void 0:F.call(a))}).then(function(){T.postMessage({sourceName:b,targetName:C,stream:it.PULL_COMPLETE,streamId:u,success:!0})},function(h){T.postMessage({sourceName:b,targetName:C,stream:it.PULL_COMPLETE,streamId:u,reason:U(h)})});break;case it.ENQUEUE:if((0,l.assert)(A,"enqueue should have stream controller"),A.isClosed)break;A.controller.enqueue(v.chunk);break;case it.CLOSE:if((0,l.assert)(A,"close should have stream controller"),A.isClosed)break;A.isClosed=!0,A.controller.close(),G(this,N,Pe).call(this,A,u);break;case it.ERROR:(0,l.assert)(A,"error should have stream controller"),A.controller.error(U(v.reason)),G(this,N,Pe).call(this,A,u);break;case it.CANCEL_COMPLETE:v.success?A.cancelCall.resolve():A.cancelCall.reject(U(v.reason)),G(this,N,Pe).call(this,A,u);break;case it.CANCEL:if(!a)break;new Promise(function(h){var F;h((F=a.onCancel)==null?void 0:F.call(a,U(v.reason)))}).then(function(){T.postMessage({sourceName:b,targetName:C,stream:it.CANCEL_COMPLETE,streamId:u,success:!0})},function(h){T.postMessage({sourceName:b,targetName:C,stream:it.CANCEL_COMPLETE,streamId:u,reason:U(h)})}),a.sinkCapability.reject(U(v.reason)),a.isCancelled=!0,delete this.streamSinks[u];break;default:throw new Error("Unexpected stream case")}},N=new WeakSet,Pe=async function(v,u){var b,C,T;await Promise.allSettled([(b=v.startCall)==null?void 0:b.promise,(C=v.pullCall)==null?void 0:C.promise,(T=v.cancelCall)==null?void 0:T.promise]),delete this.streamControllers[u]},c.MessageHandler=ct},(ft,c,K)=>{var it,U;Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;var l=K(1);class y{constructor({parsedData:L,rawData:P}){I(this,it,void 0);I(this,U,void 0);tt(this,it,L),tt(this,U,P)}getRaw(){return t(this,U)}get(L){return t(this,it).get(L)??null}getAll(){return(0,l.objectFromMap)(t(this,it))}has(L){return t(this,it).has(L)}}it=new WeakMap,U=new WeakMap,c.Metadata=y},(ft,c,K)=>{var L,P,p,O,N,k,ti;Object.defineProperty(c,"__esModule",{value:!0}),c.OptionalContentConfig=void 0;var l=K(1),y=K(8);const it=Symbol("INTERNAL");class U{constructor(u,b){I(this,L,!0);this.name=u,this.intent=b}get visible(){return t(this,L)}_setVisible(u,b){u!==it&&(0,l.unreachable)("Internal method `_setVisible` called."),tt(this,L,b)}}L=new WeakMap;class ct{constructor(u){I(this,k);I(this,P,null);I(this,p,new Map);I(this,O,null);I(this,N,null);if(this.name=null,this.creator=null,u!==null){this.name=u.name,this.creator=u.creator,tt(this,N,u.order);for(const b of u.groups)t(this,p).set(b.id,new U(b.name,b.intent));if(u.baseState==="OFF")for(const b of t(this,p).values())b._setVisible(it,!1);for(const b of u.on)t(this,p).get(b)._setVisible(it,!0);for(const b of u.off)t(this,p).get(b)._setVisible(it,!1);tt(this,O,this.getHash())}}isVisible(u){if(t(this,p).size===0)return!0;if(!u)return(0,l.warn)("Optional content group not defined."),!0;if(u.type==="OCG")return t(this,p).has(u.id)?t(this,p).get(u.id).visible:((0,l.warn)(`Optional content group not found: ${u.id}`),!0);if(u.type==="OCMD"){if(u.expression)return G(this,k,ti).call(this,u.expression);if(!u.policy||u.policy==="AnyOn"){for(const b of u.ids){if(!t(this,p).has(b))return(0,l.warn)(`Optional content group not found: ${b}`),!0;if(t(this,p).get(b).visible)return!0}return!1}else if(u.policy==="AllOn"){for(const b of u.ids){if(!t(this,p).has(b))return(0,l.warn)(`Optional content group not found: ${b}`),!0;if(!t(this,p).get(b).visible)return!1}return!0}else if(u.policy==="AnyOff"){for(const b of u.ids){if(!t(this,p).has(b))return(0,l.warn)(`Optional content group not found: ${b}`),!0;if(!t(this,p).get(b).visible)return!0}return!1}else if(u.policy==="AllOff"){for(const b of u.ids){if(!t(this,p).has(b))return(0,l.warn)(`Optional content group not found: ${b}`),!0;if(t(this,p).get(b).visible)return!1}return!0}return(0,l.warn)(`Unknown optional content policy ${u.policy}.`),!0}return(0,l.warn)(`Unknown group type ${u.type}.`),!0}setVisibility(u,b=!0){if(!t(this,p).has(u)){(0,l.warn)(`Optional content group not found: ${u}`);return}t(this,p).get(u)._setVisible(it,!!b),tt(this,P,null)}get hasInitialVisibility(){return t(this,O)===null||this.getHash()===t(this,O)}getOrder(){return t(this,p).size?t(this,N)?t(this,N).slice():[...t(this,p).keys()]:null}getGroups(){return t(this,p).size>0?(0,l.objectFromMap)(t(this,p)):null}getGroup(u){return t(this,p).get(u)||null}getHash(){if(t(this,P)!==null)return t(this,P);const u=new y.MurmurHash3_64;for(const[b,C]of t(this,p))u.update(`${b}:${C.visible}`);return tt(this,P,u.hexdigest())}}P=new WeakMap,p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakSet,ti=function(u){const b=u.length;if(b<2)return!0;const C=u[0];for(let T=1;T<b;T++){const A=u[T];let a;if(Array.isArray(A))a=G(this,k,ti).call(this,A);else if(t(this,p).has(A))a=t(this,p).get(A).visible;else return(0,l.warn)(`Optional content group not found: ${A}`),!0;switch(C){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return C==="And"},c.OptionalContentConfig=ct},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.PDFDataTransportStream=void 0;var l=K(1),y=K(6);class it{constructor({length:P,initialData:p,progressiveDone:O=!1,contentDispositionFilename:N=null,disableRange:k=!1,disableStream:S=!1},v){if((0,l.assert)(v,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=O,this._contentDispositionFilename=N,(p==null?void 0:p.length)>0){const u=p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength?p.buffer:new Uint8Array(p).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=v,this._isStreamingSupported=!S,this._isRangeSupported=!k,this._contentLength=P,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((u,b)=>{this._onReceiveData({begin:u,chunk:b})}),this._pdfDataRangeTransport.addProgressListener((u,b)=>{this._onProgress({loaded:u,total:b})}),this._pdfDataRangeTransport.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:P,chunk:p}){const O=p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength?p.buffer:new Uint8Array(p).buffer;if(P===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(O):this._queuedChunks.push(O);else{const N=this._rangeReaders.some(function(k){return k._begin!==P?!1:(k._enqueue(O),!0)});(0,l.assert)(N,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var P;return((P=this._fullRequestReader)==null?void 0:P._loaded)??0}_onProgress(P){var p,O,N,k;P.total===void 0?(O=(p=this._rangeReaders[0])==null?void 0:p.onProgress)==null||O.call(p,{loaded:P.loaded}):(k=(N=this._fullRequestReader)==null?void 0:N.onProgress)==null||k.call(N,{loaded:P.loaded,total:P.total})}_onProgressiveDone(){var P;(P=this._fullRequestReader)==null||P.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(P){const p=this._rangeReaders.indexOf(P);p>=0&&this._rangeReaders.splice(p,1)}getFullReader(){(0,l.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const P=this._queuedChunks;return this._queuedChunks=null,new U(this,P,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(P,p){if(p<=this._progressiveDataLength)return null;const O=new ct(this,P,p);return this._pdfDataRangeTransport.requestDataRange(P,p),this._rangeReaders.push(O),O}cancelAllRequests(P){var p;(p=this._fullRequestReader)==null||p.cancel(P);for(const O of this._rangeReaders.slice(0))O.cancel(P);this._pdfDataRangeTransport.abort()}}c.PDFDataTransportStream=it;class U{constructor(P,p,O=!1,N=null){this._stream=P,this._done=O||!1,this._filename=(0,y.isPdfFile)(N)?N:null,this._queuedChunks=p||[],this._loaded=0;for(const k of this._queuedChunks)this._loaded+=k.byteLength;this._requests=[],this._headersReady=Promise.resolve(),P._fullRequestReader=this,this.onProgress=null}_enqueue(P){this._done||(this._requests.length>0?this._requests.shift().resolve({value:P,done:!1}):this._queuedChunks.push(P),this._loaded+=P.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const P=new l.PromiseCapability;return this._requests.push(P),P.promise}cancel(P){this._done=!0;for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class ct{constructor(P,p,O){this._stream=P,this._begin=p,this._end=O,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(P){if(!this._done){if(this._requests.length===0)this._queuedChunk=P;else{this._requests.shift().resolve({value:P,done:!1});for(const O of this._requests)O.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const p=this._queuedChunk;return this._queuedChunk=null,{value:p,done:!1}}if(this._done)return{value:void 0,done:!0};const P=new l.PromiseCapability;return this._requests.push(P),P.promise}cancel(P){this._done=!0;for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.PDFFetchStream=void 0;var l=K(1),y=K(20);function it(O,N,k){return{method:"GET",headers:O,signal:k.signal,mode:"cors",credentials:N?"include":"same-origin",redirect:"follow"}}function U(O){const N=new Headers;for(const k in O){const S=O[k];S!==void 0&&N.append(k,S)}return N}function ct(O){return O instanceof Uint8Array?O.buffer:O instanceof ArrayBuffer?O:((0,l.warn)(`getArrayBuffer - unexpected data format: ${O}`),new Uint8Array(O).buffer)}class L{constructor(N){this.source=N,this.isHttp=/^https?:/i.test(N.url),this.httpHeaders=this.isHttp&&N.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var N;return((N=this._fullRequestReader)==null?void 0:N._loaded)??0}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new P(this),this._fullRequestReader}getRangeReader(N,k){if(k<=this._progressiveDataLength)return null;const S=new p(this,N,k);return this._rangeRequestReaders.push(S),S}cancelAllRequests(N){var k;(k=this._fullRequestReader)==null||k.cancel(N);for(const S of this._rangeRequestReaders.slice(0))S.cancel(N)}}c.PDFFetchStream=L;class P{constructor(N){this._stream=N,this._reader=null,this._loaded=0,this._filename=null;const k=N.source;this._withCredentials=k.withCredentials||!1,this._contentLength=k.length,this._headersCapability=new l.PromiseCapability,this._disableRange=k.disableRange||!1,this._rangeChunkSize=k.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!k.disableStream,this._isRangeSupported=!k.disableRange,this._headers=U(this._stream.httpHeaders);const S=k.url;fetch(S,it(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,y.validateResponseStatus)(v.status))throw(0,y.createResponseStatusError)(v.status,S);this._reader=v.body.getReader(),this._headersCapability.resolve();const u=T=>v.headers.get(T),{allowRangeRequests:b,suggestedLength:C}=(0,y.validateRangeRequestCapabilities)({getResponseHeader:u,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=b,this._contentLength=C||this._contentLength,this._filename=(0,y.extractFilenameFromHeader)(u),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new l.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var S;await this._headersCapability.promise;const{value:N,done:k}=await this._reader.read();return k?{value:N,done:k}:(this._loaded+=N.byteLength,(S=this.onProgress)==null||S.call(this,{loaded:this._loaded,total:this._contentLength}),{value:ct(N),done:!1})}cancel(N){var k;(k=this._reader)==null||k.cancel(N),this._abortController.abort()}}class p{constructor(N,k,S){this._stream=N,this._reader=null,this._loaded=0;const v=N.source;this._withCredentials=v.withCredentials||!1,this._readCapability=new l.PromiseCapability,this._isStreamingSupported=!v.disableStream,this._abortController=new AbortController,this._headers=U(this._stream.httpHeaders),this._headers.append("Range",`bytes=${k}-${S-1}`);const u=v.url;fetch(u,it(this._headers,this._withCredentials,this._abortController)).then(b=>{if(!(0,y.validateResponseStatus)(b.status))throw(0,y.createResponseStatusError)(b.status,u);this._readCapability.resolve(),this._reader=b.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var S;await this._readCapability.promise;const{value:N,done:k}=await this._reader.read();return k?{value:N,done:k}:(this._loaded+=N.byteLength,(S=this.onProgress)==null||S.call(this,{loaded:this._loaded}),{value:ct(N),done:!1})}cancel(N){var k;(k=this._reader)==null||k.cancel(N),this._abortController.abort()}}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.createResponseStatusError=L,c.extractFilenameFromHeader=ct,c.validateRangeRequestCapabilities=U,c.validateResponseStatus=P;var l=K(1),y=K(21),it=K(6);function U({getResponseHeader:p,isHttp:O,rangeChunkSize:N,disableRange:k}){const S={allowRangeRequests:!1,suggestedLength:void 0},v=parseInt(p("Content-Length"),10);return!Number.isInteger(v)||(S.suggestedLength=v,v<=2*N)||k||!O||p("Accept-Ranges")!=="bytes"||(p("Content-Encoding")||"identity")!=="identity"||(S.allowRangeRequests=!0),S}function ct(p){const O=p("Content-Disposition");if(O){let N=(0,y.getFilenameFromContentDispositionHeader)(O);if(N.includes("%"))try{N=decodeURIComponent(N)}catch{}if((0,it.isPdfFile)(N))return N}return null}function L(p,O){return p===404||p===0&&O.startsWith("file:")?new l.MissingPDFException('Missing PDF "'+O+'".'):new l.UnexpectedResponseException(`Unexpected server response (${p}) while retrieving PDF "${O}".`,p)}function P(p){return p===200||p===206}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.getFilenameFromContentDispositionHeader=y;var l=K(1);function y(it){let U=!0,ct=L("filename\\*","i").exec(it);if(ct){ct=ct[1];let v=N(ct);return v=unescape(v),v=k(v),v=S(v),p(v)}if(ct=O(it),ct){const v=S(ct);return p(v)}if(ct=L("filename","i").exec(it),ct){ct=ct[1];let v=N(ct);return v=S(v),p(v)}function L(v,u){return new RegExp("(?:^|;)\\s*"+v+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function P(v,u){if(v){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const b=new TextDecoder(v,{fatal:!0}),C=(0,l.stringToBytes)(u);u=b.decode(C),U=!1}catch{}}return u}function p(v){return U&&/[\x80-\xff]/.test(v)&&(v=P("utf-8",v),U&&(v=P("iso-8859-1",v))),v}function O(v){const u=[];let b;const C=L("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=C.exec(v))!==null;){let[,A,a,h]=b;if(A=parseInt(A,10),A in u){if(A===0)break;continue}u[A]=[a,h]}const T=[];for(let A=0;A<u.length&&A in u;++A){let[a,h]=u[A];h=N(h),a&&(h=unescape(h),A===0&&(h=k(h))),T.push(h)}return T.join("")}function N(v){if(v.startsWith('"')){const u=v.slice(1).split('\\"');for(let b=0;b<u.length;++b){const C=u[b].indexOf('"');C!==-1&&(u[b]=u[b].slice(0,C),u.length=b+1),u[b]=u[b].replaceAll(/\\(.)/g,"$1")}v=u.join('"')}return v}function k(v){const u=v.indexOf("'");if(u===-1)return v;const b=v.slice(0,u),T=v.slice(u+1).replace(/^[^']*'/,"");return P(b,T)}function S(v){return!v.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(v)?v:v.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,b,C,T){if(C==="q"||C==="Q")return T=T.replaceAll("_"," "),T=T.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,a){return String.fromCharCode(parseInt(a,16))}),P(b,T);try{T=atob(T)}catch{}return P(b,T)})}return""}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.PDFNetworkStream=void 0;var l=K(1),y=K(20);const it=200,U=206;function ct(N){const k=N.response;return typeof k!="string"?k:(0,l.stringToBytes)(k).buffer}class L{constructor(k,S={}){this.url=k,this.isHttp=/^https?:/i.test(k),this.httpHeaders=this.isHttp&&S.httpHeaders||Object.create(null),this.withCredentials=S.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(k,S,v){const u={begin:k,end:S};for(const b in v)u[b]=v[b];return this.request(u)}requestFull(k){return this.request(k)}request(k){const S=new XMLHttpRequest,v=this.currXhrId++,u=this.pendingRequests[v]={xhr:S};S.open("GET",this.url),S.withCredentials=this.withCredentials;for(const b in this.httpHeaders){const C=this.httpHeaders[b];C!==void 0&&S.setRequestHeader(b,C)}return this.isHttp&&"begin"in k&&"end"in k?(S.setRequestHeader("Range",`bytes=${k.begin}-${k.end-1}`),u.expectedStatus=U):u.expectedStatus=it,S.responseType="arraybuffer",k.onError&&(S.onerror=function(b){k.onError(S.status)}),S.onreadystatechange=this.onStateChange.bind(this,v),S.onprogress=this.onProgress.bind(this,v),u.onHeadersReceived=k.onHeadersReceived,u.onDone=k.onDone,u.onError=k.onError,u.onProgress=k.onProgress,S.send(null),v}onProgress(k,S){var u;const v=this.pendingRequests[k];v&&((u=v.onProgress)==null||u.call(v,S))}onStateChange(k,S){var A,a,h;const v=this.pendingRequests[k];if(!v)return;const u=v.xhr;if(u.readyState>=2&&v.onHeadersReceived&&(v.onHeadersReceived(),delete v.onHeadersReceived),u.readyState!==4||!(k in this.pendingRequests))return;if(delete this.pendingRequests[k],u.status===0&&this.isHttp){(A=v.onError)==null||A.call(v,u.status);return}const b=u.status||it;if(!(b===it&&v.expectedStatus===U)&&b!==v.expectedStatus){(a=v.onError)==null||a.call(v,u.status);return}const T=ct(u);if(b===U){const F=u.getResponseHeader("Content-Range"),g=/bytes (\d+)-(\d+)\/(\d+)/.exec(F);v.onDone({begin:parseInt(g[1],10),chunk:T})}else T?v.onDone({begin:0,chunk:T}):(h=v.onError)==null||h.call(v,u.status)}getRequestXhr(k){return this.pendingRequests[k].xhr}isPendingRequest(k){return k in this.pendingRequests}abortRequest(k){const S=this.pendingRequests[k].xhr;delete this.pendingRequests[k],S.abort()}}class P{constructor(k){this._source=k,this._manager=new L(k.url,{httpHeaders:k.httpHeaders,withCredentials:k.withCredentials}),this._rangeChunkSize=k.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(k){const S=this._rangeRequestReaders.indexOf(k);S>=0&&this._rangeRequestReaders.splice(S,1)}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new p(this._manager,this._source),this._fullRequestReader}getRangeReader(k,S){const v=new O(this._manager,k,S);return v.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(v),v}cancelAllRequests(k){var S;(S=this._fullRequestReader)==null||S.cancel(k);for(const v of this._rangeRequestReaders.slice(0))v.cancel(k)}}c.PDFNetworkStream=P;class p{constructor(k,S){this._manager=k;const v={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=S.url,this._fullRequestId=k.requestFull(v),this._headersReceivedCapability=new l.PromiseCapability,this._disableRange=S.disableRange||!1,this._contentLength=S.length,this._rangeChunkSize=S.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const k=this._fullRequestId,S=this._manager.getRequestXhr(k),v=C=>S.getResponseHeader(C),{allowRangeRequests:u,suggestedLength:b}=(0,y.validateRangeRequestCapabilities)({getResponseHeader:v,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});u&&(this._isRangeSupported=!0),this._contentLength=b||this._contentLength,this._filename=(0,y.extractFilenameFromHeader)(v),this._isRangeSupported&&this._manager.abortRequest(k),this._headersReceivedCapability.resolve()}_onDone(k){if(k&&(this._requests.length>0?this._requests.shift().resolve({value:k.chunk,done:!1}):this._cachedChunks.push(k.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(k){this._storedError=(0,y.createResponseStatusError)(k,this._url),this._headersReceivedCapability.reject(this._storedError);for(const S of this._requests)S.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(k){var S;(S=this.onProgress)==null||S.call(this,{loaded:k.loaded,total:k.lengthComputable?k.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const k=new l.PromiseCapability;return this._requests.push(k),k.promise}cancel(k){this._done=!0,this._headersReceivedCapability.reject(k);for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class O{constructor(k,S,v){this._manager=k;const u={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=k.url,this._requestId=k.requestRange(S,v,u),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var k;(k=this.onClosed)==null||k.call(this,this)}_onDone(k){const S=k.chunk;this._requests.length>0?this._requests.shift().resolve({value:S,done:!1}):this._queuedChunk=S,this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(k){this._storedError=(0,y.createResponseStatusError)(k,this._url);for(const S of this._requests)S.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(k){var S;this.isStreamingSupported||(S=this.onProgress)==null||S.call(this,{loaded:k.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const S=this._queuedChunk;return this._queuedChunk=null,{value:S,done:!1}}if(this._done)return{value:void 0,done:!0};const k=new l.PromiseCapability;return this._requests.push(k),k.promise}cancel(k){this._done=!0;for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.PDFNodeStream=void 0;var l=K(1),y=K(20);const it=/^file:\/\/\/[a-zA-Z]:\//;function U(v){const u=require$$5,b=u.parse(v);return b.protocol==="file:"||b.host?b:/^[a-z]:[/\\]/i.test(v)?u.parse(`file:///${v}`):(b.host||(b.protocol="file:"),b)}class ct{constructor(u){this.source=u,this.url=U(u.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&u.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var u;return((u=this._fullRequestReader)==null?void 0:u._loaded)??0}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new k(this):new O(this),this._fullRequestReader}getRangeReader(u,b){if(b<=this._progressiveDataLength)return null;const C=this.isFsUrl?new S(this,u,b):new N(this,u,b);return this._rangeRequestReaders.push(C),C}cancelAllRequests(u){var b;(b=this._fullRequestReader)==null||b.cancel(u);for(const C of this._rangeRequestReaders.slice(0))C.cancel(u)}}c.PDFNodeStream=ct;class L{constructor(u){this._url=u.url,this._done=!1,this._storedError=null,this.onProgress=null;const b=u.source;this._contentLength=b.length,this._loaded=0,this._filename=null,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._readableStream=null,this._readCapability=new l.PromiseCapability,this._headersCapability=new l.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var C;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const u=this._readableStream.read();return u===null?(this._readCapability=new l.PromiseCapability,this.read()):(this._loaded+=u.length,(C=this.onProgress)==null||C.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(u).buffer,done:!1})}cancel(u){if(!this._readableStream){this._error(u);return}this._readableStream.destroy(u)}_error(u){this._storedError=u,this._readCapability.resolve()}_setReadableStream(u){this._readableStream=u,u.on("readable",()=>{this._readCapability.resolve()}),u.on("end",()=>{u.destroy(),this._done=!0,this._readCapability.resolve()}),u.on("error",b=>{this._error(b)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new l.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class P{constructor(u){this._url=u.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new l.PromiseCapability;const b=u.source;this._isStreamingSupported=!b.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var C;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const u=this._readableStream.read();return u===null?(this._readCapability=new l.PromiseCapability,this.read()):(this._loaded+=u.length,(C=this.onProgress)==null||C.call(this,{loaded:this._loaded}),{value:new Uint8Array(u).buffer,done:!1})}cancel(u){if(!this._readableStream){this._error(u);return}this._readableStream.destroy(u)}_error(u){this._storedError=u,this._readCapability.resolve()}_setReadableStream(u){this._readableStream=u,u.on("readable",()=>{this._readCapability.resolve()}),u.on("end",()=>{u.destroy(),this._done=!0,this._readCapability.resolve()}),u.on("error",b=>{this._error(b)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function p(v,u){return{protocol:v.protocol,auth:v.auth,host:v.hostname,port:v.port,path:v.path,method:"GET",headers:u}}class O extends L{constructor(u){super(u);const b=C=>{if(C.statusCode===404){const h=new l.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=h,this._headersCapability.reject(h);return}this._headersCapability.resolve(),this._setReadableStream(C);const T=h=>this._readableStream.headers[h.toLowerCase()],{allowRangeRequests:A,suggestedLength:a}=(0,y.validateRangeRequestCapabilities)({getResponseHeader:T,isHttp:u.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=A,this._contentLength=a||this._contentLength,this._filename=(0,y.extractFilenameFromHeader)(T)};if(this._request=null,this._url.protocol==="http:"){const C=require$$5;this._request=C.request(p(this._url,u.httpHeaders),b)}else{const C=require$$5;this._request=C.request(p(this._url,u.httpHeaders),b)}this._request.on("error",C=>{this._storedError=C,this._headersCapability.reject(C)}),this._request.end()}}class N extends P{constructor(u,b,C){super(u),this._httpHeaders={};for(const A in u.httpHeaders){const a=u.httpHeaders[A];a!==void 0&&(this._httpHeaders[A]=a)}this._httpHeaders.Range=`bytes=${b}-${C-1}`;const T=A=>{if(A.statusCode===404){const a=new l.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=a;return}this._setReadableStream(A)};if(this._request=null,this._url.protocol==="http:"){const A=require$$5;this._request=A.request(p(this._url,this._httpHeaders),T)}else{const A=require$$5;this._request=A.request(p(this._url,this._httpHeaders),T)}this._request.on("error",A=>{this._storedError=A}),this._request.end()}}class k extends L{constructor(u){super(u);let b=decodeURIComponent(this._url.path);it.test(this._url.href)&&(b=b.replace(/^\//,""));const C=require$$5;C.lstat(b,(T,A)=>{if(T){T.code==="ENOENT"&&(T=new l.MissingPDFException(`Missing PDF "${b}".`)),this._storedError=T,this._headersCapability.reject(T);return}this._contentLength=A.size,this._setReadableStream(C.createReadStream(b)),this._headersCapability.resolve()})}}class S extends P{constructor(u,b,C){super(u);let T=decodeURIComponent(this._url.path);it.test(this._url.href)&&(T=T.replace(/^\//,""));const A=require$$5;this._setReadableStream(A.createReadStream(T,{start:b,end:C-1}))}}},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.SVGGraphics=void 0;var l=K(6),y=K(1);const it={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},U="http://www.w3.org/XML/1998/namespace",ct="http://www.w3.org/1999/xlink",L=["butt","round","square"],P=["miter","round","bevel"],p=function(A,a="",h=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!h)return URL.createObjectURL(new Blob([A],{type:a}));const F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let g=`data:${a};base64,`;for(let r=0,x=A.length;r<x;r+=3){const m=A[r]&255,j=A[r+1]&255,X=A[r+2]&255,w=m>>2,$=(m&3)<<4|j>>4,nt=r+1<x?(j&15)<<2|X>>6:64,at=r+2<x?X&63:64;g+=F[w]+F[$]+F[nt]+F[at]}return g},O=function(){const A=new Uint8Array([137,80,78,71,13,10,26,10]),a=12,h=new Int32Array(256);for(let X=0;X<256;X++){let w=X;for(let $=0;$<8;$++)w=w&1?3988292384^w>>1&2147483647:w>>1&2147483647;h[X]=w}function F(X,w,$){let nt=-1;for(let at=w;at<$;at++){const W=(nt^X[at])&255,lt=h[W];nt=nt>>>8^lt}return nt^-1}function g(X,w,$,nt){let at=nt;const W=w.length;$[at]=W>>24&255,$[at+1]=W>>16&255,$[at+2]=W>>8&255,$[at+3]=W&255,at+=4,$[at]=X.charCodeAt(0)&255,$[at+1]=X.charCodeAt(1)&255,$[at+2]=X.charCodeAt(2)&255,$[at+3]=X.charCodeAt(3)&255,at+=4,$.set(w,at),at+=w.length;const lt=F($,nt+4,at);$[at]=lt>>24&255,$[at+1]=lt>>16&255,$[at+2]=lt>>8&255,$[at+3]=lt&255}function r(X,w,$){let nt=1,at=0;for(let W=w;W<$;++W)nt=(nt+(X[W]&255))%65521,at=(at+nt)%65521;return at<<16|nt}function x(X){if(!y.isNodeJS)return m(X);try{const w=parseInt(process.versions.node)>=8?X:Buffer.from(X),$=require$$5.deflateSync(w,{level:9});return $ instanceof Uint8Array?$:new Uint8Array($)}catch(w){(0,y.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+w)}return m(X)}function m(X){let w=X.length;const $=65535,nt=Math.ceil(w/$),at=new Uint8Array(2+w+nt*5+4);let W=0;at[W++]=120,at[W++]=156;let lt=0;for(;w>$;)at[W++]=0,at[W++]=255,at[W++]=255,at[W++]=0,at[W++]=0,at.set(X.subarray(lt,lt+$),W),W+=$,lt+=$,w-=$;at[W++]=1,at[W++]=w&255,at[W++]=w>>8&255,at[W++]=~w&65535&255,at[W++]=(~w&65535)>>8&255,at.set(X.subarray(lt),W),W+=X.length-lt;const gt=r(X,0,X.length);return at[W++]=gt>>24&255,at[W++]=gt>>16&255,at[W++]=gt>>8&255,at[W++]=gt&255,at}function j(X,w,$,nt){const at=X.width,W=X.height;let lt,gt,wt;const Pt=X.data;switch(w){case y.ImageKind.GRAYSCALE_1BPP:gt=0,lt=1,wt=at+7>>3;break;case y.ImageKind.RGB_24BPP:gt=2,lt=8,wt=at*3;break;case y.ImageKind.RGBA_32BPP:gt=6,lt=8,wt=at*4;break;default:throw new Error("invalid format")}const E=new Uint8Array((1+wt)*W);let i=0,n=0;for(let B=0;B<W;++B)E[i++]=0,E.set(Pt.subarray(n,n+wt),i),n+=wt,i+=wt;if(w===y.ImageKind.GRAYSCALE_1BPP&&nt){i=0;for(let B=0;B<W;B++){i++;for(let et=0;et<wt;et++)E[i++]^=255}}const s=new Uint8Array([at>>24&255,at>>16&255,at>>8&255,at&255,W>>24&255,W>>16&255,W>>8&255,W&255,lt,gt,0,0,0]),o=x(E),d=A.length+a*3+s.length+o.length,_=new Uint8Array(d);let M=0;return _.set(A,M),M+=A.length,g("IHDR",s,_,M),M+=a+s.length,g("IDATA",o,_,M),M+=a+o.length,g("IEND",new Uint8Array(0),_,M),p(_,"image/png",$)}return function(w,$,nt){const at=w.kind===void 0?y.ImageKind.GRAYSCALE_1BPP:w.kind;return j(w,at,$,nt)}}();class N{constructor(){this.fontSizeScale=1,this.fontWeight=it.fontWeight,this.fontSize=0,this.textMatrix=y.IDENTITY_MATRIX,this.fontMatrix=y.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=y.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=it.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(a,h){this.x=a,this.y=h}}function k(A){let a=[];const h=[];for(const F of A){if(F.fn==="save"){a.push({fnId:92,fn:"group",items:[]}),h.push(a),a=a.at(-1).items;continue}F.fn==="restore"?a=h.pop():a.push(F)}return a}function S(A){if(Number.isInteger(A))return A.toString();const a=A.toFixed(10);let h=a.length-1;if(a[h]!=="0")return a;do h--;while(a[h]==="0");return a.substring(0,a[h]==="."?h:h+1)}function v(A){if(A[4]===0&&A[5]===0){if(A[1]===0&&A[2]===0)return A[0]===1&&A[3]===1?"":`scale(${S(A[0])} ${S(A[3])})`;if(A[0]===A[3]&&A[1]===-A[2]){const a=Math.acos(A[0])*180/Math.PI;return`rotate(${S(a)})`}}else if(A[0]===1&&A[1]===0&&A[2]===0&&A[3]===1)return`translate(${S(A[4])} ${S(A[5])})`;return`matrix(${S(A[0])} ${S(A[1])} ${S(A[2])} ${S(A[3])} ${S(A[4])} ${S(A[5])})`}let u=0,b=0,C=0;class T{constructor(a,h,F=!1){(0,l.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new l.DOMSVGFactory,this.current=new N,this.transformMatrix=y.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=a,this.objs=h,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!F,this._operatorIdMapping=[];for(const g in y.OPS)this._operatorIdMapping[y.OPS[g]]=g}getObject(a,h=null){return typeof a=="string"?a.startsWith("g_")?this.commonObjs.get(a):this.objs.get(a):h}save(){this.transformStack.push(this.transformMatrix);const a=this.current;this.extraStack.push(a),this.current=a.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(a){this.save(),this.executeOpTree(a),this.restore()}loadDependencies(a){const h=a.fnArray,F=a.argsArray;for(let g=0,r=h.length;g<r;g++)if(h[g]===y.OPS.dependency)for(const x of F[g]){const m=x.startsWith("g_")?this.commonObjs:this.objs,j=new Promise(X=>{m.get(x,X)});this.current.dependencies.push(j)}return Promise.all(this.current.dependencies)}transform(a,h,F,g,r,x){const m=[a,h,F,g,r,x];this.transformMatrix=y.Util.transform(this.transformMatrix,m),this.tgrp=null}getSVG(a,h){this.viewport=h;const F=this._initialize(h);return this.loadDependencies(a).then(()=>(this.transformMatrix=y.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(a)),F))}convertOpList(a){const h=this._operatorIdMapping,F=a.argsArray,g=a.fnArray,r=[];for(let x=0,m=g.length;x<m;x++){const j=g[x];r.push({fnId:j,fn:h[j],args:F[x]})}return k(r)}executeOpTree(a){for(const h of a){const F=h.fn,g=h.fnId,r=h.args;switch(g|0){case y.OPS.beginText:this.beginText();break;case y.OPS.dependency:break;case y.OPS.setLeading:this.setLeading(r);break;case y.OPS.setLeadingMoveText:this.setLeadingMoveText(r[0],r[1]);break;case y.OPS.setFont:this.setFont(r);break;case y.OPS.showText:this.showText(r[0]);break;case y.OPS.showSpacedText:this.showText(r[0]);break;case y.OPS.endText:this.endText();break;case y.OPS.moveText:this.moveText(r[0],r[1]);break;case y.OPS.setCharSpacing:this.setCharSpacing(r[0]);break;case y.OPS.setWordSpacing:this.setWordSpacing(r[0]);break;case y.OPS.setHScale:this.setHScale(r[0]);break;case y.OPS.setTextMatrix:this.setTextMatrix(r[0],r[1],r[2],r[3],r[4],r[5]);break;case y.OPS.setTextRise:this.setTextRise(r[0]);break;case y.OPS.setTextRenderingMode:this.setTextRenderingMode(r[0]);break;case y.OPS.setLineWidth:this.setLineWidth(r[0]);break;case y.OPS.setLineJoin:this.setLineJoin(r[0]);break;case y.OPS.setLineCap:this.setLineCap(r[0]);break;case y.OPS.setMiterLimit:this.setMiterLimit(r[0]);break;case y.OPS.setFillRGBColor:this.setFillRGBColor(r[0],r[1],r[2]);break;case y.OPS.setStrokeRGBColor:this.setStrokeRGBColor(r[0],r[1],r[2]);break;case y.OPS.setStrokeColorN:this.setStrokeColorN(r);break;case y.OPS.setFillColorN:this.setFillColorN(r);break;case y.OPS.shadingFill:this.shadingFill(r[0]);break;case y.OPS.setDash:this.setDash(r[0],r[1]);break;case y.OPS.setRenderingIntent:this.setRenderingIntent(r[0]);break;case y.OPS.setFlatness:this.setFlatness(r[0]);break;case y.OPS.setGState:this.setGState(r[0]);break;case y.OPS.fill:this.fill();break;case y.OPS.eoFill:this.eoFill();break;case y.OPS.stroke:this.stroke();break;case y.OPS.fillStroke:this.fillStroke();break;case y.OPS.eoFillStroke:this.eoFillStroke();break;case y.OPS.clip:this.clip("nonzero");break;case y.OPS.eoClip:this.clip("evenodd");break;case y.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case y.OPS.paintImageXObject:this.paintImageXObject(r[0]);break;case y.OPS.paintInlineImageXObject:this.paintInlineImageXObject(r[0]);break;case y.OPS.paintImageMaskXObject:this.paintImageMaskXObject(r[0]);break;case y.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(r[0],r[1]);break;case y.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case y.OPS.closePath:this.closePath();break;case y.OPS.closeStroke:this.closeStroke();break;case y.OPS.closeFillStroke:this.closeFillStroke();break;case y.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case y.OPS.nextLine:this.nextLine();break;case y.OPS.transform:this.transform(r[0],r[1],r[2],r[3],r[4],r[5]);break;case y.OPS.constructPath:this.constructPath(r[0],r[1]);break;case y.OPS.endPath:this.endPath();break;case 92:this.group(h.items);break;default:(0,y.warn)(`Unimplemented operator ${F}`);break}}}setWordSpacing(a){this.current.wordSpacing=a}setCharSpacing(a){this.current.charSpacing=a}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(a,h,F,g,r,x){const m=this.current;m.textMatrix=m.lineMatrix=[a,h,F,g,r,x],m.textMatrixScale=Math.hypot(a,h),m.x=m.lineX=0,m.y=m.lineY=0,m.xcoords=[],m.ycoords=[],m.tspan=this.svgFactory.createElement("svg:tspan"),m.tspan.setAttributeNS(null,"font-family",m.fontFamily),m.tspan.setAttributeNS(null,"font-size",`${S(m.fontSize)}px`),m.tspan.setAttributeNS(null,"y",S(-m.y)),m.txtElement=this.svgFactory.createElement("svg:text"),m.txtElement.append(m.tspan)}beginText(){const a=this.current;a.x=a.lineX=0,a.y=a.lineY=0,a.textMatrix=y.IDENTITY_MATRIX,a.lineMatrix=y.IDENTITY_MATRIX,a.textMatrixScale=1,a.tspan=this.svgFactory.createElement("svg:tspan"),a.txtElement=this.svgFactory.createElement("svg:text"),a.txtgrp=this.svgFactory.createElement("svg:g"),a.xcoords=[],a.ycoords=[]}moveText(a,h){const F=this.current;F.x=F.lineX+=a,F.y=F.lineY+=h,F.xcoords=[],F.ycoords=[],F.tspan=this.svgFactory.createElement("svg:tspan"),F.tspan.setAttributeNS(null,"font-family",F.fontFamily),F.tspan.setAttributeNS(null,"font-size",`${S(F.fontSize)}px`),F.tspan.setAttributeNS(null,"y",S(-F.y))}showText(a){const h=this.current,F=h.font,g=h.fontSize;if(g===0)return;const r=h.fontSizeScale,x=h.charSpacing,m=h.wordSpacing,j=h.fontDirection,X=h.textHScale*j,w=F.vertical,$=w?1:-1,nt=F.defaultVMetrics,at=g*h.fontMatrix[0];let W=0;for(const wt of a){if(wt===null){W+=j*m;continue}else if(typeof wt=="number"){W+=$*wt*g/1e3;continue}const Pt=(wt.isSpace?m:0)+x,E=wt.fontChar;let i,n,s=wt.width;if(w){let d;const _=wt.vmetric||nt;d=wt.vmetric?_[1]:s*.5,d=-d*at;const M=_[2]*at;s=_?-_[0]:s,i=d/r,n=(W+M)/r}else i=W/r,n=0;(wt.isInFont||F.missingFile)&&(h.xcoords.push(h.x+i),w&&h.ycoords.push(-h.y+n),h.tspan.textContent+=E);const o=w?s*at-Pt*j:s*at+Pt*j;W+=o}h.tspan.setAttributeNS(null,"x",h.xcoords.map(S).join(" ")),w?h.tspan.setAttributeNS(null,"y",h.ycoords.map(S).join(" ")):h.tspan.setAttributeNS(null,"y",S(-h.y)),w?h.y-=W:h.x+=W*X,h.tspan.setAttributeNS(null,"font-family",h.fontFamily),h.tspan.setAttributeNS(null,"font-size",`${S(h.fontSize)}px`),h.fontStyle!==it.fontStyle&&h.tspan.setAttributeNS(null,"font-style",h.fontStyle),h.fontWeight!==it.fontWeight&&h.tspan.setAttributeNS(null,"font-weight",h.fontWeight);const lt=h.textRenderingMode&y.TextRenderingMode.FILL_STROKE_MASK;if(lt===y.TextRenderingMode.FILL||lt===y.TextRenderingMode.FILL_STROKE?(h.fillColor!==it.fillColor&&h.tspan.setAttributeNS(null,"fill",h.fillColor),h.fillAlpha<1&&h.tspan.setAttributeNS(null,"fill-opacity",h.fillAlpha)):h.textRenderingMode===y.TextRenderingMode.ADD_TO_PATH?h.tspan.setAttributeNS(null,"fill","transparent"):h.tspan.setAttributeNS(null,"fill","none"),lt===y.TextRenderingMode.STROKE||lt===y.TextRenderingMode.FILL_STROKE){const wt=1/(h.textMatrixScale||1);this._setStrokeAttributes(h.tspan,wt)}let gt=h.textMatrix;h.textRise!==0&&(gt=gt.slice(),gt[5]+=h.textRise),h.txtElement.setAttributeNS(null,"transform",`${v(gt)} scale(${S(X)}, -1)`),h.txtElement.setAttributeNS(U,"xml:space","preserve"),h.txtElement.append(h.tspan),h.txtgrp.append(h.txtElement),this._ensureTransformGroup().append(h.txtElement)}setLeadingMoveText(a,h){this.setLeading(-h),this.moveText(a,h)}addFontStyle(a){if(!a.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const h=p(a.data,a.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${a.loadedName}"; src: url(${h}); }
`}setFont(a){const h=this.current,F=this.commonObjs.get(a[0]);let g=a[1];h.font=F,this.embedFonts&&!F.missingFile&&!this.embeddedFonts[F.loadedName]&&(this.addFontStyle(F),this.embeddedFonts[F.loadedName]=F),h.fontMatrix=F.fontMatrix||y.FONT_IDENTITY_MATRIX;let r="normal";F.black?r="900":F.bold&&(r="bold");const x=F.italic?"italic":"normal";g<0?(g=-g,h.fontDirection=-1):h.fontDirection=1,h.fontSize=g,h.fontFamily=F.loadedName,h.fontWeight=r,h.fontStyle=x,h.tspan=this.svgFactory.createElement("svg:tspan"),h.tspan.setAttributeNS(null,"y",S(-h.y)),h.xcoords=[],h.ycoords=[]}endText(){var h;const a=this.current;a.textRenderingMode&y.TextRenderingMode.ADD_TO_PATH_FLAG&&((h=a.txtElement)!=null&&h.hasChildNodes())&&(a.element=a.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(a){a>0&&(this.current.lineWidth=a)}setLineCap(a){this.current.lineCap=L[a]}setLineJoin(a){this.current.lineJoin=P[a]}setMiterLimit(a){this.current.miterLimit=a}setStrokeAlpha(a){this.current.strokeAlpha=a}setStrokeRGBColor(a,h,F){this.current.strokeColor=y.Util.makeHexColor(a,h,F)}setFillAlpha(a){this.current.fillAlpha=a}setFillRGBColor(a,h,F){this.current.fillColor=y.Util.makeHexColor(a,h,F),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(a){this.current.strokeColor=this._makeColorN_Pattern(a)}setFillColorN(a){this.current.fillColor=this._makeColorN_Pattern(a)}shadingFill(a){const{width:h,height:F}=this.viewport,g=y.Util.inverseTransform(this.transformMatrix),[r,x,m,j]=y.Util.getAxialAlignedBoundingBox([0,0,h,F],g),X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x",r),X.setAttributeNS(null,"y",x),X.setAttributeNS(null,"width",m-r),X.setAttributeNS(null,"height",j-x),X.setAttributeNS(null,"fill",this._makeShadingPattern(a)),this.current.fillAlpha<1&&X.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(X)}_makeColorN_Pattern(a){return a[0]==="TilingPattern"?this._makeTilingPattern(a):this._makeShadingPattern(a)}_makeTilingPattern(a){const h=a[1],F=a[2],g=a[3]||y.IDENTITY_MATRIX,[r,x,m,j]=a[4],X=a[5],w=a[6],$=a[7],nt=`shading${C++}`,[at,W,lt,gt]=y.Util.normalizeRect([...y.Util.applyTransform([r,x],g),...y.Util.applyTransform([m,j],g)]),[wt,Pt]=y.Util.singularValueDecompose2dScale(g),E=X*wt,i=w*Pt,n=this.svgFactory.createElement("svg:pattern");n.setAttributeNS(null,"id",nt),n.setAttributeNS(null,"patternUnits","userSpaceOnUse"),n.setAttributeNS(null,"width",E),n.setAttributeNS(null,"height",i),n.setAttributeNS(null,"x",`${at}`),n.setAttributeNS(null,"y",`${W}`);const s=this.svg,o=this.transformMatrix,d=this.current.fillColor,_=this.current.strokeColor,M=this.svgFactory.create(lt-at,gt-W);if(this.svg=M,this.transformMatrix=g,$===2){const B=y.Util.makeHexColor(...h);this.current.fillColor=B,this.current.strokeColor=B}return this.executeOpTree(this.convertOpList(F)),this.svg=s,this.transformMatrix=o,this.current.fillColor=d,this.current.strokeColor=_,n.append(M.childNodes[0]),this.defs.append(n),`url(#${nt})`}_makeShadingPattern(a){switch(typeof a=="string"&&(a=this.objs.get(a)),a[0]){case"RadialAxial":const h=`shading${C++}`,F=a[3];let g;switch(a[1]){case"axial":const r=a[4],x=a[5];g=this.svgFactory.createElement("svg:linearGradient"),g.setAttributeNS(null,"id",h),g.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),g.setAttributeNS(null,"x1",r[0]),g.setAttributeNS(null,"y1",r[1]),g.setAttributeNS(null,"x2",x[0]),g.setAttributeNS(null,"y2",x[1]);break;case"radial":const m=a[4],j=a[5],X=a[6],w=a[7];g=this.svgFactory.createElement("svg:radialGradient"),g.setAttributeNS(null,"id",h),g.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),g.setAttributeNS(null,"cx",j[0]),g.setAttributeNS(null,"cy",j[1]),g.setAttributeNS(null,"r",w),g.setAttributeNS(null,"fx",m[0]),g.setAttributeNS(null,"fy",m[1]),g.setAttributeNS(null,"fr",X);break;default:throw new Error(`Unknown RadialAxial type: ${a[1]}`)}for(const r of F){const x=this.svgFactory.createElement("svg:stop");x.setAttributeNS(null,"offset",r[0]),x.setAttributeNS(null,"stop-color",r[1]),g.append(x)}return this.defs.append(g),`url(#${h})`;case"Mesh":return(0,y.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${a[0]}`)}}setDash(a,h){this.current.dashArray=a,this.current.dashPhase=h}constructPath(a,h){const F=this.current;let g=F.x,r=F.y,x=[],m=0;for(const j of a)switch(j|0){case y.OPS.rectangle:g=h[m++],r=h[m++];const X=h[m++],w=h[m++],$=g+X,nt=r+w;x.push("M",S(g),S(r),"L",S($),S(r),"L",S($),S(nt),"L",S(g),S(nt),"Z");break;case y.OPS.moveTo:g=h[m++],r=h[m++],x.push("M",S(g),S(r));break;case y.OPS.lineTo:g=h[m++],r=h[m++],x.push("L",S(g),S(r));break;case y.OPS.curveTo:g=h[m+4],r=h[m+5],x.push("C",S(h[m]),S(h[m+1]),S(h[m+2]),S(h[m+3]),S(g),S(r)),m+=6;break;case y.OPS.curveTo2:x.push("C",S(g),S(r),S(h[m]),S(h[m+1]),S(h[m+2]),S(h[m+3])),g=h[m+2],r=h[m+3],m+=4;break;case y.OPS.curveTo3:g=h[m+2],r=h[m+3],x.push("C",S(h[m]),S(h[m+1]),S(g),S(r),S(g),S(r)),m+=4;break;case y.OPS.closePath:x.push("Z");break}x=x.join(" "),F.path&&a.length>0&&a[0]!==y.OPS.rectangle&&a[0]!==y.OPS.moveTo?x=F.path.getAttributeNS(null,"d")+x:(F.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(F.path)),F.path.setAttributeNS(null,"d",x),F.path.setAttributeNS(null,"fill","none"),F.element=F.path,F.setCurrentPoint(g,r)}endPath(){const a=this.current;if(a.path=null,!this.pendingClip)return;if(!a.element){this.pendingClip=null;return}const h=`clippath${u++}`,F=this.svgFactory.createElement("svg:clipPath");F.setAttributeNS(null,"id",h),F.setAttributeNS(null,"transform",v(this.transformMatrix));const g=a.element.cloneNode(!0);if(this.pendingClip==="evenodd"?g.setAttributeNS(null,"clip-rule","evenodd"):g.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,F.append(g),this.defs.append(F),a.activeClipUrl){a.clipGroup=null;for(const r of this.extraStack)r.clipGroup=null;F.setAttributeNS(null,"clip-path",a.activeClipUrl)}a.activeClipUrl=`url(#${h})`,this.tgrp=null}clip(a){this.pendingClip=a}closePath(){const a=this.current;if(a.path){const h=`${a.path.getAttributeNS(null,"d")}Z`;a.path.setAttributeNS(null,"d",h)}}setLeading(a){this.current.leading=-a}setTextRise(a){this.current.textRise=a}setTextRenderingMode(a){this.current.textRenderingMode=a}setHScale(a){this.current.textHScale=a/100}setRenderingIntent(a){}setFlatness(a){}setGState(a){for(const[h,F]of a)switch(h){case"LW":this.setLineWidth(F);break;case"LC":this.setLineCap(F);break;case"LJ":this.setLineJoin(F);break;case"ML":this.setMiterLimit(F);break;case"D":this.setDash(F[0],F[1]);break;case"RI":this.setRenderingIntent(F);break;case"FL":this.setFlatness(F);break;case"Font":this.setFont(F);break;case"CA":this.setStrokeAlpha(F);break;case"ca":this.setFillAlpha(F);break;default:(0,y.warn)(`Unimplemented graphic state operator ${h}`);break}}fill(){const a=this.current;a.element&&(a.element.setAttributeNS(null,"fill",a.fillColor),a.element.setAttributeNS(null,"fill-opacity",a.fillAlpha),this.endPath())}stroke(){const a=this.current;a.element&&(this._setStrokeAttributes(a.element),a.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(a,h=1){const F=this.current;let g=F.dashArray;h!==1&&g.length>0&&(g=g.map(function(r){return h*r})),a.setAttributeNS(null,"stroke",F.strokeColor),a.setAttributeNS(null,"stroke-opacity",F.strokeAlpha),a.setAttributeNS(null,"stroke-miterlimit",S(F.miterLimit)),a.setAttributeNS(null,"stroke-linecap",F.lineCap),a.setAttributeNS(null,"stroke-linejoin",F.lineJoin),a.setAttributeNS(null,"stroke-width",S(h*F.lineWidth)+"px"),a.setAttributeNS(null,"stroke-dasharray",g.map(S).join(" ")),a.setAttributeNS(null,"stroke-dashoffset",S(h*F.dashPhase)+"px")}eoFill(){var a;(a=this.current.element)==null||a.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var a;(a=this.current.element)==null||a.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width","1px"),a.setAttributeNS(null,"height","1px"),a.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(a)}paintImageXObject(a){const h=this.getObject(a);if(!h){(0,y.warn)(`Dependent image with object ID ${a} is not ready yet`);return}this.paintInlineImageXObject(h)}paintInlineImageXObject(a,h){const F=a.width,g=a.height,r=O(a,this.forceDataSchema,!!h),x=this.svgFactory.createElement("svg:rect");x.setAttributeNS(null,"x","0"),x.setAttributeNS(null,"y","0"),x.setAttributeNS(null,"width",S(F)),x.setAttributeNS(null,"height",S(g)),this.current.element=x,this.clip("nonzero");const m=this.svgFactory.createElement("svg:image");m.setAttributeNS(ct,"xlink:href",r),m.setAttributeNS(null,"x","0"),m.setAttributeNS(null,"y",S(-g)),m.setAttributeNS(null,"width",S(F)+"px"),m.setAttributeNS(null,"height",S(g)+"px"),m.setAttributeNS(null,"transform",`scale(${S(1/F)} ${S(-1/g)})`),h?h.append(m):this._ensureTransformGroup().append(m)}paintImageMaskXObject(a){const h=this.getObject(a.data,a);if(h.bitmap){(0,y.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const F=this.current,g=h.width,r=h.height,x=F.fillColor;F.maskId=`mask${b++}`;const m=this.svgFactory.createElement("svg:mask");m.setAttributeNS(null,"id",F.maskId);const j=this.svgFactory.createElement("svg:rect");j.setAttributeNS(null,"x","0"),j.setAttributeNS(null,"y","0"),j.setAttributeNS(null,"width",S(g)),j.setAttributeNS(null,"height",S(r)),j.setAttributeNS(null,"fill",x),j.setAttributeNS(null,"mask",`url(#${F.maskId})`),this.defs.append(m),this._ensureTransformGroup().append(j),this.paintInlineImageXObject(h,m)}paintFormXObjectBegin(a,h){if(Array.isArray(a)&&a.length===6&&this.transform(a[0],a[1],a[2],a[3],a[4],a[5]),h){const F=h[2]-h[0],g=h[3]-h[1],r=this.svgFactory.createElement("svg:rect");r.setAttributeNS(null,"x",h[0]),r.setAttributeNS(null,"y",h[1]),r.setAttributeNS(null,"width",S(F)),r.setAttributeNS(null,"height",S(g)),this.current.element=r,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(a){const h=this.svgFactory.create(a.width,a.height),F=this.svgFactory.createElement("svg:defs");h.append(F),this.defs=F;const g=this.svgFactory.createElement("svg:g");return g.setAttributeNS(null,"transform",v(a.transform)),h.append(g),this.svg=g,h}_ensureClipGroup(){if(!this.current.clipGroup){const a=this.svgFactory.createElement("svg:g");a.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(a),this.current.clipGroup=a}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",v(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}c.SVGGraphics=T},(ft,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.XfaText=void 0;class K{static textContent(y){const it=[],U={items:it,styles:Object.create(null)};function ct(L){var O;if(!L)return;let P=null;const p=L.name;if(p==="#text")P=L.value;else if(K.shouldBuildText(p))(O=L==null?void 0:L.attributes)!=null&&O.textContent?P=L.attributes.textContent:L.value&&(P=L.value);else return;if(P!==null&&it.push({str:P}),!!L.children)for(const N of L.children)ct(N)}return ct(y),U}static shouldBuildText(y){return!(y==="textarea"||y==="input"||y==="option"||y==="select")}}c.XfaText=K},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.TextLayerRenderTask=void 0,c.renderTextLayer=v,c.updateTextLayer=u;var l=K(1),y=K(6);const it=1e5,U=30,ct=.8,L=new Map;function P(b,C){let T;if(C&&l.FeatureTest.isOffscreenCanvasSupported)T=new OffscreenCanvas(b,b).getContext("2d",{alpha:!1});else{const A=document.createElement("canvas");A.width=A.height=b,T=A.getContext("2d",{alpha:!1})}return T}function p(b,C){const T=L.get(b);if(T)return T;const A=P(U,C);A.font=`${U}px ${b}`;const a=A.measureText("");let h=a.fontBoundingBoxAscent,F=Math.abs(a.fontBoundingBoxDescent);if(h){const r=h/(h+F);return L.set(b,r),A.canvas.width=A.canvas.height=0,r}A.strokeStyle="red",A.clearRect(0,0,U,U),A.strokeText("g",0,0);let g=A.getImageData(0,0,U,U).data;F=0;for(let r=g.length-1-3;r>=0;r-=4)if(g[r]>0){F=Math.ceil(r/4/U);break}A.clearRect(0,0,U,U),A.strokeText("A",0,U),g=A.getImageData(0,0,U,U).data,h=0;for(let r=0,x=g.length;r<x;r+=4)if(g[r]>0){h=U-Math.floor(r/4/U);break}if(A.canvas.width=A.canvas.height=0,h){const r=h/(h+F);return L.set(b,r),r}return L.set(b,ct),ct}function O(b,C,T){const A=document.createElement("span"),a={angle:0,canvasWidth:0,hasText:C.str!=="",hasEOL:C.hasEOL,fontSize:0};b._textDivs.push(A);const h=l.Util.transform(b._transform,C.transform);let F=Math.atan2(h[1],h[0]);const g=T[C.fontName];g.vertical&&(F+=Math.PI/2);const r=Math.hypot(h[2],h[3]),x=r*p(g.fontFamily,b._isOffscreenCanvasSupported);let m,j;F===0?(m=h[4],j=h[5]-x):(m=h[4]+x*Math.sin(F),j=h[5]-x*Math.cos(F));const X="calc(var(--scale-factor)*",w=A.style;b._container===b._rootContainer?(w.left=`${(100*m/b._pageWidth).toFixed(2)}%`,w.top=`${(100*j/b._pageHeight).toFixed(2)}%`):(w.left=`${X}${m.toFixed(2)}px)`,w.top=`${X}${j.toFixed(2)}px)`),w.fontSize=`${X}${r.toFixed(2)}px)`,w.fontFamily=g.fontFamily,a.fontSize=r,A.setAttribute("role","presentation"),A.textContent=C.str,A.dir=C.dir,b._fontInspectorEnabled&&(A.dataset.fontName=C.fontName),F!==0&&(a.angle=F*(180/Math.PI));let $=!1;if(C.str.length>1)$=!0;else if(C.str!==" "&&C.transform[0]!==C.transform[3]){const nt=Math.abs(C.transform[0]),at=Math.abs(C.transform[3]);nt!==at&&Math.max(nt,at)/Math.min(nt,at)>1.5&&($=!0)}$&&(a.canvasWidth=g.vertical?C.height:C.width),b._textDivProperties.set(A,a),b._isReadableStream&&b._layoutText(A)}function N(b){const{div:C,scale:T,properties:A,ctx:a,prevFontSize:h,prevFontFamily:F}=b,{style:g}=C;let r="";if(A.canvasWidth!==0&&A.hasText){const{fontFamily:x}=g,{canvasWidth:m,fontSize:j}=A;(h!==j||F!==x)&&(a.font=`${j*T}px ${x}`,b.prevFontSize=j,b.prevFontFamily=x);const{width:X}=a.measureText(C.textContent);X>0&&(r=`scaleX(${m*T/X})`)}A.angle!==0&&(r=`rotate(${A.angle}deg) ${r}`),r.length>0&&(g.transform=r)}function k(b){if(b._canceled)return;const C=b._textDivs,T=b._capability;if(C.length>it){T.resolve();return}if(!b._isReadableStream)for(const a of C)b._layoutText(a);T.resolve()}class S{constructor({textContentSource:C,container:T,viewport:A,textDivs:a,textDivProperties:h,textContentItemsStr:F,isOffscreenCanvasSupported:g}){var X;this._textContentSource=C,this._isReadableStream=C instanceof ReadableStream,this._container=this._rootContainer=T,this._textDivs=a||[],this._textContentItemsStr=F||[],this._isOffscreenCanvasSupported=g,this._fontInspectorEnabled=!!((X=globalThis.FontInspector)!=null&&X.enabled),this._reader=null,this._textDivProperties=h||new WeakMap,this._canceled=!1,this._capability=new l.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:P(0,g)};const{pageWidth:r,pageHeight:x,pageX:m,pageY:j}=A.rawDims;this._transform=[1,0,0,-1,-m,j+x],this._pageWidth=r,this._pageHeight=x,(0,y.setLayerDimensions)(T,A),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new l.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new l.AbortException("TextLayer task cancelled."))}_processItems(C,T){for(const A of C){if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const a=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),A.id!==null&&this._container.setAttribute("id",`${A.id}`),a.append(this._container)}else A.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(A.str),O(this,A,T)}}_layoutText(C){const T=this._layoutTextParams.properties=this._textDivProperties.get(C);if(this._layoutTextParams.div=C,N(this._layoutTextParams),T.hasText&&this._container.append(C),T.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(){const C=new l.PromiseCapability;let T=Object.create(null);if(this._isReadableStream){const A=()=>{this._reader.read().then(({value:a,done:h})=>{if(h){C.resolve();return}Object.assign(T,a.styles),this._processItems(a.items,T),A()},C.reject)};this._reader=this._textContentSource.getReader(),A()}else if(this._textContentSource){const{items:A,styles:a}=this._textContentSource;this._processItems(A,a),C.resolve()}else throw new Error('No "textContentSource" parameter specified.');C.promise.then(()=>{T=null,k(this)},this._capability.reject)}}c.TextLayerRenderTask=S;function v(b){!b.textContentSource&&(b.textContent||b.textContentStream)&&((0,y.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),b.textContentSource=b.textContent||b.textContentStream);const{container:C,viewport:T}=b,A=getComputedStyle(C),a=A.getPropertyValue("visibility"),h=parseFloat(A.getPropertyValue("--scale-factor"));a==="visible"&&(!h||Math.abs(h-T.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const F=new S(b);return F._render(),F}function u({container:b,viewport:C,textDivs:T,textDivProperties:A,isOffscreenCanvasSupported:a,mustRotate:h=!0,mustRescale:F=!0}){if(h&&(0,y.setLayerDimensions)(b,{rotation:C.rotation}),F){const g=P(0,a),x={prevFontSize:null,prevFontFamily:null,div:null,scale:C.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:g};for(const m of T)x.properties=A.get(m),x.div=m,N(x)}}},(ft,c,K)=>{var p,O,N,k,S,v,u,b,C,T,A,ei,h,ke,g,ii,x,si;Object.defineProperty(c,"__esModule",{value:!0}),c.AnnotationEditorLayer=void 0;var l=K(1),y=K(4),it=K(28),U=K(33),ct=K(6),L=K(34);const j=class j{constructor({uiManager:w,pageIndex:$,div:nt,accessibilityManager:at,annotationLayer:W,viewport:lt,l10n:gt}){I(this,A);I(this,h);I(this,g);I(this,x);I(this,p,void 0);I(this,O,!1);I(this,N,null);I(this,k,this.pointerup.bind(this));I(this,S,this.pointerdown.bind(this));I(this,v,new Map);I(this,u,!1);I(this,b,!1);I(this,C,!1);I(this,T,void 0);const wt=[it.FreeTextEditor,U.InkEditor,L.StampEditor];if(!j._initialized){j._initialized=!0;for(const Pt of wt)Pt.initialize(gt)}w.registerEditorTypes(wt),tt(this,T,w),this.pageIndex=$,this.div=nt,tt(this,p,at),tt(this,N,W),this.viewport=lt,t(this,T).addLayer(this)}get isEmpty(){return t(this,v).size===0}updateToolbar(w){t(this,T).updateToolbar(w)}updateMode(w=t(this,T).getMode()){G(this,x,si).call(this),w===l.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),w!==l.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",w===l.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",w===l.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",w===l.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(w){if(!w&&t(this,T).getMode()!==l.AnnotationEditorType.INK)return;if(!w){for(const nt of t(this,v).values())if(nt.isEmpty()){nt.setInBackground();return}}G(this,h,ke).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(w){t(this,T).setEditingState(w)}addCommands(w){t(this,T).addCommands(w)}enable(){this.div.style.pointerEvents="auto";const w=new Set;for(const nt of t(this,v).values())nt.enableEditing(),nt.annotationElementId&&w.add(nt.annotationElementId);if(!t(this,N))return;const $=t(this,N).getEditableAnnotations();for(const nt of $){if(nt.hide(),t(this,T).isDeletedAnnotationElement(nt.data.id)||w.has(nt.data.id))continue;const at=this.deserialize(nt);at&&(this.addOrRebuild(at),at.enableEditing())}}disable(){var $;tt(this,C,!0),this.div.style.pointerEvents="none";const w=new Set;for(const nt of t(this,v).values()){if(nt.disableEditing(),!nt.annotationElementId||nt.serialize()!==null){w.add(nt.annotationElementId);continue}($=this.getEditableAnnotation(nt.annotationElementId))==null||$.show(),nt.remove()}if(t(this,N)){const nt=t(this,N).getEditableAnnotations();for(const at of nt){const{id:W}=at.data;w.has(W)||t(this,T).isDeletedAnnotationElement(W)||at.show()}}G(this,x,si).call(this),this.isEmpty&&(this.div.hidden=!0),tt(this,C,!1)}getEditableAnnotation(w){var $;return(($=t(this,N))==null?void 0:$.getEditableAnnotation(w))||null}setActiveEditor(w){t(this,T).getActive()!==w&&t(this,T).setActiveEditor(w)}enableClick(){this.div.addEventListener("pointerdown",t(this,S)),this.div.addEventListener("pointerup",t(this,k))}disableClick(){this.div.removeEventListener("pointerdown",t(this,S)),this.div.removeEventListener("pointerup",t(this,k))}attach(w){t(this,v).set(w.id,w);const{annotationElementId:$}=w;$&&t(this,T).isDeletedAnnotationElement($)&&t(this,T).removeDeletedAnnotationElement(w)}detach(w){var $;t(this,v).delete(w.id),($=t(this,p))==null||$.removePointerInTextLayer(w.contentDiv),!t(this,C)&&w.annotationElementId&&t(this,T).addDeletedAnnotationElement(w)}remove(w){this.detach(w),t(this,T).removeEditor(w),w.div.contains(document.activeElement)&&setTimeout(()=>{t(this,T).focusMainContainer()},0),w.div.remove(),w.isAttachedToDOM=!1,t(this,b)||this.addInkEditorIfNeeded(!1)}changeParent(w){var $;w.parent!==this&&(w.annotationElementId&&(t(this,T).addDeletedAnnotationElement(w.annotationElementId),y.AnnotationEditor.deleteAnnotationElement(w),w.annotationElementId=null),this.attach(w),($=w.parent)==null||$.detach(w),w.setParent(this),w.div&&w.isAttachedToDOM&&(w.div.remove(),this.div.append(w.div)))}add(w){if(this.changeParent(w),t(this,T).addEditor(w),this.attach(w),!w.isAttachedToDOM){const $=w.render();this.div.append($),w.isAttachedToDOM=!0}w.fixAndSetPosition(),w.onceAdded(),t(this,T).addToAnnotationStorage(w)}moveEditorInDOM(w){var nt;if(!w.isAttachedToDOM)return;const{activeElement:$}=document;w.div.contains($)&&(w._focusEventsAllowed=!1,setTimeout(()=>{w.div.contains(document.activeElement)?w._focusEventsAllowed=!0:(w.div.addEventListener("focusin",()=>{w._focusEventsAllowed=!0},{once:!0}),$.focus())},0)),w._structTreeParentId=(nt=t(this,p))==null?void 0:nt.moveElementInDOM(this.div,w.div,w.contentDiv,!0)}addOrRebuild(w){w.needsToBeRebuilt()?w.rebuild():this.add(w)}addUndoableEditor(w){const $=()=>w._uiManager.rebuild(w),nt=()=>{w.remove()};this.addCommands({cmd:$,undo:nt,mustExec:!1})}getNextId(){return t(this,T).getId()}pasteEditor(w,$){t(this,T).updateToolbar(w),t(this,T).updateMode(w);const{offsetX:nt,offsetY:at}=G(this,g,ii).call(this),W=this.getNextId(),lt=G(this,A,ei).call(this,{parent:this,id:W,x:nt,y:at,uiManager:t(this,T),isCentered:!0,...$});lt&&this.add(lt)}deserialize(w){switch(w.annotationType??w.annotationEditorType){case l.AnnotationEditorType.FREETEXT:return it.FreeTextEditor.deserialize(w,this,t(this,T));case l.AnnotationEditorType.INK:return U.InkEditor.deserialize(w,this,t(this,T));case l.AnnotationEditorType.STAMP:return L.StampEditor.deserialize(w,this,t(this,T))}return null}addNewEditor(){G(this,h,ke).call(this,G(this,g,ii).call(this),!0)}setSelected(w){t(this,T).setSelected(w)}toggleSelected(w){t(this,T).toggleSelected(w)}isSelected(w){return t(this,T).isSelected(w)}unselect(w){t(this,T).unselect(w)}pointerup(w){const{isMac:$}=l.FeatureTest.platform;if(!(w.button!==0||w.ctrlKey&&$)&&w.target===this.div&&t(this,u)){if(tt(this,u,!1),!t(this,O)){tt(this,O,!0);return}if(t(this,T).getMode()===l.AnnotationEditorType.STAMP){t(this,T).unselectAll();return}G(this,h,ke).call(this,w,!1)}}pointerdown(w){if(t(this,u)){tt(this,u,!1);return}const{isMac:$}=l.FeatureTest.platform;if(w.button!==0||w.ctrlKey&&$||w.target!==this.div)return;tt(this,u,!0);const nt=t(this,T).getActive();tt(this,O,!nt||nt.isEmpty())}findNewParent(w,$,nt){const at=t(this,T).findParent($,nt);return at===null||at===this?!1:(at.changeParent(w),!0)}destroy(){var w,$;((w=t(this,T).getActive())==null?void 0:w.parent)===this&&(t(this,T).commitOrRemove(),t(this,T).setActiveEditor(null));for(const nt of t(this,v).values())($=t(this,p))==null||$.removePointerInTextLayer(nt.contentDiv),nt.setParent(null),nt.isAttachedToDOM=!1,nt.div.remove();this.div=null,t(this,v).clear(),t(this,T).removeLayer(this)}render({viewport:w}){this.viewport=w,(0,ct.setLayerDimensions)(this.div,w);for(const $ of t(this,T).getEditors(this.pageIndex))this.add($);this.updateMode()}update({viewport:w}){t(this,T).commitOrRemove(),this.viewport=w,(0,ct.setLayerDimensions)(this.div,{rotation:w.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:w,pageHeight:$}=this.viewport.rawDims;return[w,$]}};p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakMap,C=new WeakMap,T=new WeakMap,A=new WeakSet,ei=function(w){switch(t(this,T).getMode()){case l.AnnotationEditorType.FREETEXT:return new it.FreeTextEditor(w);case l.AnnotationEditorType.INK:return new U.InkEditor(w);case l.AnnotationEditorType.STAMP:return new L.StampEditor(w)}return null},h=new WeakSet,ke=function(w,$){const nt=this.getNextId(),at=G(this,A,ei).call(this,{parent:this,id:nt,x:w.offsetX,y:w.offsetY,uiManager:t(this,T),isCentered:$});return at&&this.add(at),at},g=new WeakSet,ii=function(){const{x:w,y:$,width:nt,height:at}=this.div.getBoundingClientRect(),W=Math.max(0,w),lt=Math.max(0,$),gt=Math.min(window.innerWidth,w+nt),wt=Math.min(window.innerHeight,$+at),Pt=(W+gt)/2-w,E=(lt+wt)/2-$,[i,n]=this.viewport.rotation%180===0?[Pt,E]:[E,Pt];return{offsetX:i,offsetY:n}},x=new WeakSet,si=function(){tt(this,b,!0);for(const w of t(this,v).values())w.isEmpty()&&w.remove();tt(this,b,!1)},ee(j,"_initialized",!1);let P=j;c.AnnotationEditorLayer=P},(ft,c,K)=>{var L,P,p,O,N,k,S,v,u,b,Fi,T,Mi,a,Ri,F,ye,r,ni,m,Di,X,ri;Object.defineProperty(c,"__esModule",{value:!0}),c.FreeTextEditor=void 0;var l=K(1),y=K(5),it=K(4),U=K(29);const $=class $ extends it.AnnotationEditor{constructor(W){super({...W,name:"freeTextEditor"});I(this,b);I(this,T);I(this,a);I(this,F);I(this,r);I(this,m);I(this,X);I(this,L,this.editorDivBlur.bind(this));I(this,P,this.editorDivFocus.bind(this));I(this,p,this.editorDivInput.bind(this));I(this,O,this.editorDivKeydown.bind(this));I(this,N,void 0);I(this,k,"");I(this,S,`${this.id}-editor`);I(this,v,void 0);I(this,u,null);tt(this,N,W.color||$._defaultColor||it.AnnotationEditor._defaultLineColor),tt(this,v,W.fontSize||$._defaultFontSize)}static get _keyboardManager(){const W=$.prototype,lt=Pt=>Pt.isEmpty(),gt=y.AnnotationEditorUIManager.TRANSLATE_SMALL,wt=y.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new y.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],W.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],W.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],W._translateEmpty,{args:[-gt,0],checker:lt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],W._translateEmpty,{args:[-wt,0],checker:lt}],[["ArrowRight","mac+ArrowRight"],W._translateEmpty,{args:[gt,0],checker:lt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],W._translateEmpty,{args:[wt,0],checker:lt}],[["ArrowUp","mac+ArrowUp"],W._translateEmpty,{args:[0,-gt],checker:lt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],W._translateEmpty,{args:[0,-wt],checker:lt}],[["ArrowDown","mac+ArrowDown"],W._translateEmpty,{args:[0,gt],checker:lt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],W._translateEmpty,{args:[0,wt],checker:lt}]]))}static initialize(W){it.AnnotationEditor.initialize(W,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const lt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(lt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(W,lt){switch(W){case l.AnnotationEditorParamsType.FREETEXT_SIZE:$._defaultFontSize=lt;break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:$._defaultColor=lt;break}}updateParams(W,lt){switch(W){case l.AnnotationEditorParamsType.FREETEXT_SIZE:G(this,b,Fi).call(this,lt);break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:G(this,T,Mi).call(this,lt);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,$._defaultFontSize],[l.AnnotationEditorParamsType.FREETEXT_COLOR,$._defaultColor||it.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,t(this,v)],[l.AnnotationEditorParamsType.FREETEXT_COLOR,t(this,N)]]}_translateEmpty(W,lt){this._uiManager.translateSelectedEditors(W,lt,!0)}getInitialTranslation(){const W=this.parentScale;return[-$._internalPadding*W,-($._internalPadding+t(this,v))*W]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(l.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",t(this,O)),this.editorDiv.addEventListener("focus",t(this,P)),this.editorDiv.addEventListener("blur",t(this,L)),this.editorDiv.addEventListener("input",t(this,p)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",t(this,S)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",t(this,O)),this.editorDiv.removeEventListener("focus",t(this,P)),this.editorDiv.removeEventListener("blur",t(this,L)),this.editorDiv.removeEventListener("input",t(this,p)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(W){this._focusEventsAllowed&&(super.focusin(W),W.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var W;if(this.width){G(this,X,ri).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(W=this._initialOptions)!=null&&W.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const W=t(this,k),lt=tt(this,k,G(this,a,Ri).call(this).trimEnd());if(W===lt)return;const gt=wt=>{if(tt(this,k,wt),!wt){this.remove();return}G(this,r,ni).call(this),this._uiManager.rebuild(this),G(this,F,ye).call(this)};this.addCommands({cmd:()=>{gt(lt)},undo:()=>{gt(W)},mustExec:!1}),G(this,F,ye).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(W){this.enterInEditMode()}keydown(W){W.target===this.div&&W.key==="Enter"&&(this.enterInEditMode(),W.preventDefault())}editorDivKeydown(W){$._keyboardManager.exec(this,W)}editorDivFocus(W){this.isEditing=!0}editorDivBlur(W){this.isEditing=!1}editorDivInput(W){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let W,lt;this.width&&(W=this.x,lt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",t(this,S)),this.enableEditing(),it.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(wt=>{var Pt;return(Pt=this.editorDiv)==null?void 0:Pt.setAttribute("aria-label",wt)}),it.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(wt=>{var Pt;return(Pt=this.editorDiv)==null?void 0:Pt.setAttribute("default-content",wt)}),this.editorDiv.contentEditable=!0;const{style:gt}=this.editorDiv;if(gt.fontSize=`calc(${t(this,v)}px * var(--scale-factor))`,gt.color=t(this,N),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,y.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[wt,Pt]=this.parentDimensions;if(this.annotationElementId){const{position:E}=t(this,u);let[i,n]=this.getInitialTranslation();[i,n]=this.pageTranslationToScreen(i,n);const[s,o]=this.pageDimensions,[d,_]=this.pageTranslation;let M,B;switch(this.rotation){case 0:M=W+(E[0]-d)/s,B=lt+this.height-(E[1]-_)/o;break;case 90:M=W+(E[0]-d)/s,B=lt-(E[1]-_)/o,[i,n]=[n,-i];break;case 180:M=W-this.width+(E[0]-d)/s,B=lt-(E[1]-_)/o,[i,n]=[-i,-n];break;case 270:M=W+(E[0]-d-this.height*o)/s,B=lt+(E[1]-_-this.width*s)/o,[i,n]=[-n,i];break}this.setAt(M*wt,B*Pt,i,n)}else this.setAt(W*wt,lt*Pt,this.width*wt,this.height*Pt);G(this,r,ni).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(W,lt,gt){let wt=null;if(W instanceof U.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:E,fontColor:i},rect:n,rotation:s,id:o},textContent:d,textPosition:_,parent:{page:{pageNumber:M}}}=W;if(!d||d.length===0)return null;wt=W={annotationType:l.AnnotationEditorType.FREETEXT,color:Array.from(i),fontSize:E,value:d.join(`
`),position:_,pageIndex:M-1,rect:n,rotation:s,id:o,deleted:!1}}const Pt=super.deserialize(W,lt,gt);return tt(Pt,v,W.fontSize),tt(Pt,N,l.Util.makeHexColor(...W.color)),tt(Pt,k,W.value),Pt.annotationElementId=W.id||null,tt(Pt,u,wt),Pt}serialize(W=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const lt=$._internalPadding*this.parentScale,gt=this.getRect(lt,lt),wt=it.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:t(this,N)),Pt={annotationType:l.AnnotationEditorType.FREETEXT,color:wt,fontSize:t(this,v),value:t(this,k),pageIndex:this.pageIndex,rect:gt,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return W?Pt:this.annotationElementId&&!G(this,m,Di).call(this,Pt)?null:(Pt.id=this.annotationElementId,Pt)}};L=new WeakMap,P=new WeakMap,p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakSet,Fi=function(W){const lt=wt=>{this.editorDiv.style.fontSize=`calc(${wt}px * var(--scale-factor))`,this.translate(0,-(wt-t(this,v))*this.parentScale),tt(this,v,wt),G(this,F,ye).call(this)},gt=t(this,v);this.addCommands({cmd:()=>{lt(W)},undo:()=>{lt(gt)},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},T=new WeakSet,Mi=function(W){const lt=t(this,N);this.addCommands({cmd:()=>{tt(this,N,this.editorDiv.style.color=W)},undo:()=>{tt(this,N,this.editorDiv.style.color=lt)},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},a=new WeakSet,Ri=function(){const W=this.editorDiv.getElementsByTagName("div");if(W.length===0)return this.editorDiv.innerText;const lt=[];for(const gt of W)lt.push(gt.innerText.replace(/\r\n?|\n/,""));return lt.join(`
`)},F=new WeakSet,ye=function(){const[W,lt]=this.parentDimensions;let gt;if(this.isAttachedToDOM)gt=this.div.getBoundingClientRect();else{const{currentLayer:wt,div:Pt}=this,E=Pt.style.display;Pt.style.display="hidden",wt.div.append(this.div),gt=Pt.getBoundingClientRect(),Pt.remove(),Pt.style.display=E}this.rotation%180===this.parentRotation%180?(this.width=gt.width/W,this.height=gt.height/lt):(this.width=gt.height/W,this.height=gt.width/lt),this.fixAndSetPosition()},r=new WeakSet,ni=function(){if(this.editorDiv.replaceChildren(),!!t(this,k))for(const W of t(this,k).split(`
`)){const lt=document.createElement("div");lt.append(W?document.createTextNode(W):document.createElement("br")),this.editorDiv.append(lt)}},m=new WeakSet,Di=function(W){const{value:lt,fontSize:gt,color:wt,rect:Pt,pageIndex:E}=t(this,u);return W.value!==lt||W.fontSize!==gt||W.rect.some((i,n)=>Math.abs(i-Pt[n])>=1)||W.color.some((i,n)=>i!==wt[n])||W.pageIndex!==E},X=new WeakSet,ri=function(W=!1){if(!this.annotationElementId)return;if(G(this,F,ye).call(this),!W&&(this.width===0||this.height===0)){setTimeout(()=>G(this,X,ri).call(this,!0),0);return}const lt=$._internalPadding*this.parentScale;t(this,u).rect=this.getRect(lt,lt)},ee($,"_freeTextDefaultContent",""),ee($,"_internalPadding",0),ee($,"_defaultColor",null),ee($,"_defaultFontSize",10),ee($,"_type","freetext");let ct=$;c.FreeTextEditor=ct},(ft,c,K)=>{var n,o,ce,_,Ii,B,et,Z,rt,ht,yt,ut,Ft,Bt,St,Dt,pt,J,Q,dt,Et,Ct,jt,Li,Ht,Fe,$t,ai,qt,oi,Y,z,_t,At,te,Zt,q,li,Lt,Tt,Ot,Nt,Oi,bt,ci;Object.defineProperty(c,"__esModule",{value:!0}),c.StampAnnotationElement=c.InkAnnotationElement=c.FreeTextAnnotationElement=c.AnnotationLayer=void 0;var l=K(1),y=K(6),it=K(3),U=K(30),ct=K(31),L=K(32);const P=1e3,p=9,O=new WeakSet;function N(It){return{width:It[2]-It[0],height:It[3]-It[1]}}class k{static create(R){switch(R.data.annotationType){case l.AnnotationType.LINK:return new v(R);case l.AnnotationType.TEXT:return new u(R);case l.AnnotationType.WIDGET:switch(R.data.fieldType){case"Tx":return new C(R);case"Btn":return R.data.radioButton?new a(R):R.data.checkBox?new A(R):new h(R);case"Ch":return new F(R);case"Sig":return new T(R)}return new b(R);case l.AnnotationType.POPUP:return new g(R);case l.AnnotationType.FREETEXT:return new x(R);case l.AnnotationType.LINE:return new m(R);case l.AnnotationType.SQUARE:return new j(R);case l.AnnotationType.CIRCLE:return new X(R);case l.AnnotationType.POLYLINE:return new w(R);case l.AnnotationType.CARET:return new nt(R);case l.AnnotationType.INK:return new at(R);case l.AnnotationType.POLYGON:return new $(R);case l.AnnotationType.HIGHLIGHT:return new W(R);case l.AnnotationType.UNDERLINE:return new lt(R);case l.AnnotationType.SQUIGGLY:return new gt(R);case l.AnnotationType.STRIKEOUT:return new wt(R);case l.AnnotationType.STAMP:return new Pt(R);case l.AnnotationType.FILEATTACHMENT:return new E(R);default:return new S(R)}}}const s=class s{constructor(R,{isRenderable:e=!1,ignoreBorder:f=!1,createQuadrilaterals:D=!1}={}){I(this,n,!1);this.isRenderable=e,this.data=R.data,this.layer=R.layer,this.linkService=R.linkService,this.downloadManager=R.downloadManager,this.imageResourcesPath=R.imageResourcesPath,this.renderForms=R.renderForms,this.svgFactory=R.svgFactory,this.annotationStorage=R.annotationStorage,this.enableScripting=R.enableScripting,this.hasJSActions=R.hasJSActions,this._fieldObjects=R.fieldObjects,this.parent=R.parent,e&&(this.container=this._createContainer(f)),D&&this._createQuadrilaterals()}static _hasPopupData({titleObj:R,contentsObj:e,richText:f}){return!!(R!=null&&R.str||e!=null&&e.str||f!=null&&f.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(R){const{data:e,parent:{page:f,viewport:D}}=this,H=document.createElement("section");H.setAttribute("data-annotation-id",e.id),this instanceof b||(H.tabIndex=P),H.style.zIndex=this.parent.zIndex++,this.data.popupRef&&H.setAttribute("aria-haspopup","dialog"),e.noRotate&&H.classList.add("norotate");const{pageWidth:V,pageHeight:st,pageX:mt,pageY:kt}=D.rawDims;if(!e.rect||this instanceof g){const{rotation:Ut}=e;return!e.hasOwnCanvas&&Ut!==0&&this.setRotation(Ut,H),H}const{width:xt,height:zt}=N(e.rect),Mt=l.Util.normalizeRect([e.rect[0],f.view[3]-e.rect[1]+f.view[1],e.rect[2],f.view[3]-e.rect[3]+f.view[1]]);if(!R&&e.borderStyle.width>0){H.style.borderWidth=`${e.borderStyle.width}px`;const Ut=e.borderStyle.horizontalCornerRadius,Vt=e.borderStyle.verticalCornerRadius;if(Ut>0||Vt>0){const Qt=`calc(${Ut}px * var(--scale-factor)) / calc(${Vt}px * var(--scale-factor))`;H.style.borderRadius=Qt}else if(this instanceof a){const Qt=`calc(${xt}px * var(--scale-factor)) / calc(${zt}px * var(--scale-factor))`;H.style.borderRadius=Qt}switch(e.borderStyle.style){case l.AnnotationBorderStyleType.SOLID:H.style.borderStyle="solid";break;case l.AnnotationBorderStyleType.DASHED:H.style.borderStyle="dashed";break;case l.AnnotationBorderStyleType.BEVELED:(0,l.warn)("Unimplemented border style: beveled");break;case l.AnnotationBorderStyleType.INSET:(0,l.warn)("Unimplemented border style: inset");break;case l.AnnotationBorderStyleType.UNDERLINE:H.style.borderBottomStyle="solid";break}const Kt=e.borderColor||null;Kt?(tt(this,n,!0),H.style.borderColor=l.Util.makeHexColor(Kt[0]|0,Kt[1]|0,Kt[2]|0)):H.style.borderWidth=0}H.style.left=`${100*(Mt[0]-mt)/V}%`,H.style.top=`${100*(Mt[1]-kt)/st}%`;const{rotation:Rt}=e;return e.hasOwnCanvas||Rt===0?(H.style.width=`${100*xt/V}%`,H.style.height=`${100*zt/st}%`):this.setRotation(Rt,H),H}setRotation(R,e=this.container){if(!this.data.rect)return;const{pageWidth:f,pageHeight:D}=this.parent.viewport.rawDims,{width:H,height:V}=N(this.data.rect);let st,mt;R%180===0?(st=100*H/f,mt=100*V/D):(st=100*V/f,mt=100*H/D),e.style.width=`${st}%`,e.style.height=`${mt}%`,e.setAttribute("data-main-rotation",(360-R)%360)}get _commonActions(){const R=(e,f,D)=>{const H=D.detail[e],V=H[0],st=H.slice(1);D.target.style[f]=U.ColorConverters[`${V}_HTML`](st),this.annotationStorage.setValue(this.data.id,{[f]:U.ColorConverters[`${V}_rgb`](st)})};return(0,l.shadow)(this,"_commonActions",{display:e=>{const{display:f}=e.detail,D=f%2===1;this.container.style.visibility=D?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:D,noPrint:f===1||f===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:f}=e.detail;this.container.style.visibility=f?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:f,noView:f})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{R("bgColor","backgroundColor",e)},fillColor:e=>{R("fillColor","backgroundColor",e)},fgColor:e=>{R("fgColor","color",e)},textColor:e=>{R("textColor","color",e)},borderColor:e=>{R("borderColor","borderColor",e)},strokeColor:e=>{R("strokeColor","borderColor",e)},rotation:e=>{const f=e.detail.rotation;this.setRotation(f),this.annotationStorage.setValue(this.data.id,{rotation:f})}})}_dispatchEventFromSandbox(R,e){const f=this._commonActions;for(const D of Object.keys(e.detail)){const H=R[D]||f[D];H==null||H(e)}}_setDefaultPropertiesFromJS(R){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const f=this._commonActions;for(const[D,H]of Object.entries(e)){const V=f[D];if(V){const st={detail:{[D]:H},target:R};V(st),delete e[D]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:R}=this.data;if(!R)return;const[e,f,D,H]=this.data.rect;if(R.length===1){const[,{x:Vt,y:Kt},{x:Qt,y:se}]=R[0];if(D===Vt&&H===Kt&&e===Qt&&f===se)return}const{style:V}=this.container;let st;if(t(this,n)){const{borderColor:Vt,borderWidth:Kt}=V;V.borderWidth=0,st=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Vt}" stroke-width="${Kt}">`],this.container.classList.add("hasBorder")}const mt=D-e,kt=H-f,{svgFactory:xt}=this,zt=xt.createElement("svg");zt.classList.add("quadrilateralsContainer"),zt.setAttribute("width",0),zt.setAttribute("height",0);const Mt=xt.createElement("defs");zt.append(Mt);const Rt=xt.createElement("clipPath"),Ut=`clippath_${this.data.id}`;Rt.setAttribute("id",Ut),Rt.setAttribute("clipPathUnits","objectBoundingBox"),Mt.append(Rt);for(const[,{x:Vt,y:Kt},{x:Qt,y:se}]of R){const ie=xt.createElement("rect"),ne=(Qt-e)/mt,oe=(H-Kt)/kt,le=(Vt-Qt)/mt,bi=(Kt-se)/kt;ie.setAttribute("x",ne),ie.setAttribute("y",oe),ie.setAttribute("width",le),ie.setAttribute("height",bi),Rt.append(ie),st==null||st.push(`<rect vector-effect="non-scaling-stroke" x="${ne}" y="${oe}" width="${le}" height="${bi}"/>`)}t(this,n)&&(st.push("</g></svg>')"),V.backgroundImage=st.join("")),this.container.append(zt),this.container.style.clipPath=`url(#${Ut})`}_createPopup(){const{container:R,data:e}=this;R.setAttribute("aria-haspopup","dialog");const f=new g({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(f.render())}render(){(0,l.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(R,e=null){const f=[];if(this._fieldObjects){const D=this._fieldObjects[R];if(D)for(const{page:H,id:V,exportValues:st}of D){if(H===-1||V===e)continue;const mt=typeof st=="string"?st:null,kt=document.querySelector(`[data-element-id="${V}"]`);if(kt&&!O.has(kt)){(0,l.warn)(`_getElementsByName - element not allowed: ${V}`);continue}f.push({id:V,exportValue:mt,domElement:kt})}return f}for(const D of document.getElementsByName(R)){const{exportValue:H}=D,V=D.getAttribute("data-element-id");V!==e&&O.has(D)&&f.push({id:V,exportValue:H,domElement:D})}return f}show(){var R;this.container&&(this.container.hidden=!1),(R=this.popup)==null||R.maybeShow()}hide(){var R;this.container&&(this.container.hidden=!0),(R=this.popup)==null||R.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const R=this.getElementsToTriggerPopup();if(Array.isArray(R))for(const e of R)e.classList.add("highlightArea");else R.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:R,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var f;(f=this.linkService.eventBus)==null||f.dispatch("switchannotationeditormode",{source:this,mode:R,editId:e})})}};n=new WeakMap;let S=s;class v extends S{constructor(e,f=null){super(e,{isRenderable:!0,ignoreBorder:!!(f!=null&&f.ignoreBorder),createQuadrilaterals:!0});I(this,o);I(this,_);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:f}=this,D=document.createElement("a");D.setAttribute("data-element-id",e.id);let H=!1;return e.url?(f.addLinkAttributes(D,e.url,e.newWindow),H=!0):e.action?(this._bindNamedAction(D,e.action),H=!0):e.attachment?(this._bindAttachment(D,e.attachment),H=!0):e.setOCGState?(G(this,_,Ii).call(this,D,e.setOCGState),H=!0):e.dest?(this._bindLink(D,e.dest),H=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(D,e),H=!0),e.resetForm?(this._bindResetFormAction(D,e.resetForm),H=!0):this.isTooltipOnly&&!H&&(this._bindLink(D,""),H=!0)),this.container.classList.add("linkAnnotation"),H&&this.container.append(D),this.container}_bindLink(e,f){e.href=this.linkService.getDestinationHash(f),e.onclick=()=>(f&&this.linkService.goToDestination(f),!1),(f||f==="")&&G(this,o,ce).call(this)}_bindNamedAction(e,f){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(f),!1),G(this,o,ce).call(this)}_bindAttachment(e,f){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var D;return(D=this.downloadManager)==null||D.openOrDownloadData(this.container,f.content,f.filename),!1},G(this,o,ce).call(this)}_bindJSAction(e,f){e.href=this.linkService.getAnchorUrl("");const D=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const H of Object.keys(f.actions)){const V=D.get(H);V&&(e[V]=()=>{var st;return(st=this.linkService.eventBus)==null||st.dispatch("dispatcheventinsandbox",{source:this,detail:{id:f.id,name:H}}),!1})}e.onclick||(e.onclick=()=>!1),G(this,o,ce).call(this)}_bindResetFormAction(e,f){const D=e.onclick;if(D||(e.href=this.linkService.getAnchorUrl("")),G(this,o,ce).call(this),!this._fieldObjects){(0,l.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),D||(e.onclick=()=>!1);return}e.onclick=()=>{var zt;D==null||D();const{fields:H,refs:V,include:st}=f,mt=[];if(H.length!==0||V.length!==0){const Mt=new Set(V);for(const Rt of H){const Ut=this._fieldObjects[Rt]||[];for(const{id:Vt}of Ut)Mt.add(Vt)}for(const Rt of Object.values(this._fieldObjects))for(const Ut of Rt)Mt.has(Ut.id)===st&&mt.push(Ut)}else for(const Mt of Object.values(this._fieldObjects))mt.push(...Mt);const kt=this.annotationStorage,xt=[];for(const Mt of mt){const{id:Rt}=Mt;switch(xt.push(Rt),Mt.type){case"text":{const Vt=Mt.defaultValue||"";kt.setValue(Rt,{value:Vt});break}case"checkbox":case"radiobutton":{const Vt=Mt.defaultValue===Mt.exportValues;kt.setValue(Rt,{value:Vt});break}case"combobox":case"listbox":{const Vt=Mt.defaultValue||"";kt.setValue(Rt,{value:Vt});break}default:continue}const Ut=document.querySelector(`[data-element-id="${Rt}"]`);if(Ut){if(!O.has(Ut)){(0,l.warn)(`_bindResetFormAction - element not allowed: ${Rt}`);continue}}else continue;Ut.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((zt=this.linkService.eventBus)==null||zt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:xt,name:"ResetForm"}})),!1}}}o=new WeakSet,ce=function(){this.container.setAttribute("data-internal-link","")},_=new WeakSet,Ii=function(e,f){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(f),!1),G(this,o,ce).call(this)};class u extends S{constructor(R){super(R,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const R=document.createElement("img");return R.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",R.alt="[{{type}} Annotation]",R.dataset.l10nId="text_annotation_type",R.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(R),this.container}}class b extends S{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(R){var e;this.data.hasOwnCanvas&&(((e=R.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(R.previousSibling.hidden=!0),R.hidden=!1)}_getKeyModifier(R){const{isWin:e,isMac:f}=l.FeatureTest.platform;return e&&R.ctrlKey||f&&R.metaKey}_setEventListener(R,e,f,D,H){f.includes("mouse")?R.addEventListener(f,V=>{var st;(st=this.linkService.eventBus)==null||st.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:H(V),shift:V.shiftKey,modifier:this._getKeyModifier(V)}})}):R.addEventListener(f,V=>{var st;if(f==="blur"){if(!e.focused||!V.relatedTarget)return;e.focused=!1}else if(f==="focus"){if(e.focused)return;e.focused=!0}H&&((st=this.linkService.eventBus)==null||st.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:D,value:H(V)}}))})}_setEventListeners(R,e,f,D){var H,V,st;for(const[mt,kt]of f)(kt==="Action"||(H=this.data.actions)!=null&&H[kt])&&((kt==="Focus"||kt==="Blur")&&(e||(e={focused:!1})),this._setEventListener(R,e,mt,kt,D),kt==="Focus"&&!((V=this.data.actions)!=null&&V.Blur)?this._setEventListener(R,e,"blur","Blur",null):kt==="Blur"&&!((st=this.data.actions)!=null&&st.Focus)&&this._setEventListener(R,e,"focus","Focus",null))}_setBackgroundColor(R){const e=this.data.backgroundColor||null;R.style.backgroundColor=e===null?"transparent":l.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(R){const e=["left","center","right"],{fontColor:f}=this.data.defaultAppearanceData,D=this.data.defaultAppearanceData.fontSize||p,H=R.style;let V;const st=2,mt=kt=>Math.round(10*kt)/10;if(this.data.multiLine){const kt=Math.abs(this.data.rect[3]-this.data.rect[1]-st),xt=Math.round(kt/(l.LINE_FACTOR*D))||1,zt=kt/xt;V=Math.min(D,mt(zt/l.LINE_FACTOR))}else{const kt=Math.abs(this.data.rect[3]-this.data.rect[1]-st);V=Math.min(D,mt(kt/l.LINE_FACTOR))}H.fontSize=`calc(${V}px * var(--scale-factor))`,H.color=l.Util.makeHexColor(f[0],f[1],f[2]),this.data.textAlignment!==null&&(H.textAlign=e[this.data.textAlignment])}_setRequired(R,e){e?R.setAttribute("required",!0):R.removeAttribute("required"),R.setAttribute("aria-required",e)}}class C extends b{constructor(R){const e=R.renderForms||!R.data.hasAppearance&&!!R.data.fieldValue;super(R,{isRenderable:e})}setPropertyOnSiblings(R,e,f,D){const H=this.annotationStorage;for(const V of this._getElementsByName(R.name,R.id))V.domElement&&(V.domElement[e]=f),H.setValue(V.id,{[D]:f})}render(){var D,H;const R=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let f=null;if(this.renderForms){const V=R.getValue(e,{value:this.data.fieldValue});let st=V.value||"";const mt=R.getValue(e,{charLimit:this.data.maxLen}).charLimit;mt&&st.length>mt&&(st=st.slice(0,mt));let kt=V.formattedValue||((D=this.data.textContent)==null?void 0:D.join(`
`))||null;kt&&this.data.comb&&(kt=kt.replaceAll(/\s+/g,""));const xt={userValue:st,formattedValue:kt,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(f=document.createElement("textarea"),f.textContent=kt??st,this.data.doNotScroll&&(f.style.overflowY="hidden")):(f=document.createElement("input"),f.type="text",f.setAttribute("value",kt??st),this.data.doNotScroll&&(f.style.overflowX="hidden")),this.data.hasOwnCanvas&&(f.hidden=!0),O.add(f),f.setAttribute("data-element-id",e),f.disabled=this.data.readOnly,f.name=this.data.fieldName,f.tabIndex=P,this._setRequired(f,this.data.required),mt&&(f.maxLength=mt),f.addEventListener("input",Mt=>{R.setValue(e,{value:Mt.target.value}),this.setPropertyOnSiblings(f,"value",Mt.target.value,"value"),xt.formattedValue=null}),f.addEventListener("resetform",Mt=>{const Rt=this.data.defaultFieldValue??"";f.value=xt.userValue=Rt,xt.formattedValue=null});let zt=Mt=>{const{formattedValue:Rt}=xt;Rt!=null&&(Mt.target.value=Rt),Mt.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){f.addEventListener("focus",Rt=>{if(xt.focused)return;const{target:Ut}=Rt;xt.userValue&&(Ut.value=xt.userValue),xt.lastCommittedValue=Ut.value,xt.commitKey=1,xt.focused=!0}),f.addEventListener("updatefromsandbox",Rt=>{this.showElementAndHideCanvas(Rt.target);const Ut={value(Vt){xt.userValue=Vt.detail.value??"",R.setValue(e,{value:xt.userValue.toString()}),Vt.target.value=xt.userValue},formattedValue(Vt){const{formattedValue:Kt}=Vt.detail;xt.formattedValue=Kt,Kt!=null&&Vt.target!==document.activeElement&&(Vt.target.value=Kt),R.setValue(e,{formattedValue:Kt})},selRange(Vt){Vt.target.setSelectionRange(...Vt.detail.selRange)},charLimit:Vt=>{var ie;const{charLimit:Kt}=Vt.detail,{target:Qt}=Vt;if(Kt===0){Qt.removeAttribute("maxLength");return}Qt.setAttribute("maxLength",Kt);let se=xt.userValue;!se||se.length<=Kt||(se=se.slice(0,Kt),Qt.value=xt.userValue=se,R.setValue(e,{value:se}),(ie=this.linkService.eventBus)==null||ie.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:se,willCommit:!0,commitKey:1,selStart:Qt.selectionStart,selEnd:Qt.selectionEnd}}))}};this._dispatchEventFromSandbox(Ut,Rt)}),f.addEventListener("keydown",Rt=>{var Kt;xt.commitKey=1;let Ut=-1;if(Rt.key==="Escape"?Ut=0:Rt.key==="Enter"&&!this.data.multiLine?Ut=2:Rt.key==="Tab"&&(xt.commitKey=3),Ut===-1)return;const{value:Vt}=Rt.target;xt.lastCommittedValue!==Vt&&(xt.lastCommittedValue=Vt,xt.userValue=Vt,(Kt=this.linkService.eventBus)==null||Kt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Vt,willCommit:!0,commitKey:Ut,selStart:Rt.target.selectionStart,selEnd:Rt.target.selectionEnd}}))});const Mt=zt;zt=null,f.addEventListener("blur",Rt=>{var Vt;if(!xt.focused||!Rt.relatedTarget)return;xt.focused=!1;const{value:Ut}=Rt.target;xt.userValue=Ut,xt.lastCommittedValue!==Ut&&((Vt=this.linkService.eventBus)==null||Vt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Ut,willCommit:!0,commitKey:xt.commitKey,selStart:Rt.target.selectionStart,selEnd:Rt.target.selectionEnd}})),Mt(Rt)}),(H=this.data.actions)!=null&&H.Keystroke&&f.addEventListener("beforeinput",Rt=>{var oe;xt.lastCommittedValue=null;const{data:Ut,target:Vt}=Rt,{value:Kt,selectionStart:Qt,selectionEnd:se}=Vt;let ie=Qt,ne=se;switch(Rt.inputType){case"deleteWordBackward":{const le=Kt.substring(0,Qt).match(/\w*[^\w]*$/);le&&(ie-=le[0].length);break}case"deleteWordForward":{const le=Kt.substring(Qt).match(/^[^\w]*\w*/);le&&(ne+=le[0].length);break}case"deleteContentBackward":Qt===se&&(ie-=1);break;case"deleteContentForward":Qt===se&&(ne+=1);break}Rt.preventDefault(),(oe=this.linkService.eventBus)==null||oe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Kt,change:Ut||"",willCommit:!1,selStart:ie,selEnd:ne}})}),this._setEventListeners(f,xt,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Rt=>Rt.target.value)}if(zt&&f.addEventListener("blur",zt),this.data.comb){const Rt=(this.data.rect[2]-this.data.rect[0])/mt;f.classList.add("comb"),f.style.letterSpacing=`calc(${Rt}px * var(--scale-factor) - 1ch)`}}else f=document.createElement("div"),f.textContent=this.data.fieldValue,f.style.verticalAlign="middle",f.style.display="table-cell";return this._setTextStyle(f),this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class T extends b{constructor(R){super(R,{isRenderable:!!R.data.hasOwnCanvas})}}class A extends b{constructor(R){super(R,{isRenderable:R.renderForms})}render(){const R=this.annotationStorage,e=this.data,f=e.id;let D=R.getValue(f,{value:e.exportValue===e.fieldValue}).value;typeof D=="string"&&(D=D!=="Off",R.setValue(f,{value:D})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const H=document.createElement("input");return O.add(H),H.setAttribute("data-element-id",f),H.disabled=e.readOnly,this._setRequired(H,this.data.required),H.type="checkbox",H.name=e.fieldName,D&&H.setAttribute("checked",!0),H.setAttribute("exportValue",e.exportValue),H.tabIndex=P,H.addEventListener("change",V=>{const{name:st,checked:mt}=V.target;for(const kt of this._getElementsByName(st,f)){const xt=mt&&kt.exportValue===e.exportValue;kt.domElement&&(kt.domElement.checked=xt),R.setValue(kt.id,{value:xt})}R.setValue(f,{value:mt})}),H.addEventListener("resetform",V=>{const st=e.defaultFieldValue||"Off";V.target.checked=st===e.exportValue}),this.enableScripting&&this.hasJSActions&&(H.addEventListener("updatefromsandbox",V=>{const st={value(mt){mt.target.checked=mt.detail.value!=="Off",R.setValue(f,{value:mt.target.checked})}};this._dispatchEventFromSandbox(st,V)}),this._setEventListeners(H,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],V=>V.target.checked)),this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class a extends b{constructor(R){super(R,{isRenderable:R.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const R=this.annotationStorage,e=this.data,f=e.id;let D=R.getValue(f,{value:e.fieldValue===e.buttonValue}).value;typeof D=="string"&&(D=D!==e.buttonValue,R.setValue(f,{value:D}));const H=document.createElement("input");if(O.add(H),H.setAttribute("data-element-id",f),H.disabled=e.readOnly,this._setRequired(H,this.data.required),H.type="radio",H.name=e.fieldName,D&&H.setAttribute("checked",!0),H.tabIndex=P,H.addEventListener("change",V=>{const{name:st,checked:mt}=V.target;for(const kt of this._getElementsByName(st,f))R.setValue(kt.id,{value:!1});R.setValue(f,{value:mt})}),H.addEventListener("resetform",V=>{const st=e.defaultFieldValue;V.target.checked=st!=null&&st===e.buttonValue}),this.enableScripting&&this.hasJSActions){const V=e.buttonValue;H.addEventListener("updatefromsandbox",st=>{const mt={value:kt=>{const xt=V===kt.detail.value;for(const zt of this._getElementsByName(kt.target.name)){const Mt=xt&&zt.id===f;zt.domElement&&(zt.domElement.checked=Mt),R.setValue(zt.id,{value:Mt})}}};this._dispatchEventFromSandbox(mt,st)}),this._setEventListeners(H,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],st=>st.target.checked)}return this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class h extends v{constructor(R){super(R,{ignoreBorder:R.data.hasAppearance})}render(){const R=super.render();R.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(R.title=this.data.alternativeText);const e=R.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",f=>{this._dispatchEventFromSandbox({},f)})),R}}class F extends b{constructor(R){super(R,{isRenderable:R.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const R=this.annotationStorage,e=this.data.id,f=R.getValue(e,{value:this.data.fieldValue}),D=document.createElement("select");O.add(D),D.setAttribute("data-element-id",e),D.disabled=this.data.readOnly,this._setRequired(D,this.data.required),D.name=this.data.fieldName,D.tabIndex=P;let H=this.data.combo&&this.data.options.length>0;this.data.combo||(D.size=this.data.options.length,this.data.multiSelect&&(D.multiple=!0)),D.addEventListener("resetform",xt=>{const zt=this.data.defaultFieldValue;for(const Mt of D.options)Mt.selected=Mt.value===zt});for(const xt of this.data.options){const zt=document.createElement("option");zt.textContent=xt.displayValue,zt.value=xt.exportValue,f.value.includes(xt.exportValue)&&(zt.setAttribute("selected",!0),H=!1),D.append(zt)}let V=null;if(H){const xt=document.createElement("option");xt.value=" ",xt.setAttribute("hidden",!0),xt.setAttribute("selected",!0),D.prepend(xt),V=()=>{xt.remove(),D.removeEventListener("input",V),V=null},D.addEventListener("input",V)}const st=xt=>{const zt=xt?"value":"textContent",{options:Mt,multiple:Rt}=D;return Rt?Array.prototype.filter.call(Mt,Ut=>Ut.selected).map(Ut=>Ut[zt]):Mt.selectedIndex===-1?null:Mt[Mt.selectedIndex][zt]};let mt=st(!1);const kt=xt=>{const zt=xt.target.options;return Array.prototype.map.call(zt,Mt=>({displayValue:Mt.textContent,exportValue:Mt.value}))};return this.enableScripting&&this.hasJSActions?(D.addEventListener("updatefromsandbox",xt=>{const zt={value(Mt){V==null||V();const Rt=Mt.detail.value,Ut=new Set(Array.isArray(Rt)?Rt:[Rt]);for(const Vt of D.options)Vt.selected=Ut.has(Vt.value);R.setValue(e,{value:st(!0)}),mt=st(!1)},multipleSelection(Mt){D.multiple=!0},remove(Mt){const Rt=D.options,Ut=Mt.detail.remove;Rt[Ut].selected=!1,D.remove(Ut),Rt.length>0&&Array.prototype.findIndex.call(Rt,Kt=>Kt.selected)===-1&&(Rt[0].selected=!0),R.setValue(e,{value:st(!0),items:kt(Mt)}),mt=st(!1)},clear(Mt){for(;D.length!==0;)D.remove(0);R.setValue(e,{value:null,items:[]}),mt=st(!1)},insert(Mt){const{index:Rt,displayValue:Ut,exportValue:Vt}=Mt.detail.insert,Kt=D.children[Rt],Qt=document.createElement("option");Qt.textContent=Ut,Qt.value=Vt,Kt?Kt.before(Qt):D.append(Qt),R.setValue(e,{value:st(!0),items:kt(Mt)}),mt=st(!1)},items(Mt){const{items:Rt}=Mt.detail;for(;D.length!==0;)D.remove(0);for(const Ut of Rt){const{displayValue:Vt,exportValue:Kt}=Ut,Qt=document.createElement("option");Qt.textContent=Vt,Qt.value=Kt,D.append(Qt)}D.options.length>0&&(D.options[0].selected=!0),R.setValue(e,{value:st(!0),items:kt(Mt)}),mt=st(!1)},indices(Mt){const Rt=new Set(Mt.detail.indices);for(const Ut of Mt.target.options)Ut.selected=Rt.has(Ut.index);R.setValue(e,{value:st(!0)}),mt=st(!1)},editable(Mt){Mt.target.disabled=!Mt.detail.editable}};this._dispatchEventFromSandbox(zt,xt)}),D.addEventListener("input",xt=>{var Mt;const zt=st(!0);R.setValue(e,{value:zt}),xt.preventDefault(),(Mt=this.linkService.eventBus)==null||Mt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:mt,changeEx:zt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(D,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],xt=>xt.target.value)):D.addEventListener("input",function(xt){R.setValue(e,{value:st(!0)})}),this.data.combo&&this._setTextStyle(D),this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class g extends S{constructor(R){const{data:e,elements:f}=R;super(R,{isRenderable:S._hasPopupData(e)}),this.elements=f}render(){this.container.classList.add("popupAnnotation");const R=new r({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const f of this.elements)f.popup=R,e.push(f.data.id),f.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(f=>`${l.AnnotationPrefix}${f}`).join(",")),this.container}}class r{constructor({container:R,color:e,elements:f,titleObj:D,modificationDate:H,contentsObj:V,richText:st,parent:mt,rect:kt,parentRect:xt,open:zt}){I(this,jt);I(this,Ht);I(this,$t);I(this,qt);I(this,B,null);I(this,et,G(this,jt,Li).bind(this));I(this,Z,G(this,qt,oi).bind(this));I(this,rt,G(this,$t,ai).bind(this));I(this,ht,G(this,Ht,Fe).bind(this));I(this,yt,null);I(this,ut,null);I(this,Ft,null);I(this,Bt,null);I(this,St,null);I(this,Dt,null);I(this,pt,!1);I(this,J,null);I(this,Q,null);I(this,dt,null);I(this,Et,null);I(this,Ct,!1);var Rt;tt(this,ut,R),tt(this,Et,D),tt(this,Ft,V),tt(this,dt,st),tt(this,St,mt),tt(this,yt,e),tt(this,Q,kt),tt(this,Dt,xt),tt(this,Bt,f);const Mt=y.PDFDateString.toDateObject(H);Mt&&tt(this,B,mt.l10n.get("annotation_date_string",{date:Mt.toLocaleDateString(),time:Mt.toLocaleTimeString()})),this.trigger=f.flatMap(Ut=>Ut.getElementsToTriggerPopup());for(const Ut of this.trigger)Ut.addEventListener("click",t(this,ht)),Ut.addEventListener("mouseenter",t(this,rt)),Ut.addEventListener("mouseleave",t(this,Z)),Ut.classList.add("popupTriggerArea");for(const Ut of f)(Rt=Ut.container)==null||Rt.addEventListener("keydown",t(this,et));t(this,ut).hidden=!0,zt&&G(this,Ht,Fe).call(this)}render(){if(t(this,J))return;const{page:{view:R},viewport:{rawDims:{pageWidth:e,pageHeight:f,pageX:D,pageY:H}}}=t(this,St),V=tt(this,J,document.createElement("div"));if(V.className="popup",t(this,yt)){const ie=V.style.outlineColor=l.Util.makeHexColor(...t(this,yt));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?V.style.backgroundColor=`color-mix(in srgb, ${ie} 30%, white)`:V.style.backgroundColor=l.Util.makeHexColor(...t(this,yt).map(oe=>Math.floor(.7*(255-oe)+oe)))}const st=document.createElement("span");st.className="header";const mt=document.createElement("h1");if(st.append(mt),{dir:mt.dir,str:mt.textContent}=t(this,Et),V.append(st),t(this,B)){const ie=document.createElement("span");ie.classList.add("popupDate"),t(this,B).then(ne=>{ie.textContent=ne}),st.append(ie)}const kt=t(this,Ft),xt=t(this,dt);if(xt!=null&&xt.str&&(!(kt!=null&&kt.str)||kt.str===xt.str))L.XfaLayer.render({xfaHtml:xt.html,intent:"richText",div:V}),V.lastChild.classList.add("richText","popupContent");else{const ie=this._formatContents(kt);V.append(ie)}let zt=!!t(this,Dt),Mt=zt?t(this,Dt):t(this,Q);for(const ie of t(this,Bt))if(!Mt||l.Util.intersect(ie.data.rect,Mt)!==null){Mt=ie.data.rect,zt=!0;break}const Rt=l.Util.normalizeRect([Mt[0],R[3]-Mt[1]+R[1],Mt[2],R[3]-Mt[3]+R[1]]),Ut=5,Vt=zt?Mt[2]-Mt[0]+Ut:0,Kt=Rt[0]+Vt,Qt=Rt[1],{style:se}=t(this,ut);se.left=`${100*(Kt-D)/e}%`,se.top=`${100*(Qt-H)/f}%`,t(this,ut).append(V)}_formatContents({str:R,dir:e}){const f=document.createElement("p");f.classList.add("popupContent"),f.dir=e;const D=R.split(/(?:\r\n?|\n)/);for(let H=0,V=D.length;H<V;++H){const st=D[H];f.append(document.createTextNode(st)),H<V-1&&f.append(document.createElement("br"))}return f}forceHide(){tt(this,Ct,this.isVisible),t(this,Ct)&&(t(this,ut).hidden=!0)}maybeShow(){t(this,Ct)&&(tt(this,Ct,!1),t(this,ut).hidden=!1)}get isVisible(){return t(this,ut).hidden===!1}}B=new WeakMap,et=new WeakMap,Z=new WeakMap,rt=new WeakMap,ht=new WeakMap,yt=new WeakMap,ut=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,St=new WeakMap,Dt=new WeakMap,pt=new WeakMap,J=new WeakMap,Q=new WeakMap,dt=new WeakMap,Et=new WeakMap,Ct=new WeakMap,jt=new WeakSet,Li=function(R){R.altKey||R.shiftKey||R.ctrlKey||R.metaKey||(R.key==="Enter"||R.key==="Escape"&&t(this,pt))&&G(this,Ht,Fe).call(this)},Ht=new WeakSet,Fe=function(){tt(this,pt,!t(this,pt)),t(this,pt)?(G(this,$t,ai).call(this),t(this,ut).addEventListener("click",t(this,ht)),t(this,ut).addEventListener("keydown",t(this,et))):(G(this,qt,oi).call(this),t(this,ut).removeEventListener("click",t(this,ht)),t(this,ut).removeEventListener("keydown",t(this,et)))},$t=new WeakSet,ai=function(){t(this,J)||this.render(),this.isVisible?t(this,pt)&&t(this,ut).classList.add("focused"):(t(this,ut).hidden=!1,t(this,ut).style.zIndex=parseInt(t(this,ut).style.zIndex)+1e3)},qt=new WeakSet,oi=function(){t(this,ut).classList.remove("focused"),!(t(this,pt)||!this.isVisible)&&(t(this,ut).hidden=!0,t(this,ut).style.zIndex=parseInt(t(this,ut).style.zIndex)-1e3)};class x extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0}),this.textContent=R.data.textContent,this.textPosition=R.data.textPosition,this.annotationEditorType=l.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const R=document.createElement("div");R.classList.add("annotationTextContent"),R.setAttribute("role","comment");for(const e of this.textContent){const f=document.createElement("span");f.textContent=e,R.append(f)}this.container.append(R)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}c.FreeTextAnnotationElement=x;class m extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});I(this,Y,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:f,height:D}=N(e.rect),H=this.svgFactory.create(f,D,!0),V=tt(this,Y,this.svgFactory.createElement("svg:line"));return V.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),V.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),V.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),V.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),V.setAttribute("stroke-width",e.borderStyle.width||1),V.setAttribute("stroke","transparent"),V.setAttribute("fill","transparent"),H.append(V),this.container.append(H),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,Y)}addHighlightArea(){this.container.classList.add("highlightArea")}}Y=new WeakMap;class j extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});I(this,z,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:f,height:D}=N(e.rect),H=this.svgFactory.create(f,D,!0),V=e.borderStyle.width,st=tt(this,z,this.svgFactory.createElement("svg:rect"));return st.setAttribute("x",V/2),st.setAttribute("y",V/2),st.setAttribute("width",f-V),st.setAttribute("height",D-V),st.setAttribute("stroke-width",V||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),H.append(st),this.container.append(H),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,z)}addHighlightArea(){this.container.classList.add("highlightArea")}}z=new WeakMap;class X extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});I(this,_t,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:f,height:D}=N(e.rect),H=this.svgFactory.create(f,D,!0),V=e.borderStyle.width,st=tt(this,_t,this.svgFactory.createElement("svg:ellipse"));return st.setAttribute("cx",f/2),st.setAttribute("cy",D/2),st.setAttribute("rx",f/2-V/2),st.setAttribute("ry",D/2-V/2),st.setAttribute("stroke-width",V||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),H.append(st),this.container.append(H),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,_t)}addHighlightArea(){this.container.classList.add("highlightArea")}}_t=new WeakMap;class w extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});I(this,At,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:f,height:D}=N(e.rect),H=this.svgFactory.create(f,D,!0);let V=[];for(const mt of e.vertices){const kt=mt.x-e.rect[0],xt=e.rect[3]-mt.y;V.push(kt+","+xt)}V=V.join(" ");const st=tt(this,At,this.svgFactory.createElement(this.svgElementName));return st.setAttribute("points",V),st.setAttribute("stroke-width",e.borderStyle.width||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),H.append(st),this.container.append(H),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,At)}addHighlightArea(){this.container.classList.add("highlightArea")}}At=new WeakMap;class $ extends w{constructor(R){super(R),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class nt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class at extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});I(this,te,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=l.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:f,height:D}=N(e.rect),H=this.svgFactory.create(f,D,!0);for(const V of e.inkLists){let st=[];for(const kt of V){const xt=kt.x-e.rect[0],zt=e.rect[3]-kt.y;st.push(`${xt},${zt}`)}st=st.join(" ");const mt=this.svgFactory.createElement(this.svgElementName);t(this,te).push(mt),mt.setAttribute("points",st),mt.setAttribute("stroke-width",e.borderStyle.width||1),mt.setAttribute("stroke","transparent"),mt.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),H.append(mt)}return this.container.append(H),this.container}getElementsToTriggerPopup(){return t(this,te)}addHighlightArea(){this.container.classList.add("highlightArea")}}te=new WeakMap,c.InkAnnotationElement=at;class W extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class lt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class gt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class wt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Pt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}c.StampAnnotationElement=Pt;class E extends S{constructor(e){var H;super(e,{isRenderable:!0});I(this,q);I(this,Zt,null);const{filename:f,content:D}=this.data.file;this.filename=(0,y.getFilenameFromUrl)(f,!0),this.content=D,(H=this.linkService.eventBus)==null||H.dispatch("fileattachmentannotation",{source:this,filename:f,content:D})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:f}=this;let D;f.hasAppearance||f.fillAlpha===0?D=document.createElement("div"):(D=document.createElement("img"),D.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(f.name)?"paperclip":"pushpin"}.svg`,f.fillAlpha&&f.fillAlpha<1&&(D.style=`filter: opacity(${Math.round(f.fillAlpha*100)}%);`)),D.addEventListener("dblclick",G(this,q,li).bind(this)),tt(this,Zt,D);const{isMac:H}=l.FeatureTest.platform;return e.addEventListener("keydown",V=>{V.key==="Enter"&&(H?V.metaKey:V.ctrlKey)&&G(this,q,li).call(this)}),!f.popupRef&&this.hasPopupData?this._createPopup():D.classList.add("popupTriggerArea"),e.append(D),e}getElementsToTriggerPopup(){return t(this,Zt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zt=new WeakMap,q=new WeakSet,li=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)};class i{constructor({div:R,accessibilityManager:e,annotationCanvasMap:f,l10n:D,page:H,viewport:V}){I(this,Nt);I(this,bt);I(this,Lt,null);I(this,Tt,null);I(this,Ot,new Map);this.div=R,tt(this,Lt,e),tt(this,Tt,f),this.l10n=D,this.page=H,this.viewport=V,this.zIndex=0,this.l10n||(this.l10n=ct.NullL10n)}async render(R){const{annotations:e}=R,f=this.div;(0,y.setLayerDimensions)(f,this.viewport);const D=new Map,H={data:null,layer:f,linkService:R.linkService,downloadManager:R.downloadManager,imageResourcesPath:R.imageResourcesPath||"",renderForms:R.renderForms!==!1,svgFactory:new y.DOMSVGFactory,annotationStorage:R.annotationStorage||new it.AnnotationStorage,enableScripting:R.enableScripting===!0,hasJSActions:R.hasJSActions,fieldObjects:R.fieldObjects,parent:this,elements:null};for(const V of e){if(V.noHTML)continue;const st=V.annotationType===l.AnnotationType.POPUP;if(st){const xt=D.get(V.id);if(!xt)continue;H.elements=xt}else{const{width:xt,height:zt}=N(V.rect);if(xt<=0||zt<=0)continue}H.data=V;const mt=k.create(H);if(!mt.isRenderable)continue;if(!st&&V.popupRef){const xt=D.get(V.popupRef);xt?xt.push(mt):D.set(V.popupRef,[mt])}mt.annotationEditorType>0&&t(this,Ot).set(mt.data.id,mt);const kt=mt.render();V.hidden&&(kt.style.visibility="hidden"),G(this,Nt,Oi).call(this,kt,V.id)}G(this,bt,ci).call(this),await this.l10n.translate(f)}update({viewport:R}){const e=this.div;this.viewport=R,(0,y.setLayerDimensions)(e,{rotation:R.rotation}),G(this,bt,ci).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(t(this,Ot).values())}getEditableAnnotation(R){return t(this,Ot).get(R)}}Lt=new WeakMap,Tt=new WeakMap,Ot=new WeakMap,Nt=new WeakSet,Oi=function(R,e){var D;const f=R.firstChild||R;f.id=`${l.AnnotationPrefix}${e}`,this.div.append(R),(D=t(this,Lt))==null||D.moveElementInDOM(this.div,R,f,!1)},bt=new WeakSet,ci=function(){if(!t(this,Tt))return;const R=this.div;for(const[e,f]of t(this,Tt)){const D=R.querySelector(`[data-annotation-id="${e}"]`);if(!D)continue;const{firstChild:H}=D;H?H.nodeName==="CANVAS"?H.replaceWith(f):H.before(f):D.append(f)}t(this,Tt).clear()},c.AnnotationLayer=i},(ft,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.ColorConverters=void 0;function K(it){return Math.floor(Math.max(0,Math.min(1,it))*255).toString(16).padStart(2,"0")}function l(it){return Math.max(0,Math.min(255,255*it))}class y{static CMYK_G([U,ct,L,P]){return["G",1-Math.min(1,.3*U+.59*L+.11*ct+P)]}static G_CMYK([U]){return["CMYK",0,0,0,1-U]}static G_RGB([U]){return["RGB",U,U,U]}static G_rgb([U]){return U=l(U),[U,U,U]}static G_HTML([U]){const ct=K(U);return`#${ct}${ct}${ct}`}static RGB_G([U,ct,L]){return["G",.3*U+.59*ct+.11*L]}static RGB_rgb(U){return U.map(l)}static RGB_HTML(U){return`#${U.map(K).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([U,ct,L,P]){return["RGB",1-Math.min(1,U+P),1-Math.min(1,L+P),1-Math.min(1,ct+P)]}static CMYK_rgb([U,ct,L,P]){return[l(1-Math.min(1,U+P)),l(1-Math.min(1,L+P)),l(1-Math.min(1,ct+P))]}static CMYK_HTML(U){const ct=this.CMYK_RGB(U).slice(1);return this.RGB_HTML(ct)}static RGB_CMYK([U,ct,L]){const P=1-U,p=1-ct,O=1-L,N=Math.min(P,p,O);return["CMYK",P,p,O,N]}}c.ColorConverters=y},(ft,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.NullL10n=void 0,c.getL10nFallback=l;const K={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};K.print_progress_percent="{{progress}}%";function l(U,ct){switch(U){case"find_match_count":U=`find_match_count[${ct.total===1?"one":"other"}]`;break;case"find_match_count_limit":U=`find_match_count_limit[${ct.limit===1?"one":"other"}]`;break}return K[U]||""}function y(U,ct){return ct?U.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(L,P)=>P in ct?ct[P]:"{{"+P+"}}"):U}const it={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(U,ct=null,L=l(U,ct)){return y(L,ct)},async translate(U){}};c.NullL10n=it},(ft,c,K)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.XfaLayer=void 0;var l=K(25);class y{static setupStorage(U,ct,L,P,p){const O=P.getValue(ct,{value:null});switch(L.name){case"textarea":if(O.value!==null&&(U.textContent=O.value),p==="print")break;U.addEventListener("input",N=>{P.setValue(ct,{value:N.target.value})});break;case"input":if(L.attributes.type==="radio"||L.attributes.type==="checkbox"){if(O.value===L.attributes.xfaOn?U.setAttribute("checked",!0):O.value===L.attributes.xfaOff&&U.removeAttribute("checked"),p==="print")break;U.addEventListener("change",N=>{P.setValue(ct,{value:N.target.checked?N.target.getAttribute("xfaOn"):N.target.getAttribute("xfaOff")})})}else{if(O.value!==null&&U.setAttribute("value",O.value),p==="print")break;U.addEventListener("input",N=>{P.setValue(ct,{value:N.target.value})})}break;case"select":if(O.value!==null){U.setAttribute("value",O.value);for(const N of L.children)N.attributes.value===O.value?N.attributes.selected=!0:N.attributes.hasOwnProperty("selected")&&delete N.attributes.selected}U.addEventListener("input",N=>{const k=N.target.options,S=k.selectedIndex===-1?"":k[k.selectedIndex].value;P.setValue(ct,{value:S})});break}}static setAttributes({html:U,element:ct,storage:L=null,intent:P,linkService:p}){const{attributes:O}=ct,N=U instanceof HTMLAnchorElement;O.type==="radio"&&(O.name=`${O.name}-${P}`);for(const[k,S]of Object.entries(O))if(S!=null)switch(k){case"class":S.length&&U.setAttribute(k,S.join(" "));break;case"dataId":break;case"id":U.setAttribute("data-element-id",S);break;case"style":Object.assign(U.style,S);break;case"textContent":U.textContent=S;break;default:(!N||k!=="href"&&k!=="newWindow")&&U.setAttribute(k,S)}N&&p.addLinkAttributes(U,O.href,O.newWindow),L&&O.dataId&&this.setupStorage(U,O.dataId,ct,L)}static render(U){var v;const ct=U.annotationStorage,L=U.linkService,P=U.xfaHtml,p=U.intent||"display",O=document.createElement(P.name);P.attributes&&this.setAttributes({html:O,element:P,intent:p,linkService:L});const N=[[P,-1,O]],k=U.div;if(k.append(O),U.viewport){const u=`matrix(${U.viewport.transform.join(",")})`;k.style.transform=u}p!=="richText"&&k.setAttribute("class","xfaLayer xfaFont");const S=[];for(;N.length>0;){const[u,b,C]=N.at(-1);if(b+1===u.children.length){N.pop();continue}const T=u.children[++N.at(-1)[1]];if(T===null)continue;const{name:A}=T;if(A==="#text"){const h=document.createTextNode(T.value);S.push(h),C.append(h);continue}const a=(v=T==null?void 0:T.attributes)!=null&&v.xmlns?document.createElementNS(T.attributes.xmlns,A):document.createElement(A);if(C.append(a),T.attributes&&this.setAttributes({html:a,element:T,storage:ct,intent:p,linkService:L}),T.children&&T.children.length>0)N.push([T,-1,a]);else if(T.value){const h=document.createTextNode(T.value);l.XfaText.shouldBuildText(A)&&S.push(h),a.append(h)}}for(const u of k.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:S}}static update(U){const ct=`matrix(${U.viewport.transform.join(",")})`;U.div.style.transform=ct,U.div.hidden=!1}}c.XfaLayer=y},(ft,c,K)=>{var P,p,O,N,k,S,v,u,b,C,T,A,a,h,F,Ni,r,Bi,m,Ui,X,ji,$,hi,at,Hi,lt,di,wt,Wi,E,Gi,n,zi,o,Xi,_,$i,B,ae,Z,ui,ht,Me,ut,Re,Bt,fe,Dt,fi,J,De,dt,Vi,Ct,pi,Gt,qi,Xt,Yi,Wt,gi,ot,Ie,z,pe;Object.defineProperty(c,"__esModule",{value:!0}),c.InkEditor=void 0;var l=K(1),y=K(4),it=K(29),U=K(6),ct=K(5);const At=class At extends y.AnnotationEditor{constructor(q){super({...q,name:"inkEditor"});I(this,F);I(this,r);I(this,m);I(this,X);I(this,$);I(this,at);I(this,lt);I(this,wt);I(this,E);I(this,n);I(this,o);I(this,_);I(this,B);I(this,Z);I(this,ht);I(this,ut);I(this,Bt);I(this,Dt);I(this,J);I(this,Xt);I(this,Wt);I(this,ot);I(this,z);I(this,P,0);I(this,p,0);I(this,O,this.canvasPointermove.bind(this));I(this,N,this.canvasPointerleave.bind(this));I(this,k,this.canvasPointerup.bind(this));I(this,S,this.canvasPointerdown.bind(this));I(this,v,new Path2D);I(this,u,!1);I(this,b,!1);I(this,C,!1);I(this,T,null);I(this,A,0);I(this,a,0);I(this,h,null);this.color=q.color||null,this.thickness=q.thickness||null,this.opacity=q.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(q){y.AnnotationEditor.initialize(q,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(q,vt){switch(q){case l.AnnotationEditorParamsType.INK_THICKNESS:At._defaultThickness=vt;break;case l.AnnotationEditorParamsType.INK_COLOR:At._defaultColor=vt;break;case l.AnnotationEditorParamsType.INK_OPACITY:At._defaultOpacity=vt/100;break}}updateParams(q,vt){switch(q){case l.AnnotationEditorParamsType.INK_THICKNESS:G(this,F,Ni).call(this,vt);break;case l.AnnotationEditorParamsType.INK_COLOR:G(this,r,Bi).call(this,vt);break;case l.AnnotationEditorParamsType.INK_OPACITY:G(this,m,Ui).call(this,vt);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,At._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,At._defaultColor||y.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(At._defaultOpacity*100)]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||At._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,this.color||At._defaultColor||y.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??At._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(G(this,ht,Me).call(this),G(this,ut,Re).call(this)),this.isAttachedToDOM||(this.parent.add(this),G(this,Bt,fe).call(this)),G(this,z,pe).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,t(this,T).disconnect(),tt(this,T,null),super.remove())}setParent(q){!this.parent&&q?this._uiManager.removeShouldRescale(this):this.parent&&q===null&&this._uiManager.addShouldRescale(this),super.setParent(q)}onScaleChanging(){const[q,vt]=this.parentDimensions,Lt=this.width*q,Tt=this.height*vt;this.setDimensions(Lt,Tt)}enableEditMode(){t(this,u)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",t(this,S)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",t(this,S)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){t(this,u)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),tt(this,u,!0),this.div.classList.add("disabled"),G(this,z,pe).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(q){this._focusEventsAllowed&&(super.focusin(q),this.enableEditMode())}canvasPointerdown(q){q.button!==0||!this.isInEditMode()||t(this,u)||(this.setInForeground(),q.preventDefault(),q.type!=="mouse"&&this.div.focus(),G(this,at,Hi).call(this,q.offsetX,q.offsetY))}canvasPointermove(q){q.preventDefault(),G(this,lt,di).call(this,q.offsetX,q.offsetY)}canvasPointerup(q){q.preventDefault(),G(this,Z,ui).call(this,q)}canvasPointerleave(q){G(this,Z,ui).call(this,q)}get isResizable(){return!this.isEmpty()&&t(this,u)}render(){if(this.div)return this.div;let q,vt;this.width&&(q=this.x,vt=this.y),super.render(),y.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Jt=>{var bt;return(bt=this.div)==null?void 0:bt.setAttribute("aria-label",Jt)});const[Lt,Tt,Ot,Nt]=G(this,X,ji).call(this);if(this.setAt(Lt,Tt,0,0),this.setDims(Ot,Nt),G(this,ht,Me).call(this),this.width){const[Jt,bt]=this.parentDimensions;this.setAspectRatio(this.width*Jt,this.height*bt),this.setAt(q*Jt,vt*bt,this.width*Jt,this.height*bt),tt(this,C,!0),G(this,Bt,fe).call(this),this.setDims(this.width*Jt,this.height*bt),G(this,B,ae).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return G(this,ut,Re).call(this),this.div}setDimensions(q,vt){const Lt=Math.round(q),Tt=Math.round(vt);if(t(this,A)===Lt&&t(this,a)===Tt)return;tt(this,A,Lt),tt(this,a,Tt),this.canvas.style.visibility="hidden";const[Ot,Nt]=this.parentDimensions;this.width=q/Ot,this.height=vt/Nt,this.fixAndSetPosition(),t(this,u)&&G(this,Dt,fi).call(this,q,vt),G(this,Bt,fe).call(this),G(this,B,ae).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(q,vt,Lt){var H,V,st;if(q instanceof it.InkAnnotationElement)return null;const Tt=super.deserialize(q,vt,Lt);Tt.thickness=q.thickness,Tt.color=l.Util.makeHexColor(...q.color),Tt.opacity=q.opacity;const[Ot,Nt]=Tt.pageDimensions,Jt=Tt.width*Ot,bt=Tt.height*Nt,Yt=Tt.parentScale,It=q.thickness/2;tt(Tt,u,!0),tt(Tt,A,Math.round(Jt)),tt(Tt,a,Math.round(bt));const{paths:R,rect:e,rotation:f}=q;for(let{bezier:mt}of R){mt=G(H=At,Gt,qi).call(H,mt,e,f);const kt=[];Tt.paths.push(kt);let xt=Yt*(mt[0]-It),zt=Yt*(mt[1]-It);for(let Rt=2,Ut=mt.length;Rt<Ut;Rt+=6){const Vt=Yt*(mt[Rt]-It),Kt=Yt*(mt[Rt+1]-It),Qt=Yt*(mt[Rt+2]-It),se=Yt*(mt[Rt+3]-It),ie=Yt*(mt[Rt+4]-It),ne=Yt*(mt[Rt+5]-It);kt.push([[xt,zt],[Vt,Kt],[Qt,se],[ie,ne]]),xt=ie,zt=ne}const Mt=G(this,dt,Vi).call(this,kt);Tt.bezierPath2D.push(Mt)}const D=G(V=Tt,Wt,gi).call(V);return tt(Tt,p,Math.max(y.AnnotationEditor.MIN_SIZE,D[2]-D[0])),tt(Tt,P,Math.max(y.AnnotationEditor.MIN_SIZE,D[3]-D[1])),G(st=Tt,Dt,fi).call(st,Jt,bt),Tt}serialize(){if(this.isEmpty())return null;const q=this.getRect(0,0),vt=y.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:l.AnnotationEditorType.INK,color:vt,thickness:this.thickness,opacity:this.opacity,paths:G(this,Xt,Yi).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,q),pageIndex:this.pageIndex,rect:q,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};P=new WeakMap,p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakMap,C=new WeakMap,T=new WeakMap,A=new WeakMap,a=new WeakMap,h=new WeakMap,F=new WeakSet,Ni=function(q){const vt=this.thickness;this.addCommands({cmd:()=>{this.thickness=q,G(this,z,pe).call(this)},undo:()=>{this.thickness=vt,G(this,z,pe).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},r=new WeakSet,Bi=function(q){const vt=this.color;this.addCommands({cmd:()=>{this.color=q,G(this,B,ae).call(this)},undo:()=>{this.color=vt,G(this,B,ae).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},m=new WeakSet,Ui=function(q){q/=100;const vt=this.opacity;this.addCommands({cmd:()=>{this.opacity=q,G(this,B,ae).call(this)},undo:()=>{this.opacity=vt,G(this,B,ae).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},X=new WeakSet,ji=function(){const{parentRotation:q,parentDimensions:[vt,Lt]}=this;switch(q){case 90:return[0,Lt,Lt,vt];case 180:return[vt,Lt,vt,Lt];case 270:return[vt,0,Lt,vt];default:return[0,0,vt,Lt]}},$=new WeakSet,hi=function(){const{ctx:q,color:vt,opacity:Lt,thickness:Tt,parentScale:Ot,scaleFactor:Nt}=this;q.lineWidth=Tt*Ot/Nt,q.lineCap="round",q.lineJoin="round",q.miterLimit=10,q.strokeStyle=`${vt}${(0,ct.opacityToHex)(Lt)}`},at=new WeakSet,Hi=function(q,vt){this.canvas.addEventListener("contextmenu",U.noContextMenu),this.canvas.addEventListener("pointerleave",t(this,N)),this.canvas.addEventListener("pointermove",t(this,O)),this.canvas.addEventListener("pointerup",t(this,k)),this.canvas.removeEventListener("pointerdown",t(this,S)),this.isEditing=!0,t(this,C)||(tt(this,C,!0),G(this,Bt,fe).call(this),this.thickness||(this.thickness=At._defaultThickness),this.color||(this.color=At._defaultColor||y.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=At._defaultOpacity)),this.currentPath.push([q,vt]),tt(this,b,!1),G(this,$,hi).call(this),tt(this,h,()=>{G(this,n,zi).call(this),t(this,h)&&window.requestAnimationFrame(t(this,h))}),window.requestAnimationFrame(t(this,h))},lt=new WeakSet,di=function(q,vt){const[Lt,Tt]=this.currentPath.at(-1);if(this.currentPath.length>1&&q===Lt&&vt===Tt)return;const Ot=this.currentPath;let Nt=t(this,v);if(Ot.push([q,vt]),tt(this,b,!0),Ot.length<=2){Nt.moveTo(...Ot[0]),Nt.lineTo(q,vt);return}Ot.length===3&&(tt(this,v,Nt=new Path2D),Nt.moveTo(...Ot[0])),G(this,o,Xi).call(this,Nt,...Ot.at(-3),...Ot.at(-2),q,vt)},wt=new WeakSet,Wi=function(){if(this.currentPath.length===0)return;const q=this.currentPath.at(-1);t(this,v).lineTo(...q)},E=new WeakSet,Gi=function(q,vt){tt(this,h,null),q=Math.min(Math.max(q,0),this.canvas.width),vt=Math.min(Math.max(vt,0),this.canvas.height),G(this,lt,di).call(this,q,vt),G(this,wt,Wi).call(this);let Lt;if(this.currentPath.length!==1)Lt=G(this,_,$i).call(this);else{const bt=[q,vt];Lt=[[bt,bt.slice(),bt.slice(),bt]]}const Tt=t(this,v),Ot=this.currentPath;this.currentPath=[],tt(this,v,new Path2D);const Nt=()=>{this.allRawPaths.push(Ot),this.paths.push(Lt),this.bezierPath2D.push(Tt),this.rebuild()},Jt=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(G(this,ht,Me).call(this),G(this,ut,Re).call(this)),G(this,z,pe).call(this))};this.addCommands({cmd:Nt,undo:Jt,mustExec:!0})},n=new WeakSet,zi=function(){if(!t(this,b))return;tt(this,b,!1);const q=Math.ceil(this.thickness*this.parentScale),vt=this.currentPath.slice(-3),Lt=vt.map(Nt=>Nt[0]),Tt=vt.map(Nt=>Nt[1]);Math.min(...Lt)-q,Math.max(...Lt)+q,Math.min(...Tt)-q,Math.max(...Tt)+q;const{ctx:Ot}=this;Ot.save(),Ot.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Nt of this.bezierPath2D)Ot.stroke(Nt);Ot.stroke(t(this,v)),Ot.restore()},o=new WeakSet,Xi=function(q,vt,Lt,Tt,Ot,Nt,Jt){const bt=(vt+Tt)/2,Yt=(Lt+Ot)/2,It=(Tt+Nt)/2,R=(Ot+Jt)/2;q.bezierCurveTo(bt+2*(Tt-bt)/3,Yt+2*(Ot-Yt)/3,It+2*(Tt-It)/3,R+2*(Ot-R)/3,It,R)},_=new WeakSet,$i=function(){const q=this.currentPath;if(q.length<=2)return[[q[0],q[0],q.at(-1),q.at(-1)]];const vt=[];let Lt,[Tt,Ot]=q[0];for(Lt=1;Lt<q.length-2;Lt++){const[e,f]=q[Lt],[D,H]=q[Lt+1],V=(e+D)/2,st=(f+H)/2,mt=[Tt+2*(e-Tt)/3,Ot+2*(f-Ot)/3],kt=[V+2*(e-V)/3,st+2*(f-st)/3];vt.push([[Tt,Ot],mt,kt,[V,st]]),[Tt,Ot]=[V,st]}const[Nt,Jt]=q[Lt],[bt,Yt]=q[Lt+1],It=[Tt+2*(Nt-Tt)/3,Ot+2*(Jt-Ot)/3],R=[bt+2*(Nt-bt)/3,Yt+2*(Jt-Yt)/3];return vt.push([[Tt,Ot],It,R,[bt,Yt]]),vt},B=new WeakSet,ae=function(){if(this.isEmpty()){G(this,J,De).call(this);return}G(this,$,hi).call(this);const{canvas:q,ctx:vt}=this;vt.setTransform(1,0,0,1,0,0),vt.clearRect(0,0,q.width,q.height),G(this,J,De).call(this);for(const Lt of this.bezierPath2D)vt.stroke(Lt)},Z=new WeakSet,ui=function(q){this.canvas.removeEventListener("pointerleave",t(this,N)),this.canvas.removeEventListener("pointermove",t(this,O)),this.canvas.removeEventListener("pointerup",t(this,k)),this.canvas.addEventListener("pointerdown",t(this,S)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",U.noContextMenu)},10),G(this,E,Gi).call(this,q.offsetX,q.offsetY),this.addToAnnotationStorage(),this.setInBackground()},ht=new WeakSet,Me=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",y.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(q=>{var vt;return(vt=this.canvas)==null?void 0:vt.setAttribute("aria-label",q)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},ut=new WeakSet,Re=function(){tt(this,T,new ResizeObserver(q=>{const vt=q[0].contentRect;vt.width&&vt.height&&this.setDimensions(vt.width,vt.height)})),t(this,T).observe(this.div)},Bt=new WeakSet,fe=function(){if(!t(this,C))return;const[q,vt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*q),this.canvas.height=Math.ceil(this.height*vt),G(this,J,De).call(this)},Dt=new WeakSet,fi=function(q,vt){const Lt=G(this,ot,Ie).call(this),Tt=(q-Lt)/t(this,p),Ot=(vt-Lt)/t(this,P);this.scaleFactor=Math.min(Tt,Ot)},J=new WeakSet,De=function(){const q=G(this,ot,Ie).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+q,this.translationY*this.scaleFactor+q)},dt=new WeakSet,Vi=function(q){const vt=new Path2D;for(let Lt=0,Tt=q.length;Lt<Tt;Lt++){const[Ot,Nt,Jt,bt]=q[Lt];Lt===0&&vt.moveTo(...Ot),vt.bezierCurveTo(Nt[0],Nt[1],Jt[0],Jt[1],bt[0],bt[1])}return vt},Ct=new WeakSet,pi=function(q,vt,Lt){const[Tt,Ot,Nt,Jt]=vt;switch(Lt){case 0:for(let bt=0,Yt=q.length;bt<Yt;bt+=2)q[bt]+=Tt,q[bt+1]=Jt-q[bt+1];break;case 90:for(let bt=0,Yt=q.length;bt<Yt;bt+=2){const It=q[bt];q[bt]=q[bt+1]+Tt,q[bt+1]=It+Ot}break;case 180:for(let bt=0,Yt=q.length;bt<Yt;bt+=2)q[bt]=Nt-q[bt],q[bt+1]+=Ot;break;case 270:for(let bt=0,Yt=q.length;bt<Yt;bt+=2){const It=q[bt];q[bt]=Nt-q[bt+1],q[bt+1]=Jt-It}break;default:throw new Error("Invalid rotation")}return q},Gt=new WeakSet,qi=function(q,vt,Lt){const[Tt,Ot,Nt,Jt]=vt;switch(Lt){case 0:for(let bt=0,Yt=q.length;bt<Yt;bt+=2)q[bt]-=Tt,q[bt+1]=Jt-q[bt+1];break;case 90:for(let bt=0,Yt=q.length;bt<Yt;bt+=2){const It=q[bt];q[bt]=q[bt+1]-Ot,q[bt+1]=It-Tt}break;case 180:for(let bt=0,Yt=q.length;bt<Yt;bt+=2)q[bt]=Nt-q[bt],q[bt+1]-=Ot;break;case 270:for(let bt=0,Yt=q.length;bt<Yt;bt+=2){const It=q[bt];q[bt]=Jt-q[bt+1],q[bt+1]=Nt-It}break;default:throw new Error("Invalid rotation")}return q},Xt=new WeakSet,Yi=function(q,vt,Lt,Tt){var Yt,It;const Ot=[],Nt=this.thickness/2,Jt=q*vt+Nt,bt=q*Lt+Nt;for(const R of this.paths){const e=[],f=[];for(let D=0,H=R.length;D<H;D++){const[V,st,mt,kt]=R[D],xt=q*V[0]+Jt,zt=q*V[1]+bt,Mt=q*st[0]+Jt,Rt=q*st[1]+bt,Ut=q*mt[0]+Jt,Vt=q*mt[1]+bt,Kt=q*kt[0]+Jt,Qt=q*kt[1]+bt;D===0&&(e.push(xt,zt),f.push(xt,zt)),e.push(Mt,Rt,Ut,Vt,Kt,Qt),f.push(Mt,Rt),D===H-1&&f.push(Kt,Qt)}Ot.push({bezier:G(Yt=At,Ct,pi).call(Yt,e,Tt,this.rotation),points:G(It=At,Ct,pi).call(It,f,Tt,this.rotation)})}return Ot},Wt=new WeakSet,gi=function(){let q=1/0,vt=-1/0,Lt=1/0,Tt=-1/0;for(const Ot of this.paths)for(const[Nt,Jt,bt,Yt]of Ot){const It=l.Util.bezierBoundingBox(...Nt,...Jt,...bt,...Yt);q=Math.min(q,It[0]),Lt=Math.min(Lt,It[1]),vt=Math.max(vt,It[2]),Tt=Math.max(Tt,It[3])}return[q,Lt,vt,Tt]},ot=new WeakSet,Ie=function(){return t(this,u)?Math.ceil(this.thickness*this.parentScale):0},z=new WeakSet,pe=function(q=!1){if(this.isEmpty())return;if(!t(this,u)){G(this,B,ae).call(this);return}const vt=G(this,Wt,gi).call(this),Lt=G(this,ot,Ie).call(this);tt(this,p,Math.max(y.AnnotationEditor.MIN_SIZE,vt[2]-vt[0])),tt(this,P,Math.max(y.AnnotationEditor.MIN_SIZE,vt[3]-vt[1]));const Tt=Math.ceil(Lt+t(this,p)*this.scaleFactor),Ot=Math.ceil(Lt+t(this,P)*this.scaleFactor),[Nt,Jt]=this.parentDimensions;this.width=Tt/Nt,this.height=Ot/Jt,this.setAspectRatio(Tt,Ot);const bt=this.translationX,Yt=this.translationY;this.translationX=-vt[0],this.translationY=-vt[1],G(this,Bt,fe).call(this),G(this,B,ae).call(this),tt(this,A,Tt),tt(this,a,Ot),this.setDims(Tt,Ot);const It=q?Lt/this.scaleFactor/2:0;this.translate(bt-this.translationX-It,Yt-this.translationY-It)},I(At,dt),I(At,Ct),I(At,Gt),ee(At,"_defaultColor",null),ee(At,"_defaultOpacity",1),ee(At,"_defaultThickness",1),ee(At,"_type","ink");let L=At;c.InkEditor=L},(ft,c,K)=>{var L,P,p,O,N,k,S,v,u,b,C,ve,A,Se,h,Le,g,mi,x,Ki,j,Ji,w,_i,nt,Oe,W,Qi;Object.defineProperty(c,"__esModule",{value:!0}),c.StampEditor=void 0;var l=K(1),y=K(4),it=K(6),U=K(29);const gt=class gt extends y.AnnotationEditor{constructor(E){super({...E,name:"stampEditor"});I(this,C);I(this,A);I(this,h);I(this,g);I(this,x);I(this,j);I(this,w);I(this,nt);I(this,W);I(this,L,null);I(this,P,null);I(this,p,null);I(this,O,null);I(this,N,null);I(this,k,null);I(this,S,null);I(this,v,null);I(this,u,!1);I(this,b,!1);tt(this,O,E.bitmapUrl),tt(this,N,E.bitmapFile)}static initialize(E){y.AnnotationEditor.initialize(E)}static get supportedTypes(){const E=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,l.shadow)(this,"supportedTypes",E.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,l.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(E){return this.supportedTypes.includes(E)}static paste(E,i){i.pasteEditor(l.AnnotationEditorType.STAMP,{bitmapFile:E.getAsFile()})}remove(){var E,i;t(this,P)&&(tt(this,L,null),this._uiManager.imageManager.deleteId(t(this,P)),(E=t(this,k))==null||E.remove(),tt(this,k,null),(i=t(this,S))==null||i.disconnect(),tt(this,S,null)),super.remove()}rebuild(){if(!this.parent){t(this,P)&&G(this,h,Le).call(this);return}super.rebuild(),this.div!==null&&(t(this,P)&&G(this,h,Le).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(t(this,p)||t(this,L)||t(this,O)||t(this,N))}get isResizable(){return!0}render(){if(this.div)return this.div;let E,i;if(this.width&&(E=this.x,i=this.y),super.render(),this.div.hidden=!0,t(this,L)?G(this,g,mi).call(this):G(this,h,Le).call(this),this.width){const[n,s]=this.parentDimensions;this.setAt(E*n,i*s,this.width*n,this.height*s)}return this.div}static deserialize(E,i,n){if(E instanceof U.StampAnnotationElement)return null;const s=super.deserialize(E,i,n),{rect:o,bitmapUrl:d,bitmapId:_,isSvg:M,accessibilityData:B}=E;_&&n.imageManager.isValidId(_)?tt(s,P,_):tt(s,O,d),tt(s,u,M);const[et,Z]=s.pageDimensions;return s.width=(o[2]-o[0])/et,s.height=(o[3]-o[1])/Z,B&&(s.altTextData=B),s}serialize(E=!1,i=null){if(this.isEmpty())return null;const n={annotationType:l.AnnotationEditorType.STAMP,bitmapId:t(this,P),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:t(this,u),structTreeParentId:this._structTreeParentId};if(E)return n.bitmapUrl=G(this,nt,Oe).call(this,!0),n.accessibilityData=this.altTextData,n;const{decorative:s,altText:o}=this.altTextData;if(!s&&o&&(n.accessibilityData={type:"Figure",alt:o}),i===null)return n;i.stamps||(i.stamps=new Map);const d=t(this,u)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!i.stamps.has(t(this,P)))i.stamps.set(t(this,P),{area:d,serialized:n}),n.bitmap=G(this,nt,Oe).call(this,!1);else if(t(this,u)){const _=i.stamps.get(t(this,P));d>_.area&&(_.area=d,_.serialized.bitmap.close(),_.serialized.bitmap=G(this,nt,Oe).call(this,!1))}return n}};L=new WeakMap,P=new WeakMap,p=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,S=new WeakMap,v=new WeakMap,u=new WeakMap,b=new WeakMap,C=new WeakSet,ve=function(E,i=!1){if(!E){this.remove();return}tt(this,L,E.bitmap),i||(tt(this,P,E.id),tt(this,u,E.isSvg)),G(this,g,mi).call(this)},A=new WeakSet,Se=function(){tt(this,p,null),this._uiManager.enableWaiting(!1),t(this,k)&&this.div.focus()},h=new WeakSet,Le=function(){if(t(this,P)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(t(this,P)).then(i=>G(this,C,ve).call(this,i,!0)).finally(()=>G(this,A,Se).call(this));return}if(t(this,O)){const i=t(this,O);tt(this,O,null),this._uiManager.enableWaiting(!0),tt(this,p,this._uiManager.imageManager.getFromUrl(i).then(n=>G(this,C,ve).call(this,n)).finally(()=>G(this,A,Se).call(this)));return}if(t(this,N)){const i=t(this,N);tt(this,N,null),this._uiManager.enableWaiting(!0),tt(this,p,this._uiManager.imageManager.getFromFile(i).then(n=>G(this,C,ve).call(this,n)).finally(()=>G(this,A,Se).call(this)));return}const E=document.createElement("input");E.type="file",E.accept=gt.supportedTypesStr,tt(this,p,new Promise(i=>{E.addEventListener("change",async()=>{if(!E.files||E.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(E.files[0]);G(this,C,ve).call(this,n)}i()}),E.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>G(this,A,Se).call(this))),E.click()},g=new WeakSet,mi=function(){const{div:E}=this;let{width:i,height:n}=t(this,L);const[s,o]=this.pageDimensions,d=.75;if(this.width)i=this.width*s,n=this.height*o;else if(i>d*s||n>d*o){const et=Math.min(d*s/i,d*o/n);i*=et,n*=et}const[_,M]=this.parentDimensions;this.setDims(i*_/s,n*M/o),this._uiManager.enableWaiting(!1);const B=tt(this,k,document.createElement("canvas"));E.append(B),E.hidden=!1,G(this,w,_i).call(this,i,n),G(this,W,Qi).call(this),t(this,b)||(this.parent.addUndoableEditor(this),tt(this,b,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},x=new WeakSet,Ki=function(E,i){var d;const[n,s]=this.parentDimensions;this.width=E/n,this.height=i/s,this.setDims(E,i),(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,t(this,v)!==null&&clearTimeout(t(this,v)),tt(this,v,setTimeout(()=>{tt(this,v,null),G(this,w,_i).call(this,E,i)},200))},j=new WeakSet,Ji=function(E,i){const{width:n,height:s}=t(this,L);let o=n,d=s,_=t(this,L);for(;o>2*E||d>2*i;){const M=o,B=d;o>2*E&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),d>2*i&&(d=d>=16384?Math.floor(d/2)-1:Math.ceil(d/2));const et=new OffscreenCanvas(o,d);et.getContext("2d").drawImage(_,0,0,M,B,0,0,o,d),_=et.transferToImageBitmap()}return _},w=new WeakSet,_i=function(E,i){E=Math.ceil(E),i=Math.ceil(i);const n=t(this,k);if(!n||n.width===E&&n.height===i)return;n.width=E,n.height=i;const s=t(this,u)?t(this,L):G(this,j,Ji).call(this,E,i),o=n.getContext("2d");o.filter=this._uiManager.hcmFilter,o.drawImage(s,0,0,s.width,s.height,0,0,E,i)},nt=new WeakSet,Oe=function(E){if(E){if(t(this,u)){const s=this._uiManager.imageManager.getSvgUrl(t(this,P));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=t(this,L),i.getContext("2d").drawImage(t(this,L),0,0),i.toDataURL()}if(t(this,u)){const[i,n]=this.pageDimensions,s=Math.round(this.width*i*it.PixelsPerInch.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*it.PixelsPerInch.PDF_TO_CSS_UNITS),d=new OffscreenCanvas(s,o);return d.getContext("2d").drawImage(t(this,L),0,0,t(this,L).width,t(this,L).height,0,0,s,o),d.transferToImageBitmap()}return structuredClone(t(this,L))},W=new WeakSet,Qi=function(){tt(this,S,new ResizeObserver(E=>{const i=E[0].contentRect;i.width&&i.height&&G(this,x,Ki).call(this,i.width,i.height)})),t(this,S).observe(this.div)},ee(gt,"_type","stamp");let ct=gt;c.StampEditor=ct}],__webpack_module_cache__={};function __w_pdfjs_require__(ft){var c=__webpack_module_cache__[ft];if(c!==void 0)return c.exports;var K=__webpack_module_cache__[ft]={exports:{}};return __webpack_modules__[ft](K,K.exports,__w_pdfjs_require__),K.exports}var __webpack_exports__={};return(()=>{var ft=__webpack_exports__;Object.defineProperty(ft,"__esModule",{value:!0}),Object.defineProperty(ft,"AbortException",{enumerable:!0,get:function(){return c.AbortException}}),Object.defineProperty(ft,"AnnotationEditorLayer",{enumerable:!0,get:function(){return it.AnnotationEditorLayer}}),Object.defineProperty(ft,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return c.AnnotationEditorParamsType}}),Object.defineProperty(ft,"AnnotationEditorType",{enumerable:!0,get:function(){return c.AnnotationEditorType}}),Object.defineProperty(ft,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return U.AnnotationEditorUIManager}}),Object.defineProperty(ft,"AnnotationLayer",{enumerable:!0,get:function(){return ct.AnnotationLayer}}),Object.defineProperty(ft,"AnnotationMode",{enumerable:!0,get:function(){return c.AnnotationMode}}),Object.defineProperty(ft,"CMapCompressionType",{enumerable:!0,get:function(){return c.CMapCompressionType}}),Object.defineProperty(ft,"DOMSVGFactory",{enumerable:!0,get:function(){return l.DOMSVGFactory}}),Object.defineProperty(ft,"FeatureTest",{enumerable:!0,get:function(){return c.FeatureTest}}),Object.defineProperty(ft,"GlobalWorkerOptions",{enumerable:!0,get:function(){return L.GlobalWorkerOptions}}),Object.defineProperty(ft,"ImageKind",{enumerable:!0,get:function(){return c.ImageKind}}),Object.defineProperty(ft,"InvalidPDFException",{enumerable:!0,get:function(){return c.InvalidPDFException}}),Object.defineProperty(ft,"MissingPDFException",{enumerable:!0,get:function(){return c.MissingPDFException}}),Object.defineProperty(ft,"OPS",{enumerable:!0,get:function(){return c.OPS}}),Object.defineProperty(ft,"PDFDataRangeTransport",{enumerable:!0,get:function(){return K.PDFDataRangeTransport}}),Object.defineProperty(ft,"PDFDateString",{enumerable:!0,get:function(){return l.PDFDateString}}),Object.defineProperty(ft,"PDFWorker",{enumerable:!0,get:function(){return K.PDFWorker}}),Object.defineProperty(ft,"PasswordResponses",{enumerable:!0,get:function(){return c.PasswordResponses}}),Object.defineProperty(ft,"PermissionFlag",{enumerable:!0,get:function(){return c.PermissionFlag}}),Object.defineProperty(ft,"PixelsPerInch",{enumerable:!0,get:function(){return l.PixelsPerInch}}),Object.defineProperty(ft,"PromiseCapability",{enumerable:!0,get:function(){return c.PromiseCapability}}),Object.defineProperty(ft,"RenderingCancelledException",{enumerable:!0,get:function(){return l.RenderingCancelledException}}),Object.defineProperty(ft,"SVGGraphics",{enumerable:!0,get:function(){return K.SVGGraphics}}),Object.defineProperty(ft,"UnexpectedResponseException",{enumerable:!0,get:function(){return c.UnexpectedResponseException}}),Object.defineProperty(ft,"Util",{enumerable:!0,get:function(){return c.Util}}),Object.defineProperty(ft,"VerbosityLevel",{enumerable:!0,get:function(){return c.VerbosityLevel}}),Object.defineProperty(ft,"XfaLayer",{enumerable:!0,get:function(){return P.XfaLayer}}),Object.defineProperty(ft,"build",{enumerable:!0,get:function(){return K.build}}),Object.defineProperty(ft,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return c.createValidAbsoluteUrl}}),Object.defineProperty(ft,"getDocument",{enumerable:!0,get:function(){return K.getDocument}}),Object.defineProperty(ft,"getFilenameFromUrl",{enumerable:!0,get:function(){return l.getFilenameFromUrl}}),Object.defineProperty(ft,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return l.getPdfFilenameFromUrl}}),Object.defineProperty(ft,"getXfaPageViewport",{enumerable:!0,get:function(){return l.getXfaPageViewport}}),Object.defineProperty(ft,"isDataScheme",{enumerable:!0,get:function(){return l.isDataScheme}}),Object.defineProperty(ft,"isPdfFile",{enumerable:!0,get:function(){return l.isPdfFile}}),Object.defineProperty(ft,"loadScript",{enumerable:!0,get:function(){return l.loadScript}}),Object.defineProperty(ft,"noContextMenu",{enumerable:!0,get:function(){return l.noContextMenu}}),Object.defineProperty(ft,"normalizeUnicode",{enumerable:!0,get:function(){return c.normalizeUnicode}}),Object.defineProperty(ft,"renderTextLayer",{enumerable:!0,get:function(){return y.renderTextLayer}}),Object.defineProperty(ft,"setLayerDimensions",{enumerable:!0,get:function(){return l.setLayerDimensions}}),Object.defineProperty(ft,"shadow",{enumerable:!0,get:function(){return c.shadow}}),Object.defineProperty(ft,"updateTextLayer",{enumerable:!0,get:function(){return y.updateTextLayer}}),Object.defineProperty(ft,"version",{enumerable:!0,get:function(){return K.version}});var c=__w_pdfjs_require__(1),K=__w_pdfjs_require__(2),l=__w_pdfjs_require__(6),y=__w_pdfjs_require__(26),it=__w_pdfjs_require__(27),U=__w_pdfjs_require__(5),ct=__w_pdfjs_require__(29),L=__w_pdfjs_require__(14),P=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const PdfViewer_svelte_svelte_type_style_lang="";function create_fragment$1(ft){let c,K;return{c(){c=element("div"),K=element("div"),this.h()},l(l){c=claim_element(l,"DIV",{class:!0});var y=children(c);K=claim_element(y,"DIV",{class:!0,style:!0}),children(K).forEach(detach),y.forEach(detach),this.h()},h(){attr(K,"class","pdf-wrapper svelte-r9i6p1"),set_style(K,"--scale-factor","1.2"),attr(c,"class","pdf-container svelte-r9i6p1")},m(l,y){insert_hydration(l,c,y),append_hydration(c,K),ft[2](K)},p:noop,i:noop,o:noop,d(l){l&&detach(c),ft[2](null)}}}function instance$1(ft,c,K){pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";let{url:l=""}=c,y;async function it(L){const P=L.getViewport({scale:1.2}),p=document.createElement("div");p.style.marginBottom="16px",p.style.position="relative",p.id=`page-${L._pageIndex+1}`;const O=document.createElement("canvas"),N=O.getContext("2d");if(!N)return;O.height=P.height,O.width=P.width,p.appendChild(O),y.appendChild(p),L.render({canvasContext:N,viewport:P});const k=document.createElement("div");k.className="textLayer";const S=await L.getTextContent();pdfExports.renderTextLayer({textContentSource:S,viewport:L.getViewport(),container:k}),p.appendChild(k)}let U=!1;onMount(async()=>{const L=await pdfExports.getDocument(l).promise;if(!U)for(let P=1;P<=L.numPages;P++)L.getPage(P).then(it)}),onDestroy(()=>{U=!0});function ct(L){binding_callbacks[L?"unshift":"push"](()=>{y=L,K(0,y)})}return ft.$$set=L=>{"url"in L&&K(1,l=L.url)},[y,l,ct]}class PdfViewer extends SvelteComponent{constructor(c){super(),init(this,c,instance$1,create_fragment$1,safe_not_equal,{url:1})}}function create_if_block_1(ft){let c=ft[0].error+"",K;return{c(){K=text(c)},l(l){K=claim_text(l,c)},m(l,y){insert_hydration(l,K,y)},p(l,y){y&1&&c!==(c=l[0].error+"")&&set_data(K,c)},d(l){l&&detach(K)}}}function create_if_block(ft){let c,K,l,y,it,U,ct;return l=new ChatPanel({props:{documentId:ft[1].id,onSubmit:ft[3]}}),U=new PdfViewer({props:{url:ft[2]}}),{c(){c=element("div"),K=element("div"),create_component(l.$$.fragment),y=space(),it=element("div"),create_component(U.$$.fragment),this.h()},l(L){c=claim_element(L,"DIV",{class:!0,style:!0});var P=children(c);K=claim_element(P,"DIV",{class:!0});var p=children(K);claim_component(l.$$.fragment,p),p.forEach(detach),y=claim_space(P),it=claim_element(P,"DIV",{class:!0});var O=children(it);claim_component(U.$$.fragment,O),O.forEach(detach),P.forEach(detach),this.h()},h(){attr(K,"class","col-span-1"),attr(it,"class","col-span-2"),attr(c,"class","grid grid-cols-3 gap-2"),set_style(c,"height","calc(100vh - 80px)")},m(L,P){insert_hydration(L,c,P),append_hydration(c,K),mount_component(l,K,null),append_hydration(c,y),append_hydration(c,it),mount_component(U,it,null),ct=!0},p:noop,i(L){ct||(transition_in(l.$$.fragment,L),transition_in(U.$$.fragment,L),ct=!0)},o(L){transition_out(l.$$.fragment,L),transition_out(U.$$.fragment,L),ct=!1},d(L){L&&detach(c),destroy_component(l),destroy_component(U)}}}function create_fragment(ft){let c,K,l,y=ft[0].error&&create_if_block_1(ft),it=ft[1]&&create_if_block(ft);return{c(){y&&y.c(),c=space(),it&&it.c(),K=empty()},l(U){y&&y.l(U),c=claim_space(U),it&&it.l(U),K=empty()},m(U,ct){y&&y.m(U,ct),insert_hydration(U,c,ct),it&&it.m(U,ct),insert_hydration(U,K,ct),l=!0},p(U,[ct]){U[0].error?y?y.p(U,ct):(y=create_if_block_1(U),y.c(),y.m(c.parentNode,c)):y&&(y.d(1),y=null),U[1]&&it.p(U,ct)},i(U){l||(transition_in(it),l=!0)},o(U){transition_out(it),l=!1},d(U){y&&y.d(U),U&&detach(c),it&&it.d(U),U&&detach(K)}}}function instance(ft,c,K){let{data:l}=c;const y=l.document,it=l.documentUrl;function U(ct,L){sendMessage({role:"user",content:ct},{useStreaming:L,documentId:y.id})}return beforeNavigate(resetAll),ft.$$set=ct=>{"data"in ct&&K(0,l=ct.data)},[l,y,it,U]}class Page extends SvelteComponent{constructor(c){super(),init(this,c,instance,create_fragment,safe_not_equal,{data:0})}}export{Page as component,_page as universal};
